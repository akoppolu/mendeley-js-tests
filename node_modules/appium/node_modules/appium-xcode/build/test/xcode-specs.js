require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _index = require('../index');

var _index2 = _interopRequireDefault(_index);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _appiumSupport = require('appium-support');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var should = _chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('xcode @skip-linux', function () {
  var _this = this;

  // on slow machines and busy CI systems these can be slow and flakey
  this.timeout(30000);

  it('should get the path to xcode executable', function callee$1$0() {
    var path;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getPath());

        case 2:
          path = context$2$0.sent;

          should.exist(path);
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path));

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  describe('getVersion', function () {
    var versionRE = /\d\.\d\.*\d*/;

    it('should get the version of xcode', function callee$2$0() {
      var version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 2:
            version = context$3$0.sent;

            should.exist(version);
            _lodash2['default'].isString(version).should.be['true'];
            versionRE.test(version).should.be['true'];

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should get the path and version again, these values are cached', function callee$2$0() {
      var before, path, after, version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getPath());

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 4:
            before = new Date();
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(_index2['default'].getPath());

          case 7:
            path = context$3$0.sent;
            after = new Date();

            should.exist(path);
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path));

          case 12:
            (after - before).should.be.at.most(2);

            before = new Date();
            context$3$0.next = 16;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 16:
            version = context$3$0.sent;

            after = new Date();

            should.exist(version);
            _lodash2['default'].isString(version).should.be['true'];
            versionRE.test(version).should.be['true'];
            (after - before).should.be.at.most(2);

          case 22:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should get the parsed version', function callee$2$0() {
      var nonParsedVersion, version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 2:
            nonParsedVersion = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion(true));

          case 5:
            version = context$3$0.sent;

            should.exist(version);
            _lodash2['default'].isString(version.versionString).should.be['true'];
            version.versionString.should.eql(nonParsedVersion);

            parseFloat(version.versionFloat).should.equal(version.versionFloat);
            parseInt(version.major, 10).should.equal(version.major);
            parseInt(version.minor, 10).should.equal(version.minor);

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  it('should get the command line tools version', function callee$1$0() {
    var cliVersion;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getCommandLineToolsVersion());

        case 2:
          cliVersion = context$2$0.sent;

          _lodash2['default'].isString(cliVersion).should.be['true'];

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should clear the cache if asked to', function callee$1$0() {
    var before, after;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          _index2['default'].clearInternalCache();

          before = new Date();
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(_index2['default'].getPath());

        case 4:
          after = new Date();

          (after - before).should.be.at.least(6);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should get max iOS SDK version', function callee$1$0() {
    var version;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getMaxIOSSDK());

        case 2:
          version = context$2$0.sent;

          should.exist(version);
          (typeof version).should.equal('string');
          (parseFloat(version) - 6.1).should.be.at.least(0);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get a list of iOS devices', function callee$1$0() {
    var devices;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getConnectedDevices());

        case 2:
          devices = context$2$0.sent;

          should.exist(devices);
          (typeof devices).should.equal('object');

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get the path to instruments binary', function callee$1$0() {
    var instrumentsPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getInstrumentsPath());

        case 2:
          instrumentsPath = context$2$0.sent;

          should.exist(instrumentsPath);
          (typeof instrumentsPath).should.equal('string');
          instrumentsPath.length.should.be.above(3);
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(instrumentsPath));

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  describe('ui automation', function () {
    var _this2 = this;

    before(function callee$2$0() {
      var version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion(true));

          case 2:
            version = context$3$0.sent;

            if (version.major >= 8) {
              this.skip();
            }

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should find the automation trace template', function callee$2$0() {
      var path, suffix;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getAutomationTraceTemplatePath());

          case 2:
            path = context$3$0.sent;

            should.exist(path);
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path).should.eventually.be['true']);

          case 6:
            suffix = ".tracetemplate";

            path.slice(-suffix.length).should.equal(suffix);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,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LG1CQUFNLFVBQVUsQ0FBQyxJQUFJLENBQUM7OztBQUF0QyxtQkFBTzs7QUFDWCxnQkFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLENBQUMsRUFBRTtBQUN0QixrQkFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2FBQ2I7Ozs7Ozs7S0FDRixDQUFDLENBQUM7QUFDSCxNQUFFLENBQUMsMkNBQTJDLEVBQUU7VUFDMUMsSUFBSSxFQUlKLE1BQU07Ozs7OzZDQUpPLG1CQUFNLDhCQUE4QixFQUFFOzs7QUFBbkQsZ0JBQUk7O0FBRVIsa0JBQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7OzZDQUNiLGtCQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBSzs7O0FBQzNDLGtCQUFNLEdBQUcsZ0JBQWdCOztBQUM3QixnQkFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDOzs7Ozs7O0tBQ2pELENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L3hjb2RlLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gdHJhbnNwaWxlOm1vY2hhXG5cbmltcG9ydCB4Y29kZSBmcm9tICcuLi9pbmRleCc7XG5pbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCB7IGZzIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuXG5sZXQgc2hvdWxkID0gY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ3hjb2RlIEBza2lwLWxpbnV4JywgZnVuY3Rpb24gKCkge1xuICAvLyBvbiBzbG93IG1hY2hpbmVzIGFuZCBidXN5IENJIHN5c3RlbXMgdGhlc2UgY2FuIGJlIHNsb3cgYW5kIGZsYWtleVxuICB0aGlzLnRpbWVvdXQoMzAwMDApO1xuXG4gIGl0KCdzaG91bGQgZ2V0IHRoZSBwYXRoIHRvIHhjb2RlIGV4ZWN1dGFibGUnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHBhdGggPSBhd2FpdCB4Y29kZS5nZXRQYXRoKCk7XG4gICAgc2hvdWxkLmV4aXN0KHBhdGgpO1xuICAgIGF3YWl0IGZzLmV4aXN0cyhwYXRoKTtcblxuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0VmVyc2lvbicsICgpID0+IHtcbiAgICBsZXQgdmVyc2lvblJFID0gL1xcZFxcLlxcZFxcLipcXGQqLztcblxuICAgIGl0KCdzaG91bGQgZ2V0IHRoZSB2ZXJzaW9uIG9mIHhjb2RlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRWZXJzaW9uKCk7XG4gICAgICBzaG91bGQuZXhpc3QodmVyc2lvbik7XG4gICAgICBfLmlzU3RyaW5nKHZlcnNpb24pLnNob3VsZC5iZS50cnVlO1xuICAgICAgdmVyc2lvblJFLnRlc3QodmVyc2lvbikuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgcGF0aCBhbmQgdmVyc2lvbiBhZ2FpbiwgdGhlc2UgdmFsdWVzIGFyZSBjYWNoZWQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCB4Y29kZS5nZXRQYXRoKCk7XG4gICAgICBhd2FpdCB4Y29kZS5nZXRWZXJzaW9uKCk7XG5cbiAgICAgIGxldCBiZWZvcmUgPSBuZXcgRGF0ZSgpO1xuICAgICAgbGV0IHBhdGggPSBhd2FpdCB4Y29kZS5nZXRQYXRoKCk7XG4gICAgICBsZXQgYWZ0ZXIgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICBzaG91bGQuZXhpc3QocGF0aCk7XG4gICAgICBhd2FpdCBmcy5leGlzdHMocGF0aCk7XG4gICAgICAoYWZ0ZXItYmVmb3JlKS5zaG91bGQuYmUuYXQubW9zdCgyKTtcblxuICAgICAgYmVmb3JlID0gbmV3IERhdGUoKTtcbiAgICAgIGxldCB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbigpO1xuICAgICAgYWZ0ZXIgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICBzaG91bGQuZXhpc3QodmVyc2lvbik7XG4gICAgICBfLmlzU3RyaW5nKHZlcnNpb24pLnNob3VsZC5iZS50cnVlO1xuICAgICAgdmVyc2lvblJFLnRlc3QodmVyc2lvbikuc2hvdWxkLmJlLnRydWU7XG4gICAgICAoYWZ0ZXItYmVmb3JlKS5zaG91bGQuYmUuYXQubW9zdCgyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2V0IHRoZSBwYXJzZWQgdmVyc2lvbicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCBub25QYXJzZWRWZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbigpO1xuICAgICAgbGV0IHZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRWZXJzaW9uKHRydWUpO1xuICAgICAgc2hvdWxkLmV4aXN0KHZlcnNpb24pO1xuICAgICAgXy5pc1N0cmluZyh2ZXJzaW9uLnZlcnNpb25TdHJpbmcpLnNob3VsZC5iZS50cnVlO1xuICAgICAgdmVyc2lvbi52ZXJzaW9uU3RyaW5nLnNob3VsZC5lcWwobm9uUGFyc2VkVmVyc2lvbik7XG5cbiAgICAgIHBhcnNlRmxvYXQodmVyc2lvbi52ZXJzaW9uRmxvYXQpLnNob3VsZC5lcXVhbCh2ZXJzaW9uLnZlcnNpb25GbG9hdCk7XG4gICAgICBwYXJzZUludCh2ZXJzaW9uLm1ham9yLCAxMCkuc2hvdWxkLmVxdWFsKHZlcnNpb24ubWFqb3IpO1xuICAgICAgcGFyc2VJbnQodmVyc2lvbi5taW5vciwgMTApLnNob3VsZC5lcXVhbCh2ZXJzaW9uLm1pbm9yKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgdGhlIGNvbW1hbmQgbGluZSB0b29scyB2ZXJzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjbGlWZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0Q29tbWFuZExpbmVUb29sc1ZlcnNpb24oKTtcbiAgICBfLmlzU3RyaW5nKGNsaVZlcnNpb24pLnNob3VsZC5iZS50cnVlO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGNsZWFyIHRoZSBjYWNoZSBpZiBhc2tlZCB0bycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICB4Y29kZS5jbGVhckludGVybmFsQ2FjaGUoKTtcblxuICAgIGxldCBiZWZvcmUgPSBuZXcgRGF0ZSgpO1xuICAgIGF3YWl0IHhjb2RlLmdldFBhdGgoKTtcbiAgICBsZXQgYWZ0ZXIgPSBuZXcgRGF0ZSgpO1xuICAgIChhZnRlci1iZWZvcmUpLnNob3VsZC5iZS5hdC5sZWFzdCg2KTtcblxuICB9KTtcblxuICBpdCgnc2hvdWxkIGdldCBtYXggaU9TIFNESyB2ZXJzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG5cbiAgICBzaG91bGQuZXhpc3QodmVyc2lvbik7XG4gICAgKHR5cGVvZiB2ZXJzaW9uKS5zaG91bGQuZXF1YWwoJ3N0cmluZycpO1xuICAgIChwYXJzZUZsb2F0KHZlcnNpb24pLTYuMSkuc2hvdWxkLmJlLmF0LmxlYXN0KDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGdldCBhIGxpc3Qgb2YgaU9TIGRldmljZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGRldmljZXMgPSBhd2FpdCB4Y29kZS5nZXRDb25uZWN0ZWREZXZpY2VzKCk7XG4gICAgc2hvdWxkLmV4aXN0KGRldmljZXMpO1xuICAgICh0eXBlb2YgZGV2aWNlcykuc2hvdWxkLmVxdWFsKCdvYmplY3QnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgdGhlIHBhdGggdG8gaW5zdHJ1bWVudHMgYmluYXJ5JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBpbnN0cnVtZW50c1BhdGggPSBhd2FpdCB4Y29kZS5nZXRJbnN0cnVtZW50c1BhdGgoKTtcblxuICAgIHNob3VsZC5leGlzdChpbnN0cnVtZW50c1BhdGgpO1xuICAgICh0eXBlb2YgaW5zdHJ1bWVudHNQYXRoKS5zaG91bGQuZXF1YWwoJ3N0cmluZycpO1xuICAgIGluc3RydW1lbnRzUGF0aC5sZW5ndGguc2hvdWxkLmJlLmFib3ZlKDMpO1xuICAgIGF3YWl0IGZzLmV4aXN0cyhpbnN0cnVtZW50c1BhdGgpO1xuICB9KTtcblxuICBkZXNjcmliZSgndWkgYXV0b21hdGlvbicsIGZ1bmN0aW9uICgpIHtcbiAgICBiZWZvcmUoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IHZlcnNpb24gPSBhd2FpdCB4Y29kZS5nZXRWZXJzaW9uKHRydWUpO1xuICAgICAgaWYgKHZlcnNpb24ubWFqb3IgPj0gOCkge1xuICAgICAgICB0aGlzLnNraXAoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGZpbmQgdGhlIGF1dG9tYXRpb24gdHJhY2UgdGVtcGxhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcGF0aCA9IGF3YWl0IHhjb2RlLmdldEF1dG9tYXRpb25UcmFjZVRlbXBsYXRlUGF0aCgpO1xuXG4gICAgICBzaG91bGQuZXhpc3QocGF0aCk7XG4gICAgICBhd2FpdCBmcy5leGlzdHMocGF0aCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUudHJ1ZTtcbiAgICAgIGxldCBzdWZmaXggPSBcIi50cmFjZXRlbXBsYXRlXCI7XG4gICAgICBwYXRoLnNsaWNlKC1zdWZmaXgubGVuZ3RoKS5zaG91bGQuZXF1YWwoc3VmZml4KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
