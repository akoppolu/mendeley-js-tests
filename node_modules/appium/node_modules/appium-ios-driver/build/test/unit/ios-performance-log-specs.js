require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _2 = require('../..');

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('performance logs', function () {
  var onTimelineEventCb = undefined;
  var log = undefined;
  var remote = {
    startTimeline: _lodash2['default'].noop,
    stopTimeline: _lodash2['default'].noop
  };
  var startTimelineStub = undefined;
  var stopTimelineStub = undefined;
  beforeEach(function () {
    startTimelineStub = _sinon2['default'].stub(remote, 'startTimeline', function callee$2$0(cb) {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            // eslint-disable-line promise/prefer-await-to-callbacks
            onTimelineEventCb = cb;

          case 1:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    stopTimelineStub = _sinon2['default'].stub(remote, 'stopTimeline');

    log = new _2.IOSPerformanceLog(remote);
  });
  afterEach(function () {
    startTimelineStub.restore();
    stopTimelineStub.restore();
  });

  it('should be able to start the timeline listening', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(log.startCapture());

        case 2:
          startTimelineStub.calledOnce.should.be['true'];

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should be able to stop the timeline listening', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(log.startCapture());

        case 2:
          startTimelineStub.calledOnce.should.be['true'];
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(log.stopCapture());

        case 5:
          stopTimelineStub.calledOnce.should.be['true'];

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should capture timeline events', function callee$1$0() {
    var message;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(log.startCapture());

        case 2:
          message = 'Some timeline event';

          onTimelineEventCb(message);

          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(log.getLogs());

        case 6:
          context$2$0.t0 = [message];
          context$2$0.sent.should.eql(context$2$0.t0);

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should consume timeline events when logs are retrieved', function callee$1$0() {
    var message;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(log.startCapture());

        case 2:
          message = 'Some timeline event';

          onTimelineEventCb(message);

          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(log.getLogs());

        case 6:
          context$2$0.t0 = [message];
          context$2$0.sent.should.eql(context$2$0.t0);
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(log.getLogs());

        case 10:
          context$2$0.t1 = [];
          context$2$0.sent.should.eql(context$2$0.t1);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9pb3MtcGVyZm9ybWFuY2UtbG9nLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7aUJBRWtDLE9BQU87O3FCQUN2QixPQUFPOzs7O3NCQUNYLFFBQVE7Ozs7b0JBQ0wsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7QUFHN0Msa0JBQUssTUFBTSxFQUFFLENBQUM7QUFDZCxrQkFBSyxHQUFHLDZCQUFnQixDQUFDOztBQUV6QixRQUFRLENBQUMsa0JBQWtCLEVBQUUsWUFBTTtBQUNqQyxNQUFJLGlCQUFpQixZQUFBLENBQUM7QUFDdEIsTUFBSSxHQUFHLFlBQUEsQ0FBQztBQUNSLE1BQUksTUFBTSxHQUFHO0FBQ1gsaUJBQWEsRUFBRSxvQkFBRSxJQUFJO0FBQ3JCLGdCQUFZLEVBQUUsb0JBQUUsSUFBSTtHQUNyQixDQUFDO0FBQ0YsTUFBSSxpQkFBaUIsWUFBQSxDQUFDO0FBQ3RCLE1BQUksZ0JBQWdCLFlBQUEsQ0FBQztBQUNyQixZQUFVLENBQUMsWUFBTTtBQUNmLHFCQUFpQixHQUFHLG1CQUFNLElBQUksQ0FBQyxNQUFNLEVBQUUsZUFBZSxFQUFFLG9CQUFnQixFQUFFOzs7OztBQUN4RSw2QkFBaUIsR0FBRyxFQUFFLENBQUM7Ozs7Ozs7S0FDeEIsQ0FBQyxDQUFDO0FBQ0gsb0JBQWdCLEdBQUcsbUJBQU0sSUFBSSxDQUFDLE1BQU0sRUFBRSxjQUFjLENBQUMsQ0FBQzs7QUFFdEQsT0FBRyxHQUFHLHlCQUFzQixNQUFNLENBQUMsQ0FBQztHQUNyQyxDQUFDLENBQUM7QUFDSCxXQUFTLENBQUMsWUFBTTtBQUNkLHFCQUFpQixDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQzVCLG9CQUFnQixDQUFDLE9BQU8sRUFBRSxDQUFDO0dBQzVCLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsZ0RBQWdELEVBQUU7Ozs7OzJDQUM3QyxHQUFHLENBQUMsWUFBWSxFQUFFOzs7QUFDeEIsMkJBQWlCLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLFFBQUssQ0FBQzs7Ozs7OztHQUM3QyxDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLCtDQUErQyxFQUFFOzs7OzsyQ0FDNUMsR0FBRyxDQUFDLFlBQVksRUFBRTs7O0FBQ3hCLDJCQUFpQixDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFLLENBQUM7OzJDQUN0QyxHQUFHLENBQUMsV0FBVyxFQUFFOzs7QUFDdkIsMEJBQWdCLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLFFBQUssQ0FBQzs7Ozs7OztHQUM1QyxDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLGdDQUFnQyxFQUFFO1FBRy9CLE9BQU87Ozs7OzJDQUZMLEdBQUcsQ0FBQyxZQUFZLEVBQUU7OztBQUVwQixpQkFBTyxHQUFHLHFCQUFxQjs7QUFDbkMsMkJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7OzsyQ0FFcEIsR0FBRyxDQUFDLE9BQU8sRUFBRTs7OzJCQUFhLENBQUMsT0FBTyxDQUFDOzJCQUFwQixNQUFNLENBQUMsR0FBRzs7Ozs7OztHQUNqQyxDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLHdEQUF3RCxFQUFFO1FBR3ZELE9BQU87Ozs7OzJDQUZMLEdBQUcsQ0FBQyxZQUFZLEVBQUU7OztBQUVwQixpQkFBTyxHQUFHLHFCQUFxQjs7QUFDbkMsMkJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7OzsyQ0FFcEIsR0FBRyxDQUFDLE9BQU8sRUFBRTs7OzJCQUFhLENBQUMsT0FBTyxDQUFDOzJCQUFwQixNQUFNLENBQUMsR0FBRzs7MkNBRXpCLEdBQUcsQ0FBQyxPQUFPLEVBQUU7OzsyQkFBYSxFQUFFOzJCQUFiLE1BQU0sQ0FBQyxHQUFHOzs7Ozs7O0dBQ2pDLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L3VuaXQvaW9zLXBlcmZvcm1hbmNlLWxvZy1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRyYW5zcGlsZTptb2NoYVxuXG5pbXBvcnQgeyBJT1NQZXJmb3JtYW5jZUxvZyB9IGZyb20gJy4uLy4uJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5cblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ3BlcmZvcm1hbmNlIGxvZ3MnLCAoKSA9PiB7XG4gIGxldCBvblRpbWVsaW5lRXZlbnRDYjtcbiAgbGV0IGxvZztcbiAgbGV0IHJlbW90ZSA9IHtcbiAgICBzdGFydFRpbWVsaW5lOiBfLm5vb3AsXG4gICAgc3RvcFRpbWVsaW5lOiBfLm5vb3BcbiAgfTtcbiAgbGV0IHN0YXJ0VGltZWxpbmVTdHViO1xuICBsZXQgc3RvcFRpbWVsaW5lU3R1YjtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgc3RhcnRUaW1lbGluZVN0dWIgPSBzaW5vbi5zdHViKHJlbW90ZSwgJ3N0YXJ0VGltZWxpbmUnLCBhc3luYyBmdW5jdGlvbiAoY2IpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by1jYWxsYmFja3NcbiAgICAgIG9uVGltZWxpbmVFdmVudENiID0gY2I7XG4gICAgfSk7XG4gICAgc3RvcFRpbWVsaW5lU3R1YiA9IHNpbm9uLnN0dWIocmVtb3RlLCAnc3RvcFRpbWVsaW5lJyk7XG5cbiAgICBsb2cgPSBuZXcgSU9TUGVyZm9ybWFuY2VMb2cocmVtb3RlKTtcbiAgfSk7XG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgc3RhcnRUaW1lbGluZVN0dWIucmVzdG9yZSgpO1xuICAgIHN0b3BUaW1lbGluZVN0dWIucmVzdG9yZSgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gc3RhcnQgdGhlIHRpbWVsaW5lIGxpc3RlbmluZycsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBsb2cuc3RhcnRDYXB0dXJlKCk7XG4gICAgc3RhcnRUaW1lbGluZVN0dWIuY2FsbGVkT25jZS5zaG91bGQuYmUudHJ1ZTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHN0b3AgdGhlIHRpbWVsaW5lIGxpc3RlbmluZycsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBsb2cuc3RhcnRDYXB0dXJlKCk7XG4gICAgc3RhcnRUaW1lbGluZVN0dWIuY2FsbGVkT25jZS5zaG91bGQuYmUudHJ1ZTtcbiAgICBhd2FpdCBsb2cuc3RvcENhcHR1cmUoKTtcbiAgICBzdG9wVGltZWxpbmVTdHViLmNhbGxlZE9uY2Uuc2hvdWxkLmJlLnRydWU7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY2FwdHVyZSB0aW1lbGluZSBldmVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgbG9nLnN0YXJ0Q2FwdHVyZSgpO1xuXG4gICAgbGV0IG1lc3NhZ2UgPSAnU29tZSB0aW1lbGluZSBldmVudCc7XG4gICAgb25UaW1lbGluZUV2ZW50Q2IobWVzc2FnZSk7XG5cbiAgICAoYXdhaXQgbG9nLmdldExvZ3MoKSkuc2hvdWxkLmVxbChbbWVzc2FnZV0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGNvbnN1bWUgdGltZWxpbmUgZXZlbnRzIHdoZW4gbG9ncyBhcmUgcmV0cmlldmVkJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGxvZy5zdGFydENhcHR1cmUoKTtcblxuICAgIGxldCBtZXNzYWdlID0gJ1NvbWUgdGltZWxpbmUgZXZlbnQnO1xuICAgIG9uVGltZWxpbmVFdmVudENiKG1lc3NhZ2UpO1xuXG4gICAgKGF3YWl0IGxvZy5nZXRMb2dzKCkpLnNob3VsZC5lcWwoW21lc3NhZ2VdKTtcblxuICAgIChhd2FpdCBsb2cuZ2V0TG9ncygpKS5zaG91bGQuZXFsKFtdKTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
