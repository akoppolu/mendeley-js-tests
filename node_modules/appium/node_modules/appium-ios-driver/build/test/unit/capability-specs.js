'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _ = require('../..');

var _libUtils = require('../../lib/utils');

var _libUtils2 = _interopRequireDefault(_libUtils);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _appiumTestSupport = require('appium-test-support');

var _appiumXcode = require('appium-xcode');

var _appiumXcode2 = _interopRequireDefault(_appiumXcode);

var sandbox = _sinon2['default'].sandbox.create();
var should = _chai2['default'].Should();

describe('Desired Capabilities', function () {
  var driver = undefined;
  before(function () {
    driver = new _.IosDriver();
  });

  function checkCaps(caps) {
    var throws = arguments.length <= 1 || arguments[1] === undefined ? false : arguments[1];

    if (throws) {
      should.Throw(function () {
        driver.validateDesiredCaps(caps);
      });
    } else {
      should.not.Throw(function () {
        driver.validateDesiredCaps(caps);
      });
    }
  }

  describe('platform name, app and bundleId', function () {
    it('should throw error if neither app nor bundleId are present', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5'
      };
      checkCaps(caps, true);
    });
    it('should accept an app', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app'
      };
      checkCaps(caps);
    });
    it('should accept a bundleId', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        bundleId: 'com.some-company.some-app'
      };
      checkCaps(caps);
    });
    it('should not be sensitive to platform name casing', function () {
      var caps = {
        platformName: 'IoS',
        deviceName: 'iPhone 5',
        bundleId: 'com.some-company.some-app'
      };
      checkCaps(caps);
    });
  });

  describe('launchTimeout', function () {
    it('should accept a number', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        launchTimeout: 1
      };
      checkCaps(caps);
    });
    it('should accept an object', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        launchTimeout: {
          global: 1
        }
      };
      checkCaps(caps);
    });
    it('should accept a stringified object', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        launchTimeout: JSON.stringify({
          global: 1
        })
      };
      checkCaps(caps);
    });
    it('should fail for non-JSON string', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        launchTimeout: 'launch timeout!'
      };
      checkCaps(caps, true);
    });
  });

  describe('processArguments', function () {
    it('should accept plain string', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        processArguments: 'this is a process argument'
      };
      checkCaps(caps);
    });
    it('should accept an object', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        processArguments: {
          global: 1
        }
      };
      checkCaps(caps);
    });
    it('should accept a stringified object', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        processArguments: JSON.stringify({
          global: 1
        })
      };
      checkCaps(caps);
    });
    it('should fail for non-string, non-object', function () {
      var caps = {
        platformName: 'iOS',
        deviceName: 'iPhone 5',
        app: 'some-app',
        processArguments: 4
      };
      checkCaps(caps, true);
    });
  });

  describe('server capabilities', (0, _appiumTestSupport.withMocks)({ xcode: _appiumXcode2['default'] }, function (mocks) {
    it('should collect server capabilities', function callee$2$0() {
      var caps;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.xcode.expects('getVersion').once().returns({
              versionString: '7.0.0',
              versionFloat: 7.0,
              major: 7,
              minor: 0,
              patch: 0
            });

            sandbox.stub(driver, 'configureApp');
            sandbox.stub(driver, 'validateDesiredCaps');
            sandbox.stub(driver, 'start');
            sandbox.stub(driver, 'startNewCommandTimeout');
            sandbox.stub(_libUtils2['default'], 'detectUdid');
            sandbox.stub(_libUtils2['default'], 'prepareIosOpts');
            caps = {
              platformName: 'iOS',
              deviceName: 'iPhone 5',
              app: 'some-app'
            };
            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(driver.createSession(caps));

          case 10:
            driver.caps.takesScreenshot.should.exist;
            sandbox.restore();

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9jYXBhYmlsaXR5LXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O2dCQUEwQixPQUFPOzt3QkFDZixpQkFBaUI7Ozs7b0JBQ2xCLE1BQU07Ozs7cUJBQ0wsT0FBTzs7OztpQ0FDQyxxQkFBcUI7OzJCQUM3QixjQUFjOzs7O0FBRWhDLElBQUksT0FBTyxHQUFHLG1CQUFNLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNyQyxJQUFNLE1BQU0sR0FBRyxrQkFBSyxNQUFNLEVBQUUsQ0FBQzs7QUFFN0IsUUFBUSxDQUFDLHNCQUFzQixFQUFFLFlBQU07QUFDckMsTUFBSSxNQUFNLFlBQUEsQ0FBQztBQUNYLFFBQU0sQ0FBQyxZQUFNO0FBQ1gsVUFBTSxHQUFHLGlCQUFlLENBQUM7R0FDMUIsQ0FBQyxDQUFDOztBQUVILFdBQVMsU0FBUyxDQUFFLElBQUksRUFBa0I7UUFBaEIsTUFBTSx5REFBRyxLQUFLOztBQUN0QyxRQUFJLE1BQU0sRUFBRTtBQUNWLFlBQU0sQ0FBQyxLQUFLLENBQUMsWUFBWTtBQUN2QixjQUFNLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUM7T0FDbEMsQ0FBQyxDQUFDO0tBQ0osTUFBTTtBQUNMLFlBQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFlBQVk7QUFDM0IsY0FBTSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDO09BQ2xDLENBQUMsQ0FBQztLQUNKO0dBQ0Y7O0FBRUQsVUFBUSxDQUFDLGlDQUFpQyxFQUFFLFlBQU07QUFDaEQsTUFBRSxDQUFDLDREQUE0RCxFQUFFLFlBQU07QUFDckUsVUFBSSxJQUFJLEdBQUc7QUFDVCxvQkFBWSxFQUFFLEtBQUs7QUFDbkIsa0JBQVUsRUFBRSxVQUFVO09BQ3ZCLENBQUM7QUFDRixlQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0tBQ3ZCLENBQUMsQ0FBQztBQUNILE1BQUUsQ0FBQyxzQkFBc0IsRUFBRSxZ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O0FBQ3JDLG1CQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO0FBQzVDLG1CQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztBQUM5QixtQkFBTyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsd0JBQXdCLENBQUMsQ0FBQztBQUMvQyxtQkFBTyxDQUFDLElBQUksd0JBQVEsWUFBWSxDQUFDLENBQUM7QUFDbEMsbUJBQU8sQ0FBQyxJQUFJLHdCQUFRLGdCQUFnQixDQUFDLENBQUM7QUFDbEMsZ0JBQUksR0FBRztBQUNULDBCQUFZLEVBQUUsS0FBSztBQUNuQix3QkFBVSxFQUFFLFVBQVU7QUFDdEIsaUJBQUcsRUFBRSxVQUFVO2FBQ2hCOzs2Q0FDSyxNQUFNLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQzs7O0FBQ2hDLGtCQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ3pDLG1CQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7Ozs7Ozs7S0FDbkIsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDLENBQUM7Q0FDTCxDQUFDLENBQUMiLCJmaWxlIjoidGVzdC91bml0L2NhcGFiaWxpdHktc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJb3NEcml2ZXIgfSBmcm9tICcuLi8uLic7XG5pbXBvcnQgdXRpbHMgZnJvbSAnLi4vLi4vbGliL3V0aWxzJztcbmltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCB7IHdpdGhNb2NrcyB9IGZyb20gJ2FwcGl1bS10ZXN0LXN1cHBvcnQnO1xuaW1wb3J0IHhjb2RlIGZyb20gJ2FwcGl1bS14Y29kZSc7XG5cbmxldCBzYW5kYm94ID0gc2lub24uc2FuZGJveC5jcmVhdGUoKTtcbmNvbnN0IHNob3VsZCA9IGNoYWkuU2hvdWxkKCk7XG5cbmRlc2NyaWJlKCdEZXNpcmVkIENhcGFiaWxpdGllcycsICgpID0+IHtcbiAgbGV0IGRyaXZlcjtcbiAgYmVmb3JlKCgpID0+IHtcbiAgICBkcml2ZXIgPSBuZXcgSW9zRHJpdmVyKCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIGNoZWNrQ2FwcyAoY2FwcywgdGhyb3dzID0gZmFsc2UpIHtcbiAgICBpZiAodGhyb3dzKSB7XG4gICAgICBzaG91bGQuVGhyb3coZnVuY3Rpb24gKCkge1xuICAgICAgICBkcml2ZXIudmFsaWRhdGVEZXNpcmVkQ2FwcyhjYXBzKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaG91bGQubm90LlRocm93KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZHJpdmVyLnZhbGlkYXRlRGVzaXJlZENhcHMoY2Fwcyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBkZXNjcmliZSgncGxhdGZvcm0gbmFtZSwgYXBwIGFuZCBidW5kbGVJZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGlmIG5laXRoZXIgYXBwIG5vciBidW5kbGVJZCBhcmUgcHJlc2VudCcsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnXG4gICAgICB9O1xuICAgICAgY2hlY2tDYXBzKGNhcHMsIHRydWUpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgYWNjZXB0IGFuIGFwcCcsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBhcHA6ICdzb21lLWFwcCdcbiAgICAgIH07XG4gICAgICBjaGVja0NhcHMoY2Fwcyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgYSBidW5kbGVJZCcsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBidW5kbGVJZDogJ2NvbS5zb21lLWNvbXBhbnkuc29tZS1hcHAnXG4gICAgICB9O1xuICAgICAgY2hlY2tDYXBzKGNhcHMpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbm90IGJlIHNlbnNpdGl2ZSB0byBwbGF0Zm9ybSBuYW1lIGNhc2luZycsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdJb1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBidW5kbGVJZDogJ2NvbS5zb21lLWNvbXBhbnkuc29tZS1hcHAnXG4gICAgICB9O1xuICAgICAgY2hlY2tDYXBzKGNhcHMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbGF1bmNoVGltZW91dCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBhIG51bWJlcicsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBhcHA6ICdzb21lLWFwcCcsXG4gICAgICAgIGxhdW5jaFRpbWVvdXQ6IDFcbiAgICAgIH07XG4gICAgICBjaGVja0NhcHMoY2Fwcyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBhY2NlcHQgYW4gb2JqZWN0JywgKCkgPT4ge1xuICAgICAgbGV0IGNhcHMgPSB7XG4gICAgICAgIHBsYXRmb3JtTmFtZTogJ2lPUycsXG4gICAgICAgIGRldmljZU5hbWU6ICdpUGhvbmUgNScsXG4gICAgICAgIGFwcDogJ3NvbWUtYXBwJyxcbiAgICAgICAgbGF1bmNoVGltZW91dDoge1xuICAgICAgICAgIGdsb2JhbDogMVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgY2hlY2tDYXBzKGNhcHMpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgYWNjZXB0IGEgc3RyaW5naWZpZWQgb2JqZWN0JywgKCkgPT4ge1xuICAgICAgbGV0IGNhcHMgPSB7XG4gICAgICAgIHBsYXRmb3JtTmFtZTogJ2lPUycsXG4gICAgICAgIGRldmljZU5hbWU6ICdpUGhvbmUgNScsXG4gICAgICAgIGFwcDogJ3NvbWUtYXBwJyxcbiAgICAgICAgbGF1bmNoVGltZW91dDogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGdsb2JhbDogMVxuICAgICAgICB9KVxuICAgICAgfTtcbiAgICAgIGNoZWNrQ2FwcyhjYXBzKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGZhaWwgZm9yIG5vbi1KU09OIHN0cmluZycsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBhcHA6ICdzb21lLWFwcCcsXG4gICAgICAgIGxhdW5jaFRpbWVvdXQ6ICdsYXVuY2ggdGltZW91dCEnXG4gICAgICB9O1xuICAgICAgY2hlY2tDYXBzKGNhcHMsIHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncHJvY2Vzc0FyZ3VtZW50cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBwbGFpbiBzdHJpbmcnLCAoKSA9PiB7XG4gICAgICBsZXQgY2FwcyA9IHtcbiAgICAgICAgcGxhdGZvcm1OYW1lOiAnaU9TJyxcbiAgICAgICAgZGV2aWNlTmFtZTogJ2lQaG9uZSA1JyxcbiAgICAgICAgYXBwOiAnc29tZS1hcHAnLFxuICAgICAgICBwcm9jZXNzQXJndW1lbnRzOiAndGhpcyBpcyBhIHByb2Nlc3MgYXJndW1lbnQnXG4gICAgICB9O1xuICAgICAgY2hlY2tDYXBzKGNhcHMpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgYWNjZXB0IGFuIG9iamVjdCcsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBhcHA6ICdzb21lLWFwcCcsXG4gICAgICAgIHByb2Nlc3NBcmd1bWVudHM6IHtcbiAgICAgICAgICBnbG9iYWw6IDFcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNoZWNrQ2FwcyhjYXBzKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBhIHN0cmluZ2lmaWVkIG9iamVjdCcsICgpID0+IHtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBhcHA6ICdzb21lLWFwcCcsXG4gICAgICAgIHByb2Nlc3NBcmd1bWVudHM6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBnbG9iYWw6IDFcbiAgICAgICAgfSlcbiAgICAgIH07XG4gICAgICBjaGVja0NhcHMoY2Fwcyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBmYWlsIGZvciBub24tc3RyaW5nLCBub24tb2JqZWN0JywgKCkgPT4ge1xuICAgICAgbGV0IGNhcHMgPSB7XG4gICAgICAgIHBsYXRmb3JtTmFtZTogJ2lPUycsXG4gICAgICAgIGRldmljZU5hbWU6ICdpUGhvbmUgNScsXG4gICAgICAgIGFwcDogJ3NvbWUtYXBwJyxcbiAgICAgICAgcHJvY2Vzc0FyZ3VtZW50czogNFxuICAgICAgfTtcbiAgICAgIGNoZWNrQ2FwcyhjYXBzLCB0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NlcnZlciBjYXBhYmlsaXRpZXMnLCB3aXRoTW9ja3Moe3hjb2RlfSwgKG1vY2tzKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjb2xsZWN0IHNlcnZlciBjYXBhYmlsaXRpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2Nrcy54Y29kZS5leHBlY3RzKCdnZXRWZXJzaW9uJylcbiAgICAgICAgLm9uY2UoKS5yZXR1cm5zKHtcbiAgICAgICAgICB2ZXJzaW9uU3RyaW5nOiAnNy4wLjAnLFxuICAgICAgICAgIHZlcnNpb25GbG9hdDogNy4wLFxuICAgICAgICAgIG1ham9yOiA3LFxuICAgICAgICAgIG1pbm9yOiAwLFxuICAgICAgICAgIHBhdGNoOiAwXG4gICAgICAgIH0pO1xuXG4gICAgICBzYW5kYm94LnN0dWIoZHJpdmVyLCAnY29uZmlndXJlQXBwJyk7XG4gICAgICBzYW5kYm94LnN0dWIoZHJpdmVyLCAndmFsaWRhdGVEZXNpcmVkQ2FwcycpO1xuICAgICAgc2FuZGJveC5zdHViKGRyaXZlciwgJ3N0YXJ0Jyk7XG4gICAgICBzYW5kYm94LnN0dWIoZHJpdmVyLCAnc3RhcnROZXdDb21tYW5kVGltZW91dCcpO1xuICAgICAgc2FuZGJveC5zdHViKHV0aWxzLCAnZGV0ZWN0VWRpZCcpO1xuICAgICAgc2FuZGJveC5zdHViKHV0aWxzLCAncHJlcGFyZUlvc09wdHMnKTtcbiAgICAgIGxldCBjYXBzID0ge1xuICAgICAgICBwbGF0Zm9ybU5hbWU6ICdpT1MnLFxuICAgICAgICBkZXZpY2VOYW1lOiAnaVBob25lIDUnLFxuICAgICAgICBhcHA6ICdzb21lLWFwcCdcbiAgICAgIH07XG4gICAgICBhd2FpdCBkcml2ZXIuY3JlYXRlU2Vzc2lvbihjYXBzKTtcbiAgICAgIGRyaXZlci5jYXBzLnRha2VzU2NyZWVuc2hvdC5zaG91bGQuZXhpc3Q7XG4gICAgICBzYW5kYm94LnJlc3RvcmUoKTtcbiAgICB9KTtcbiAgfSkpO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
