'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _setupBase = require("../setup-base");

var _setupBase2 = _interopRequireDefault(_setupBase);

var _helpersEnv = require('../helpers/env');

var _helpersEnv2 = _interopRequireDefault(_helpersEnv);

var _helpersSession = require('../helpers/session');

// TODO: fix page load handling in appium-remote-debugger
// right now it is not respected, so we need to skip
describe.skip('safari - page load timeout', function () {
  this.timeout(_helpersSession.MOCHA_SAFARI_TIMEOUT);

  var driver = (0, _setupBase2['default'])(this, {
    browserName: 'safari',
    fullReset: true
  }).driver;

  describe('small timeout, slow page load', function () {
    var _this = this;

    it('should not go to the requested page', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.timeouts('page load', 5000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.setUrl(_helpersEnv2['default'].GUINEA_TEST_END_POINT + '?delay=30000'));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(driver.getPageSource());

          case 6:
            context$3$0.sent.should.include('Let\'s browse!');

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('no timeout, very slow page', function () {
    var _this2 = this;

    var startMs = Date.now();

    it('should go to the requested page', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.timeouts('command', 120000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.timeouts('page load', 0));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(driver.setUrl(_helpersEnv2['default'].GUINEA_TEST_END_POINT + '?delay=5000'));

          case 6:
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(driver.getPageSource());

          case 8:
            context$3$0.sent.should.include('I am some page content');

            (Date.now() - startMs).should.be.above(5000);

          case 10:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});

// the page should not have time to load

// the page should load after 70000
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3NhZmFyaS9wYWdlLWxvYWQtdGltZW91dC1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7eUJBQWtCLGVBQWU7Ozs7MEJBQ2pCLGdCQUFnQjs7Ozs4QkFDSyxvQkFBb0I7Ozs7QUFLekQsUUFBUSxDQUFDLElBQUksQ0FBQyw0QkFBNEIsRUFBRSxZQUFZO0FBQ3RELE1BQUksQ0FBQyxPQUFPLHNDQUFzQixDQUFDOztBQUVuQyxNQUFNLE1BQU0sR0FBRyw0QkFBTSxJQUFJLEVBQUU7QUFDekIsZUFBVyxFQUFFLFFBQVE7QUFDckIsYUFBUyxFQUFFLElBQUk7R0FDaEIsQ0FBQyxDQUFDLE1BQU0sQ0FBQzs7QUFFVixVQUFRLENBQUMsK0JBQStCLEVBQUUsWUFBWTs7O0FBQ3BELE1BQUUsQ0FBQyxxQ0FBcUMsRUFBRTs7Ozs7NkNBQ2xDLE1BQU0sQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQzs7Ozs2Q0FDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyx3QkFBSSxxQkFBcUIsR0FBRyxjQUFjLENBQUM7Ozs7NkNBR3hELE1BQU0sQ0FBQyxhQUFhLEVBQUU7Ozs2QkFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLGdCQUFnQjs7Ozs7OztLQUMvRCxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7O0FBRUgsVUFBUSxDQUFDLDRCQUE0QixFQUFFLFlBQVk7OztBQUNqRCxRQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7O0FBRXpCLE1BQUUsQ0FBQyxpQ0FBaUMsRUFBRTs7Ozs7NkNBQzlCLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQzs7Ozs2Q0FDbEMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDOzs7OzZDQUMvQixNQUFNLENBQUMsTUFBTSxDQUFDLHdCQUFJLHFCQUFxQixHQUFHLGFBQWEsQ0FBQzs7Ozs2Q0FHdkQsTUFBTSxDQUFDLGFBQWEsRUFBRTs7OzZCQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsd0JBQXdCOztBQUN0RSxhQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxPQUFPLENBQUEsQ0FBRSxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQzs7Ozs7OztLQUM5QyxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvc2FmYXJpL3BhZ2UtbG9hZC10aW1lb3V0LXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHNldHVwIGZyb20gXCIuLi9zZXR1cC1iYXNlXCI7XG5pbXBvcnQgZW52IGZyb20gJy4uL2hlbHBlcnMvZW52JztcbmltcG9ydCB7IE1PQ0hBX1NBRkFSSV9USU1FT1VUIH0gZnJvbSAnLi4vaGVscGVycy9zZXNzaW9uJztcblxuXG4vLyBUT0RPOiBmaXggcGFnZSBsb2FkIGhhbmRsaW5nIGluIGFwcGl1bS1yZW1vdGUtZGVidWdnZXJcbi8vIHJpZ2h0IG5vdyBpdCBpcyBub3QgcmVzcGVjdGVkLCBzbyB3ZSBuZWVkIHRvIHNraXBcbmRlc2NyaWJlLnNraXAoJ3NhZmFyaSAtIHBhZ2UgbG9hZCB0aW1lb3V0JywgZnVuY3Rpb24gKCkge1xuICB0aGlzLnRpbWVvdXQoTU9DSEFfU0FGQVJJX1RJTUVPVVQpO1xuXG4gIGNvbnN0IGRyaXZlciA9IHNldHVwKHRoaXMsIHtcbiAgICBicm93c2VyTmFtZTogJ3NhZmFyaScsXG4gICAgZnVsbFJlc2V0OiB0cnVlLFxuICB9KS5kcml2ZXI7XG5cbiAgZGVzY3JpYmUoJ3NtYWxsIHRpbWVvdXQsIHNsb3cgcGFnZSBsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgbm90IGdvIHRvIHRoZSByZXF1ZXN0ZWQgcGFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGRyaXZlci50aW1lb3V0cygncGFnZSBsb2FkJywgNTAwMCk7XG4gICAgICBhd2FpdCBkcml2ZXIuc2V0VXJsKGVudi5HVUlORUFfVEVTVF9FTkRfUE9JTlQgKyAnP2RlbGF5PTMwMDAwJyk7XG5cbiAgICAgIC8vIHRoZSBwYWdlIHNob3VsZCBub3QgaGF2ZSB0aW1lIHRvIGxvYWRcbiAgICAgIChhd2FpdCBkcml2ZXIuZ2V0UGFnZVNvdXJjZSgpKS5zaG91bGQuaW5jbHVkZSgnTGV0XFwncyBicm93c2UhJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdubyB0aW1lb3V0LCB2ZXJ5IHNsb3cgcGFnZScsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgc3RhcnRNcyA9IERhdGUubm93KCk7XG5cbiAgICBpdCgnc2hvdWxkIGdvIHRvIHRoZSByZXF1ZXN0ZWQgcGFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGRyaXZlci50aW1lb3V0cygnY29tbWFuZCcsIDEyMDAwMCk7XG4gICAgICBhd2FpdCBkcml2ZXIudGltZW91dHMoJ3BhZ2UgbG9hZCcsIDApO1xuICAgICAgYXdhaXQgZHJpdmVyLnNldFVybChlbnYuR1VJTkVBX1RFU1RfRU5EX1BPSU5UICsgJz9kZWxheT01MDAwJyk7XG5cbiAgICAgIC8vIHRoZSBwYWdlIHNob3VsZCBsb2FkIGFmdGVyIDcwMDAwXG4gICAgICAoYXdhaXQgZHJpdmVyLmdldFBhZ2VTb3VyY2UoKSkuc2hvdWxkLmluY2x1ZGUoJ0kgYW0gc29tZSBwYWdlIGNvbnRlbnQnKTtcbiAgICAgIChEYXRlLm5vdygpIC0gc3RhcnRNcykuc2hvdWxkLmJlLmFib3ZlKDUwMDApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLiJ9
