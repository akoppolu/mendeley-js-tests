'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _safariSetup = require('../safari-setup');

var _safariSetup2 = _interopRequireDefault(_safariSetup);

var _helpersWebview = require('../../helpers/webview');

var _helpersEnv = require('../../helpers/env');

var _helpersEnv2 = _interopRequireDefault(_helpersEnv);

var _helpersSession = require('../../helpers/session');

describe('safari - webview - cookies', function () {
  this.timeout(_helpersSession.MOCHA_SAFARI_TIMEOUT);

  var driver = (0, _safariSetup2['default'])(this, _desired2['default']).driver;

  describe('within iframe webview', function () {
    var _this = this;

    it('should be able to get cookies for a page with none', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver, _helpersEnv2['default'].TEST_END_POINT + 'iframes.html', 'Iframe guinea pig'));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.deleteCookies());

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(driver.setUrl(_helpersEnv2['default'].TEST_END_POINT));

          case 6:
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 8:
            context$3$0.sent.should.have.length(0);

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('within webview', function () {
    var _this2 = this;

    beforeEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver));

          case 2:
            return context$3$0.abrupt('return', context$3$0.sent);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to get cookies for a page', function callee$2$0() {
      var cookies;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 2:
            cookies = context$3$0.sent;

            cookies.length.should.equal(2);
            cookies[0].name.should.equal('guineacookie1');
            cookies[0].value.should.equal('i am a cookie value');
            cookies[1].name.should.equal('guineacookie2');
            cookies[1].value.should.equal('cooki√©2');

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to set a cookie for a page', function callee$2$0() {
      var newCookie, cookies;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            newCookie = {
              name: 'newcookie',
              value: 'i\'m new here'
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.deleteCookie(newCookie.name));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 5:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);

            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(driver.setCookie(newCookie));

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 12:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.include(newCookie.value);
            // should not clobber old cookies
            cookies.map(function (c) {
              return c.name;
            }).should.include('guineacookie1');
            cookies.map(function (c) {
              return c.value;
            }).should.include('i am a cookie value');

          case 17:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to set a cookie with expiry', function callee$2$0() {
      var newCookie, cookies;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            newCookie = {
              name: 'newcookie',
              value: 'i\'m new here'
            };

            newCookie.expiry = parseInt(Date.now() / 1000, 10) - 1000; // set cookie in past

            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.deleteCookie(newCookie.name));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 6:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);

            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(driver.setCookie(newCookie));

          case 11:
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 13:
            cookies = context$3$0.sent;

            // should not include cookie we just added because of expiry
            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);
            // should not clobber old cookies
            cookies.map(function (c) {
              return c.name;
            }).should.include('guineacookie1');
            cookies.map(function (c) {
              return c.value;
            }).should.include('i am a cookie value');

          case 18:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to delete one cookie', function callee$2$0() {
      var newCookie, cookies;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            newCookie = {
              name: 'newcookie',
              value: 'i\'m new here'
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.deleteCookie(newCookie.name));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 5:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);

            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(driver.setCookie(newCookie));

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 12:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.include(newCookie.value);

            context$3$0.next = 17;
            return _regeneratorRuntime.awrap(driver.deleteCookie('newcookie'));

          case 17:
            context$3$0.next = 19;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 19:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);

          case 22:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to delete all cookie', function callee$2$0() {
      var newCookie, cookies;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            newCookie = {
              name: 'newcookie',
              value: 'i\'m new here'
            };
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.deleteCookie(newCookie.name));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 5:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.not.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.not.include(newCookie.value);

            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(driver.setCookie(newCookie));

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 12:
            cookies = context$3$0.sent;

            cookies.map(function (c) {
              return c.name;
            }).should.include(newCookie.name);
            cookies.map(function (c) {
              return c.value;
            }).should.include(newCookie.value);

            context$3$0.next = 17;
            return _regeneratorRuntime.awrap(driver.deleteCookies());

          case 17:
            context$3$0.next = 19;
            return _regeneratorRuntime.awrap(driver.getCookies());

          case 19:
            cookies = context$3$0.sent;

            cookies.length.should.equal(0);

          case 21:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3NhZmFyaS93ZWJ2aWV3L2Nvb2tpZXMtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O3VCQUFvQixXQUFXOzs7OzJCQUNiLGlCQUFpQjs7Ozs4QkFDUCx1QkFBdUI7OzBCQUNuQyxtQkFBbUI7Ozs7OEJBQ0UsdUJBQXVCOztBQUU1RCxRQUFRLENBQUMsNEJBQTRCLEVBQUUsWUFBWTtBQUNqRCxNQUFJLENBQUMsT0FBTyxzQ0FBc0IsQ0FBQzs7QUFFbkMsTUFBTSxNQUFNLEdBQUcsOEJBQU0sSUFBSSx1QkFBVSxDQUFDLE1BQU0sQ0FBQzs7QUFFM0MsVUFBUSxDQUFDLHVCQUF1QixFQUFFLFlBQVk7OztBQUM1QyxNQUFFLENBQUMsb0RBQW9ELEVBQUU7Ozs7OzZDQUNqRCx1REFBcUIsTUFBTSxFQUFFLHdCQUFJLGNBQWMsR0FBRyxjQUFjLEVBQUUsbUJBQW1CLENBQUM7Ozs7NkNBQ3RGLE1BQU0sQ0FBQyxhQUFhLEVBQUU7Ozs7NkNBQ3RCLE1BQU0sQ0FBQyxNQUFNLENBQUMsd0JBQUksY0FBYyxDQUFDOzs7OzZDQUNoQyxNQUFNLENBQUMsVUFBVSxFQUFFOzs7NkJBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQzs7Ozs7OztLQUNqRCxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7O0FBRUgsVUFBUSxDQUFDLGdCQUFnQixFQUFFLFlBQVk7OztBQUNyQyxjQUFVLENBQUM7Ozs7OzZDQUFrQix1REFBcUIsTUFBTSxDQUFDOzs7Ozs7Ozs7O0tBQUEsQ0FBQyxDQUFDOztBQUUzRCxNQUFFLENBQUMsMENBQTBDLEVBQUU7VUFDekMsT0FBTzs7Ozs7NkNBQVMsTUFBTSxDQUFDLFVBQVUsRUFBRTs7O0FBQW5DLG1CQUFPOztBQUNYLG1CQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDL0IsbUJBQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMs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QUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvc2FmYXJpL3dlYnZpZXcvY29va2llcy1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkZXNpcmVkIGZyb20gJy4vZGVzaXJlZCc7XG5pbXBvcnQgc2V0dXAgZnJvbSAnLi4vc2FmYXJpLXNldHVwJztcbmltcG9ydCB7IGxvYWRXZWJWaWV3IH0gZnJvbSAnLi4vLi4vaGVscGVycy93ZWJ2aWV3JztcbmltcG9ydCBlbnYgZnJvbSAnLi4vLi4vaGVscGVycy9lbnYnO1xuaW1wb3J0IHsgTU9DSEFfU0FGQVJJX1RJTUVPVVQgfSBmcm9tICcuLi8uLi9oZWxwZXJzL3Nlc3Npb24nO1xuXG5kZXNjcmliZSgnc2FmYXJpIC0gd2VidmlldyAtIGNvb2tpZXMnLCBmdW5jdGlvbiAoKSB7XG4gIHRoaXMudGltZW91dChNT0NIQV9TQUZBUklfVElNRU9VVCk7XG5cbiAgY29uc3QgZHJpdmVyID0gc2V0dXAodGhpcywgZGVzaXJlZCkuZHJpdmVyO1xuXG4gIGRlc2NyaWJlKCd3aXRoaW4gaWZyYW1lIHdlYnZpZXcnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIGdldCBjb29raWVzIGZvciBhIHBhZ2Ugd2l0aCBub25lJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgbG9hZFdlYlZpZXcoZGVzaXJlZCwgZHJpdmVyLCBlbnYuVEVTVF9FTkRfUE9JTlQgKyAnaWZyYW1lcy5odG1sJywgJ0lmcmFtZSBndWluZWEgcGlnJyk7XG4gICAgICBhd2FpdCBkcml2ZXIuZGVsZXRlQ29va2llcygpO1xuICAgICAgYXdhaXQgZHJpdmVyLnNldFVybChlbnYuVEVTVF9FTkRfUE9JTlQpO1xuICAgICAgKGF3YWl0IGRyaXZlci5nZXRDb29raWVzKCkpLnNob3VsZC5oYXZlLmxlbmd0aCgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3dpdGhpbiB3ZWJ2aWV3JywgZnVuY3Rpb24gKCkge1xuICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4gYXdhaXQgbG9hZFdlYlZpZXcoZGVzaXJlZCwgZHJpdmVyKSk7XG5cbiAgICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gZ2V0IGNvb2tpZXMgZm9yIGEgcGFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBjb29raWVzID0gYXdhaXQgZHJpdmVyLmdldENvb2tpZXMoKTtcbiAgICAgIGNvb2tpZXMubGVuZ3RoLnNob3VsZC5lcXVhbCgyKTtcbiAgICAgIGNvb2tpZXNbMF0ubmFtZS5zaG91bGQuZXF1YWwoJ2d1aW5lYWNvb2tpZTEnKTtcbiAgICAgIGNvb2tpZXNbMF0udmFsdWUuc2hvdWxkLmVxdWFsKCdpIGFtIGEgY29va2llIHZhbHVlJyk7XG4gICAgICBjb29raWVzWzFdLm5hbWUuc2hvdWxkLmVxdWFsKCdndWluZWFjb29raWUyJyk7XG4gICAgICBjb29raWVzWzFdLnZhbHVlLnNob3VsZC5lcXVhbCgnY29va2nDqTInKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byBzZXQgYSBjb29raWUgZm9yIGEgcGFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBuZXdDb29raWUgPSB7XG4gICAgICAgIG5hbWU6IGBuZXdjb29raWVgLFxuICAgICAgICB2YWx1ZTogYGknbSBuZXcgaGVyZWBcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGRyaXZlci5kZWxldGVDb29raWUobmV3Q29va2llLm5hbWUpO1xuICAgICAgbGV0IGNvb2tpZXMgPSBhd2FpdCBkcml2ZXIuZ2V0Q29va2llcygpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMubmFtZSkuc2hvdWxkLm5vdC5pbmNsdWRlKG5ld0Nvb2tpZS5uYW1lKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLnZhbHVlKS5zaG91bGQubm90LmluY2x1ZGUobmV3Q29va2llLnZhbHVlKTtcblxuICAgICAgYXdhaXQgZHJpdmVyLnNldENvb2tpZShuZXdDb29raWUpO1xuICAgICAgY29va2llcyA9IGF3YWl0IGRyaXZlci5nZXRDb29raWVzKCk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy5uYW1lKS5zaG91bGQuaW5jbHVkZShuZXdDb29raWUubmFtZSk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy52YWx1ZSkuc2hvdWxkLmluY2x1ZGUobmV3Q29va2llLnZhbHVlKTtcbiAgICAgIC8vIHNob3VsZCBub3QgY2xvYmJlciBvbGQgY29va2llc1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMubmFtZSkuc2hvdWxkLmluY2x1ZGUoJ2d1aW5lYWNvb2tpZTEnKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLnZhbHVlKS5zaG91bGQuaW5jbHVkZSgnaSBhbSBhIGNvb2tpZSB2YWx1ZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHNldCBhIGNvb2tpZSB3aXRoIGV4cGlyeScsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBuZXdDb29raWUgPSB7XG4gICAgICAgIG5hbWU6IGBuZXdjb29raWVgLFxuICAgICAgICB2YWx1ZTogYGknbSBuZXcgaGVyZWBcbiAgICAgIH07XG4gICAgICBuZXdDb29raWUuZXhwaXJ5ID0gcGFyc2VJbnQoRGF0ZS5ub3coKSAvIDEwMDAsIDEwKSAtIDEwMDA7IC8vIHNldCBjb29raWUgaW4gcGFzdFxuXG4gICAgICBhd2FpdCBkcml2ZXIuZGVsZXRlQ29va2llKG5ld0Nvb2tpZS5uYW1lKTtcbiAgICAgIGxldCBjb29raWVzID0gYXdhaXQgZHJpdmVyLmdldENvb2tpZXMoKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLm5hbWUpLnNob3VsZC5ub3QuaW5jbHVkZShuZXdDb29raWUubmFtZSk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy52YWx1ZSkuc2hvdWxkLm5vdC5pbmNsdWRlKG5ld0Nvb2tpZS52YWx1ZSk7XG5cbiAgICAgIGF3YWl0IGRyaXZlci5zZXRDb29raWUobmV3Q29va2llKTtcbiAgICAgIGNvb2tpZXMgPSBhd2FpdCBkcml2ZXIuZ2V0Q29va2llcygpO1xuICAgICAgLy8gc2hvdWxkIG5vdCBpbmNsdWRlIGNvb2tpZSB3ZSBqdXN0IGFkZGVkIGJlY2F1c2Ugb2YgZXhwaXJ5XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy5uYW1lKS5zaG91bGQubm90LmluY2x1ZGUobmV3Q29va2llLm5hbWUpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMudmFsdWUpLnNob3VsZC5ub3QuaW5jbHVkZShuZXdDb29raWUudmFsdWUpO1xuICAgICAgLy8gc2hvdWxkIG5vdCBjbG9iYmVyIG9sZCBjb29raWVzXG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy5uYW1lKS5zaG91bGQuaW5jbHVkZSgnZ3VpbmVhY29va2llMScpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMudmFsdWUpLnNob3VsZC5pbmNsdWRlKCdpIGFtIGEgY29va2llIHZhbHVlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gZGVsZXRlIG9uZSBjb29raWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICB2YXIgbmV3Q29va2llID0ge1xuICAgICAgICBuYW1lOiBgbmV3Y29va2llYCxcbiAgICAgICAgdmFsdWU6IGBpJ20gbmV3IGhlcmVgXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBkcml2ZXIuZGVsZXRlQ29va2llKG5ld0Nvb2tpZS5uYW1lKTtcbiAgICAgIGxldCBjb29raWVzID0gYXdhaXQgZHJpdmVyLmdldENvb2tpZXMoKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLm5hbWUpLnNob3VsZC5ub3QuaW5jbHVkZShuZXdDb29raWUubmFtZSk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy52YWx1ZSkuc2hvdWxkLm5vdC5pbmNsdWRlKG5ld0Nvb2tpZS52YWx1ZSk7XG5cbiAgICAgIGF3YWl0IGRyaXZlci5zZXRDb29raWUobmV3Q29va2llKTtcbiAgICAgIGNvb2tpZXMgPSBhd2FpdCBkcml2ZXIuZ2V0Q29va2llcygpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMubmFtZSkuc2hvdWxkLmluY2x1ZGUobmV3Q29va2llLm5hbWUpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMudmFsdWUpLnNob3VsZC5pbmNsdWRlKG5ld0Nvb2tpZS52YWx1ZSk7XG5cbiAgICAgIGF3YWl0IGRyaXZlci5kZWxldGVDb29raWUoJ25ld2Nvb2tpZScpO1xuICAgICAgY29va2llcyA9IGF3YWl0IGRyaXZlci5nZXRDb29raWVzKCk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy5uYW1lKS5zaG91bGQubm90LmluY2x1ZGUobmV3Q29va2llLm5hbWUpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMudmFsdWUpLnNob3VsZC5ub3QuaW5jbHVkZShuZXdDb29raWUudmFsdWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIGRlbGV0ZSBhbGwgY29va2llJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IG5ld0Nvb2tpZSA9IHtcbiAgICAgICAgbmFtZTogYG5ld2Nvb2tpZWAsXG4gICAgICAgIHZhbHVlOiBgaSdtIG5ldyBoZXJlYFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgZHJpdmVyLmRlbGV0ZUNvb2tpZShuZXdDb29raWUubmFtZSk7XG4gICAgICBsZXQgY29va2llcyA9IGF3YWl0IGRyaXZlci5nZXRDb29raWVzKCk7XG4gICAgICBjb29raWVzLm1hcCgoYykgPT4gYy5uYW1lKS5zaG91bGQubm90LmluY2x1ZGUobmV3Q29va2llLm5hbWUpO1xuICAgICAgY29va2llcy5tYXAoKGMpID0+IGMudmFsdWUpLnNob3VsZC5ub3QuaW5jbHVkZShuZXdDb29raWUudmFsdWUpO1xuXG4gICAgICBhd2FpdCBkcml2ZXIuc2V0Q29va2llKG5ld0Nvb2tpZSk7XG4gICAgICBjb29raWVzID0gYXdhaXQgZHJpdmVyLmdldENvb2tpZXMoKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLm5hbWUpLnNob3VsZC5pbmNsdWRlKG5ld0Nvb2tpZS5uYW1lKTtcbiAgICAgIGNvb2tpZXMubWFwKChjKSA9PiBjLnZhbHVlKS5zaG91bGQuaW5jbHVkZShuZXdDb29raWUudmFsdWUpO1xuXG4gICAgICBhd2FpdCBkcml2ZXIuZGVsZXRlQ29va2llcygpO1xuICAgICAgY29va2llcyA9IGF3YWl0IGRyaXZlci5nZXRDb29raWVzKCk7XG4gICAgICBjb29raWVzLmxlbmd0aC5zaG91bGQuZXF1YWwoMCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uLy4uIn0=
