/* globals expect */
'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Object$assign = require('babel-runtime/core-js/object/assign')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _safariSetup = require('../safari-setup');

var _safariSetup2 = _interopRequireDefault(_safariSetup);

var _helpersWebview = require('../../helpers/webview');

var _helpersSession = require('../../helpers/session');

var SCROLL_INTO_VIEW = 'return arguments[0].scrollIntoView(true);';
var GET_RIGHT_INNERHTML = 'return document.body.innerHTML.indexOf(\'I am some page content\') > 0';
var GET_WRONG_INNERHTML = 'return document.body.innerHTML.indexOf(\'I am not some page content\') > 0';
var GET_ELEM_BY_TAGNAME = 'return document.getElementsByTagName(\'a\');';

describe('safari - webview - execute', function () {
  this.timeout(_helpersSession.MOCHA_SAFARI_TIMEOUT);

  describe('http', function () {
    var _this = this;

    var driver = (0, _safariSetup2['default'])(this, _desired2['default']).driver;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver));

          case 2:
            return context$3$0.abrupt('return', context$3$0.sent);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    after(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.deleteSession());

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    describe('synchronous', function () {
      var _this2 = this;

      it('should bubble up javascript errors', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute('\'nan\'--').should.eventually.be.rejected);

            case 2:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this2);
      });

      it('should eval javascript', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute('return 1'));

            case 2:
              context$4$0.sent.should.be.equal(1);

            case 3:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this2);
      });

      it('should not be returning hardcoded results', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute('return 1+1'));

            case 2:
              context$4$0.sent.should.be.equal(2);

            case 3:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this2);
      });

      it('should return nothing when you don\'t explicitly return', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute('1+1'));

            case 2:
              context$4$0.t0 = context$4$0.sent;
              expect(context$4$0.t0).to.not.exist;

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this2);
      });

      it('should execute code inside the web view', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute(GET_RIGHT_INNERHTML));

            case 2:
              context$4$0.sent.should.be.ok;
              context$4$0.next = 5;
              return _regeneratorRuntime.awrap(driver.execute(GET_WRONG_INNERHTML));

            case 5:
              context$4$0.sent.should.not.be.ok;

            case 6:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this2);
      });

      it('should convert selenium element arg to webview element', function callee$3$0() {
        var el;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.findElement('id', 'useragent'));

            case 2:
              el = context$4$0.sent;
              context$4$0.next = 5;
              return _regeneratorRuntime.awrap(driver.execute(SCROLL_INTO_VIEW, [el]));

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this2);
      });

      it('should catch stale or undefined element as arg', function callee$3$0() {
        var el;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.findElement('id', 'useragent'));

            case 2:
              el = context$4$0.sent;
              return context$4$0.abrupt('return', driver.execute(SCROLL_INTO_VIEW, [{ 'ELEMENT': el.value + 1 }]).should.beRejected);

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this2);
      });

      it('should be able to return multiple elements from javascript', function callee$3$0() {
        var res;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute(GET_ELEM_BY_TAGNAME));

            case 2:
              res = context$4$0.sent;

              expect(res).to.have.length.above(0);

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this2);
      });
      it('should pass along non-element arguments', function callee$3$0() {
        var arg;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              arg = 'non-element-argument';
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args[0];', [arg]));

            case 3:
              context$4$0.t0 = arg;
              context$4$0.sent.should.be.equal(context$4$0.t0);

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this2);
      });
      it('should handle return values correctly', function callee$3$0() {
        var arg;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              arg = ['one', 'two', 'three'];
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args;', arg));

            case 3:
              context$4$0.t0 = arg;
              context$4$0.sent.should.eql(context$4$0.t0);

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this2);
      });
    });

    describe('asynchronous', function () {
      var _this3 = this;

      it('should bubble up javascript errors', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute('\'nan\'--').should.eventually.be.rejected);

            case 2:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this3);
      });

      it('should execute async javascript', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(1000));

            case 2:
              context$4$0.next = 4;
              return _regeneratorRuntime.awrap(driver.executeAsync('arguments[arguments.length - 1](123);'));

            case 4:
              context$4$0.sent.should.be.equal(123);

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this3);
      });

      it('should timeout when callback is not invoked', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(1000));

            case 2:
              context$4$0.next = 4;
              return _regeneratorRuntime.awrap(driver.executeAsync('return 1 + 2').should.eventually.be.rejected);

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this3);
      });
    });
  });

  describe('https', function () {
    var _this4 = this;

    var driver = (0, _safariSetup2['default'])(this, _Object$assign({}, _desired2['default'], { enableAsyncExecuteFromHttps: true })).driver;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver, 'https://www.google.com', 'Google'));

          case 2:
            return context$3$0.abrupt('return', context$3$0.sent);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this4);
    });
    after(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.deleteSession());

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    describe('synchronous', function () {
      var _this5 = this;

      it('should bubble up javascript errors', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute('\'nan\'--').should.eventually.be.rejected);

            case 2:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this5);
      });

      it('should eval javascript', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute('return 1'));

            case 2:
              context$4$0.sent.should.be.equal(1);

            case 3:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this5);
      });

      it('should not be returning hardcoded results', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute('return 1+1'));

            case 2:
              context$4$0.sent.should.be.equal(2);

            case 3:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this5);
      });

      it('should return nothing when you don\'t explicitly return', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute('1+1'));

            case 2:
              context$4$0.t0 = context$4$0.sent;
              expect(context$4$0.t0).to.not.exist;

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this5);
      });

      it('should pass along non-element arguments', function callee$3$0() {
        var arg;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              arg = 'non-element-argument';
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args[0];', [arg]));

            case 3:
              context$4$0.t0 = arg;
              context$4$0.sent.should.be.equal(context$4$0.t0);

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this5);
      });

      it('should handle return values correctly', function callee$3$0() {
        var arg;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              arg = ['one', 'two', 'three'];
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args;', arg));

            case 3:
              context$4$0.t0 = arg;
              context$4$0.sent.should.eql(context$4$0.t0);

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this5);
      });
    });

    describe('asynchronous', function () {
      var _this6 = this;

      it('should bubble up javascript errors', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.execute('\'nan\'--').should.eventually.be.rejected);

            case 2:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this6);
      });

      it('should execute async javascript', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(1000));

            case 2:
              context$4$0.next = 4;
              return _regeneratorRuntime.awrap(driver.executeAsync('arguments[arguments.length - 1](123);'));

            case 4:
              context$4$0.sent.should.be.equal(123);

            case 5:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this6);
      });

      it('should timeout when callback is not invoked', function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(1000));

            case 2:
              context$4$0.next = 4;
              return _regeneratorRuntime.awrap(driver.executeAsync('return 1 + 2').should.eventually.be.rejected);

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this6);
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3NhZmFyaS93ZWJ2aWV3L2V4ZWN1dGUtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O3VCQUNvQixXQUFXOzs7OzJCQUNiLGlCQUFpQjs7Ozs4QkFDUCx1QkFBdUI7OzhCQUNkLHVCQUF1Qjs7QUFHNUQsSUFBTSxnQkFBZ0IsOENBQThDLENBQUM7QUFDckUsSUFBTSxtQkFBbUIsMkVBQXlFLENBQUM7QUFDbkcsSUFBTSxtQkFBbUIsK0VBQTZFLENBQUM7QUFDdkcsSUFBTSxtQkFBbUIsaURBQStDLENBQUM7O0FBRXpFLFFBQVEsQ0FBQyw0QkFBNEIsRUFBRSxZQUFZO0FBQ2pELE1BQUksQ0FBQyxPQUFPLHNDQUFzQixDQUFDOztBQUVuQyxVQUFRLENBQUMsTUFBTSxFQUFFLFlBQVk7OztBQUMzQixRQUFNLE1BQU0sR0FBRyw4QkFBTSxJQUFJLHVCQUFVLENBQUMsTUFBTSxDQUFDO0FBQzNDLFVBQU0sQ0FBQzs7Ozs7NkNBQWtCLHVEQUFxQixNQUFNLENBQUM7Ozs7Ozs7Ozs7S0FBQSxDQUFDLENBQUM7QUFDdkQsU0FBSyxDQUFDOzs7Ozs2Q0FDRSxNQUFNLENBQUMsYUFBYSxFQUFFOzs7Ozs7O0tBQzdCLENBQUMsQ0FBQzs7QUFFSCxZQUFRLENBQUMsYUFBYSxFQUFFLFlBQVk7OztBQUNsQyxRQUFFLENBQUMsb0NBQW9DLEVBQUU7Ozs7OytDQUNqQyxNQUFNLENBQUMsT0FBTyxhQUFXLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsUUFBUTs7Ozs7OztPQUM5RCxDQUFDLENBQUM7O0FBRUgsUUFBRSxDQUFDLHdCQUF3QixFQUFFOzs7OzsrQ0FDcEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7OzsrQkFBRSxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDOzs7Ozs7O09BQ3JELENBQUMsQ0FBQzs7QUFFSCxRQUFFLENBQUMsMkNBQTJDLEVBQUU7Ozs7OytDQUN2QyxNQUFN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TUFBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQzs7OzsrQ0FDL0IsTUFBTSxDQUFDLFlBQVksZ0JBQWdCLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsUUFBUTs7Ozs7OztPQUN4RSxDQUFDLENBQUM7S0FDSixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvc2FmYXJpL3dlYnZpZXcvZXhlY3V0ZS1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbHMgZXhwZWN0ICovXG5pbXBvcnQgZGVzaXJlZCBmcm9tICcuL2Rlc2lyZWQnO1xuaW1wb3J0IHNldHVwIGZyb20gJy4uL3NhZmFyaS1zZXR1cCc7XG5pbXBvcnQgeyBsb2FkV2ViVmlldyB9IGZyb20gJy4uLy4uL2hlbHBlcnMvd2Vidmlldyc7XG5pbXBvcnQgeyBNT0NIQV9TQUZBUklfVElNRU9VVCB9IGZyb20gJy4uLy4uL2hlbHBlcnMvc2Vzc2lvbic7XG5cblxuY29uc3QgU0NST0xMX0lOVE9fVklFVyA9IGByZXR1cm4gYXJndW1lbnRzWzBdLnNjcm9sbEludG9WaWV3KHRydWUpO2A7XG5jb25zdCBHRVRfUklHSFRfSU5ORVJIVE1MID0gYHJldHVybiBkb2N1bWVudC5ib2R5LmlubmVySFRNTC5pbmRleE9mKCdJIGFtIHNvbWUgcGFnZSBjb250ZW50JykgPiAwYDtcbmNvbnN0IEdFVF9XUk9OR19JTk5FUkhUTUwgPSBgcmV0dXJuIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MLmluZGV4T2YoJ0kgYW0gbm90IHNvbWUgcGFnZSBjb250ZW50JykgPiAwYDtcbmNvbnN0IEdFVF9FTEVNX0JZX1RBR05BTUUgPSBgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJyk7YDtcblxuZGVzY3JpYmUoJ3NhZmFyaSAtIHdlYnZpZXcgLSBleGVjdXRlJywgZnVuY3Rpb24gKCkge1xuICB0aGlzLnRpbWVvdXQoTU9DSEFfU0FGQVJJX1RJTUVPVVQpO1xuXG4gIGRlc2NyaWJlKCdodHRwJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGRyaXZlciA9IHNldHVwKHRoaXMsIGRlc2lyZWQpLmRyaXZlcjtcbiAgICBiZWZvcmUoYXN5bmMgKCkgPT4gYXdhaXQgbG9hZFdlYlZpZXcoZGVzaXJlZCwgZHJpdmVyKSk7XG4gICAgYWZ0ZXIoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgZHJpdmVyLmRlbGV0ZVNlc3Npb24oKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdzeW5jaHJvbm91cycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGl0KCdzaG91bGQgYnViYmxlIHVwIGphdmFzY3JpcHQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCBkcml2ZXIuZXhlY3V0ZShgJ25hbictLWApLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgZXZhbCBqYXZhc2NyaXB0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoJ3JldHVybiAxJykpLnNob3VsZC5iZS5lcXVhbCgxKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIG5vdCBiZSByZXR1cm5pbmcgaGFyZGNvZGVkIHJlc3VsdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgncmV0dXJuIDErMScpKS5zaG91bGQuYmUuZXF1YWwoMik7XG4gICAgICB9KTtcblxuICAgICAgaXQoYHNob3VsZCByZXR1cm4gbm90aGluZyB3aGVuIHlvdSBkb24ndCBleHBsaWNpdGx5IHJldHVybmAsIGFzeW5jICgpID0+IHtcbiAgICAgICAgZXhwZWN0KGF3YWl0IGRyaXZlci5leGVjdXRlKCcxKzEnKSkudG8ubm90LmV4aXN0O1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBjb2RlIGluc2lkZSB0aGUgd2ViIHZpZXcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZShHRVRfUklHSFRfSU5ORVJIVE1MKSkuc2hvdWxkLmJlLm9rO1xuICAgICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoR0VUX1dST05HX0lOTkVSSFRNTCkpLnNob3VsZC5ub3QuYmUub2s7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjb252ZXJ0IHNlbGVuaXVtIGVsZW1lbnQgYXJnIHRvIHdlYnZpZXcgZWxlbWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCdpZCcsICd1c2VyYWdlbnQnKTtcbiAgICAgICAgYXdhaXQgZHJpdmVyLmV4ZWN1dGUoU0NST0xMX0lOVE9fVklFVywgW2VsXSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBjYXRjaCBzdGFsZSBvciB1bmRlZmluZWQgZWxlbWVudCBhcyBhcmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnaWQnLCAndXNlcmFnZW50Jyk7XG4gICAgICAgIHJldHVybiBkcml2ZXIuZXhlY3V0ZShTQ1JPTExfSU5UT19WSUVXLCBbeydFTEVNRU5UJzogKGVsLnZhbHVlICsgMSl9XSkuc2hvdWxkLmJlUmVqZWN0ZWQ7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIHJldHVybiBtdWx0aXBsZSBlbGVtZW50cyBmcm9tIGphdmFzY3JpcHQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCByZXMgPSBhd2FpdCBkcml2ZXIuZXhlY3V0ZShHRVRfRUxFTV9CWV9UQUdOQU1FKTtcbiAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5sZW5ndGguYWJvdmUoMCk7XG4gICAgICB9KTtcbiAgICAgIGl0KCdzaG91bGQgcGFzcyBhbG9uZyBub24tZWxlbWVudCBhcmd1bWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBhcmcgPSAnbm9uLWVsZW1lbnQtYXJndW1lbnQnO1xuICAgICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoJ3ZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsgcmV0dXJuIGFyZ3NbMF07JywgW2FyZ10pKS5zaG91bGQuYmUuZXF1YWwoYXJnKTtcbiAgICAgIH0pO1xuICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgcmV0dXJuIHZhbHVlcyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBhcmcgPSBbJ29uZScsICd0d28nLCAndGhyZWUnXTtcbiAgICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlKCd2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7IHJldHVybiBhcmdzOycsIGFyZykpLnNob3VsZC5lcWwoYXJnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2FzeW5jaHJvbm91cycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGl0KCdzaG91bGQgYnViYmxlIHVwIGphdmFzY3JpcHQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCBkcml2ZXIuZXhlY3V0ZShgJ25hbictLWApLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBhc3luYyBqYXZhc2NyaXB0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBhd2FpdCBkcml2ZXIuYXN5bmNTY3JpcHRUaW1lb3V0KDEwMDApO1xuICAgICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGVBc3luYyhgYXJndW1lbnRzW2FyZ3VtZW50cy5sZW5ndGggLSAxXSgxMjMpO2ApKS5zaG91bGQuYmUuZXF1YWwoMTIzKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHRpbWVvdXQgd2hlbiBjYWxsYmFjayBpcyBub3QgaW52b2tlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgZHJpdmVyLmFzeW5jU2NyaXB0VGltZW91dCgxMDAwKTtcbiAgICAgICAgYXdhaXQgZHJpdmVyLmV4ZWN1dGVBc3luYyhgcmV0dXJuIDEgKyAyYCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWQ7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2h0dHBzJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGRyaXZlciA9IHNldHVwKHRoaXMsIE9iamVjdC5hc3NpZ24oe30sIGRlc2lyZWQsIHtlbmFibGVBc3luY0V4ZWN1dGVGcm9tSHR0cHM6IHRydWV9KSkuZHJpdmVyO1xuICAgIGJlZm9yZShhc3luYyAoKSA9PiBhd2FpdCBsb2FkV2ViVmlldyhkZXNpcmVkLCBkcml2ZXIsICdodHRwczovL3d3dy5nb29nbGUuY29tJywgJ0dvb2dsZScpKTtcbiAgICBhZnRlcihhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBkcml2ZXIuZGVsZXRlU2Vzc2lvbigpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3N5bmNocm9ub3VzJywgZnVuY3Rpb24gKCkge1xuICAgICAgaXQoJ3Nob3VsZCBidWJibGUgdXAgamF2YXNjcmlwdCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IGRyaXZlci5leGVjdXRlKGAnbmFuJy0tYCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWQ7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBldmFsIGphdmFzY3JpcHQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgncmV0dXJuIDEnKSkuc2hvdWxkLmJlLmVxdWFsKDEpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgbm90IGJlIHJldHVybmluZyBoYXJkY29kZWQgcmVzdWx0cycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlKCdyZXR1cm4gMSsxJykpLnNob3VsZC5iZS5lcXVhbCgyKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdChgc2hvdWxkIHJldHVybiBub3RoaW5nIHdoZW4geW91IGRvbid0IGV4cGxpY2l0bHkgcmV0dXJuYCwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBleHBlY3QoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoJzErMScpKS50by5ub3QuZXhpc3Q7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCBwYXNzIGFsb25nIG5vbi1lbGVtZW50IGFyZ3VtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IGFyZyA9ICdub24tZWxlbWVudC1hcmd1bWVudCc7XG4gICAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgndmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApOyByZXR1cm4gYXJnc1swXTsnLCBbYXJnXSkpLnNob3VsZC5iZS5lcXVhbChhcmcpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdzaG91bGQgaGFuZGxlIHJldHVybiB2YWx1ZXMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgYXJnID0gWydvbmUnLCAndHdvJywgJ3RocmVlJ107XG4gICAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgndmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApOyByZXR1cm4gYXJnczsnLCBhcmcpKS5zaG91bGQuZXFsKGFyZyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdhc3luY2hyb25vdXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpdCgnc2hvdWxkIGJ1YmJsZSB1cCBqYXZhc2NyaXB0IGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgZHJpdmVyLmV4ZWN1dGUoYCduYW4nLS1gKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZDtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgYXN5bmMgamF2YXNjcmlwdCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgYXdhaXQgZHJpdmVyLmFzeW5jU2NyaXB0VGltZW91dCgxMDAwKTtcbiAgICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlQXN5bmMoYGFyZ3VtZW50c1thcmd1bWVudHMubGVuZ3RoIC0gMV0oMTIzKTtgKSkuc2hvdWxkLmJlLmVxdWFsKDEyMyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3Nob3VsZCB0aW1lb3V0IHdoZW4gY2FsbGJhY2sgaXMgbm90IGludm9rZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IGRyaXZlci5hc3luY1NjcmlwdFRpbWVvdXQoMTAwMCk7XG4gICAgICAgIGF3YWl0IGRyaXZlci5leGVjdXRlQXN5bmMoYHJldHVybiAxICsgMmApLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uLy4uIn0=
