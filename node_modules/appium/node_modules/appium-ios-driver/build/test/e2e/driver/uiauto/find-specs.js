require('source-map-support').install();

/* globals $, rootPage */

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _base = require('./base');

describe('uiauto - find', function () {
  var _this2 = this;

  (0, _base.globalInit)(this, { chai: true });

  describe("textfields", function () {
    var _this = this;

    var ctx = undefined;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.instrumentsInstanceInit)());

          case 2:
            ctx = context$3$0.sent;

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    after(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.killAll)(ctx));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    afterEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              $('#UICatalog').first().tap();
              $.delay(1000);
            }));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should not return duplicate UIATextField', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var cell = $('cell')[0];
              var id = '' + $.getId(cell);
              var res = $.getElementsByType('UIATextField', id);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should not return duplicate UIASecureTextField', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var cell = $('cell')[2];
              var id = '' + $.getId(cell);
              var res = $.getElementsByType('UIASecureTextField', id);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('byUIAutomation', function () {
    var ctx = undefined;
    before(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.instrumentsInstanceInit)());

          case 2:
            ctx = context$3$0.sent;

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
    after(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap((0, _base.killAll)(ctx));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    afterEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              $('#UICatalog').first().tap();
              $.delay(1000);
            }));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should use global context by default', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var res = $.getElementsByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)');
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(5);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should eval the raw code if it does not start with a dot', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var res = $.getElementsByUIAutomation('$.getElementByType(\'UIATableCell\').getAllWithPredicate("type contains[c] \'textfield\'", true)');
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should retrieve context from cache when ctx param is a string', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var parent = $.getElementByType('UIATableCell');
              var parentId = $.getId(parent);
              var res = $.getElementsByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parentId);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should use context when ctx param is an object', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var parent = $.getElementByType('UIATableCell');
              var res = $.getElementsByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parent);
              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(1);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should work when retrieving only one element', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(ctx.execFunc(function () {
              rootPage.clickMenuItem('Text Fields');
              $.delay(2000);
              var res = [],
                  parent,
                  el;
              el = $.getElementByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)');
              res.push(el);

              el = $.getElementByUIAutomation('$.getElementByType(\'UIATableCell\').getAllWithPredicate("type contains[c] \'textfield\'", true)');
              res.push(el);

              parent = $.getElementsByType('UIATableCell')[1];
              var parentId = $.getId(parent);
              el = $.getElementByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parentId);
              res.push(el);

              parent = $.getElementsByType('UIATableCell')[2];
              el = $.getElementByUIAutomation('.getAllWithPredicate("type contains[c] \'textfield\'", true)', parent);
              res.push(el);

              return res;
            }));

          case 2:
            res = context$3$0.sent;

            res.should.have.length(4);
            res[0].ELEMENT.should.exist;

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL2RyaXZlci91aWF1dG8vZmluZC1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7O29CQUc2RCxRQUFROztBQUVyRSxRQUFRLENBQUMsZUFBZSxFQUFFLFlBQVk7OztBQUNwQyx3QkFBVyxJQUFJLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQzs7QUFFL0IsVUFBUSxDQUFDLFlBQVksRUFBRSxZQUFZOzs7QUFDakMsUUFBSSxHQUFHLFlBQUEsQ0FBQztBQUNSLFVBQU0sQ0FBQzs7Ozs7NkNBQ08sb0NBQXlCOzs7QUFBckMsZUFBRzs7Ozs7OztLQUNKLENBQUMsQ0FBQztBQUNILFNBQUssQ0FBQzs7Ozs7NkNBQ0UsbUJBQVEsR0FBRyxDQUFDOzs7Ozs7O0tBQ25CLENBQUMsQ0FBQzs7QUFFSCxhQUFTLENBQUM7Ozs7OzZDQUNGLEdBQUcsQ0FBQyxRQUFRLENBQ2hCLFlBQVk7QUFDVixlQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDOUIsZUFBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUNmLENBQ0Y7Ozs7Ozs7S0FDRixDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLDBDQUEwQyxFQUFFO1VBQ3pDLEdBQUc7Ozs7OzZDQUFTLEdBQUcsQ0FBQyxRQUFRLENBQzFCLFlBQVk7QUFDVixzQkFBUSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUN0QyxlQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2Qsa0JBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4QixrQkFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDNUIsa0JBQUksR0FBRyxHQUFHLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxj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RCxNQUFNLENBQ1AsQ0FBQztBQUNGLGlCQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDOztBQUViLHFCQUFPLEdBQUcsQ0FBQzthQUNaLENBQ0Y7OztBQTlCRyxlQUFHOztBQStCUCxlQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDMUIsZUFBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDOzs7Ozs7O0tBQzdCLENBQUMsQ0FBQztHQUVKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2UyZS9kcml2ZXIvdWlhdXRvL2ZpbmQtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcbi8qIGdsb2JhbHMgJCwgcm9vdFBhZ2UgKi9cblxuaW1wb3J0IHsgaW5zdHJ1bWVudHNJbnN0YW5jZUluaXQsIGdsb2JhbEluaXQsIGtpbGxBbGwgfSBmcm9tICcuL2Jhc2UnO1xuXG5kZXNjcmliZSgndWlhdXRvIC0gZmluZCcsIGZ1bmN0aW9uICgpIHtcbiAgZ2xvYmFsSW5pdCh0aGlzLCB7Y2hhaTogdHJ1ZX0pO1xuXG4gIGRlc2NyaWJlKFwidGV4dGZpZWxkc1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGN0eDtcbiAgICBiZWZvcmUoYXN5bmMgKCkgPT4ge1xuICAgICAgY3R4ID0gYXdhaXQgaW5zdHJ1bWVudHNJbnN0YW5jZUluaXQoKTtcbiAgICB9KTtcbiAgICBhZnRlcihhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBraWxsQWxsKGN0eCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgY3R4LmV4ZWNGdW5jKFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJCgnI1VJQ2F0YWxvZycpLmZpcnN0KCkudGFwKCk7XG4gICAgICAgICAgJC5kZWxheSgxMDAwKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHJldHVybiBkdXBsaWNhdGUgVUlBVGV4dEZpZWxkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGN0eC5leGVjRnVuYyhcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJvb3RQYWdlLmNsaWNrTWVudUl0ZW0oJ1RleHQgRmllbGRzJyk7XG4gICAgICAgICAgJC5kZWxheSgyMDAwKTtcbiAgICAgICAgICB2YXIgY2VsbCA9ICQoJ2NlbGwnKVswXTtcbiAgICAgICAgICB2YXIgaWQgPSAnJyArICQuZ2V0SWQoY2VsbCk7XG4gICAgICAgICAgdmFyIHJlcyA9ICQuZ2V0RWxlbWVudHNCeVR5cGUoJ1VJQVRleHRGaWVsZCcsIGlkKTtcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmVzLnNob3VsZC5oYXZlLmxlbmd0aCgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHJldHVybiBkdXBsaWNhdGUgVUlBU2VjdXJlVGV4dEZpZWxkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGN0eC5leGVjRnVuYyhcbiAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJvb3RQYWdlLmNsaWNrTWVudUl0ZW0oJ1RleHQgRmllbGRzJyk7XG4gICAgICAgICAgJC5kZWxheSgyMDAwKTtcbiAgICAgICAgICB2YXIgY2VsbCA9ICQoJ2NlbGwnKVsyXTtcbiAgICAgICAgICB2YXIgaWQgPSAnJyArICQuZ2V0SWQoY2VsbCk7XG4gICAgICAgICAgdmFyIHJlcyA9ICQuZ2V0RWxlbWVudHNCeVR5cGUoJ1VJQVNlY3VyZVRleHRGaWVsZCcsIGlkKTtcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmVzLnNob3VsZC5oYXZlLmxlbmd0aCgxKTtcbiAgICB9KTtcblxuICB9KTtcblxuICBkZXNjcmliZSgnYnlVSUF1dG9tYXRpb24nLCAoKSA9PiB7XG4gICAgbGV0IGN0eDtcbiAgICBiZWZvcmUoYXN5bmMgKCkgPT4ge1xuICAgICAgY3R4ID0gYXdhaXQgaW5zdHJ1bWVudHNJbnN0YW5jZUluaXQoKTtcbiAgICB9KTtcbiAgICBhZnRlcihhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBraWxsQWxsKGN0eCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgY3R4LmV4ZWNGdW5jKFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJCgnI1VJQ2F0YWxvZycpLmZpcnN0KCkudGFwKCk7XG4gICAgICAgICAgJC5kZWxheSgxMDAwKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGdsb2JhbCBjb250ZXh0IGJ5IGRlZmF1bHQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcmVzID0gYXdhaXQgY3R4LmV4ZWNGdW5jKFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcm9vdFBhZ2UuY2xpY2tNZW51SXRlbSgnVGV4dCBGaWVsZHMnKTtcbiAgICAgICAgICAkLmRlbGF5KDIwMDApO1xuICAgICAgICAgIHZhciByZXMgPSAkLmdldEVsZW1lbnRzQnlVSUF1dG9tYXRpb24oJy5nZXRBbGxXaXRoUHJlZGljYXRlKFwidHlwZSBjb250YWluc1tjXSBcXCd0ZXh0ZmllbGRcXCdcIiwgdHJ1ZSknKTtcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmVzLnNob3VsZC5oYXZlLmxlbmd0aCg1KTtcbiAgICAgIHJlc1swXS5FTEVNRU5ULnNob3VsZC5leGlzdDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXZhbCB0aGUgcmF3IGNvZGUgaWYgaXQgZG9lcyBub3Qgc3RhcnQgd2l0aCBhIGRvdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCByZXMgPSBhd2FpdCBjdHguZXhlY0Z1bmMoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByb290UGFnZS5jbGlja01lbnVJdGVtKCdUZXh0IEZpZWxkcycpO1xuICAgICAgICAgICQuZGVsYXkoMjAwMCk7XG4gICAgICAgICAgdmFyIHJlcyA9ICQuZ2V0RWxlbWVudHNCeVVJQXV0b21hdGlvbignJC5nZXRFbGVtZW50QnlUeXBlKFxcJ1VJQVRhYmxlQ2VsbFxcJykuZ2V0QWxsV2l0aFByZWRpY2F0ZShcInR5cGUgY29udGFpbnNbY10gXFwndGV4dGZpZWxkXFwnXCIsIHRydWUpJyk7XG4gICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJlcy5zaG91bGQuaGF2ZS5sZW5ndGgoMSk7XG4gICAgICByZXNbMF0uRUxFTUVOVC5zaG91bGQuZXhpc3Q7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHJpZXZlIGNvbnRleHQgZnJvbSBjYWNoZSB3aGVuIGN0eCBwYXJhbSBpcyBhIHN0cmluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCByZXMgPSBhd2FpdCBjdHguZXhlY0Z1bmMoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByb290UGFnZS5jbGlja01lbnVJdGVtKCdUZXh0IEZpZWxkcycpO1xuICAgICAgICAgICQuZGVsYXkoMjAwMCk7XG4gICAgICAgICAgdmFyIHBhcmVudCA9ICQuZ2V0RWxlbWVudEJ5VHlwZSgnVUlBVGFibGVDZWxsJyk7XG4gICAgICAgICAgdmFyIHBhcmVudElkID0gJC5nZXRJZChwYXJlbnQpO1xuICAgICAgICAgIHZhciByZXMgPSAkLmdldEVsZW1lbnRzQnlVSUF1dG9tYXRpb24oXG4gICAgICAgICAgICAnLmdldEFsbFdpdGhQcmVkaWNhdGUoXCJ0eXBlIGNvbnRhaW5zW2NdIFxcJ3RleHRmaWVsZFxcJ1wiLCB0cnVlKScsXG4gICAgICAgICAgICBwYXJlbnRJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJlcy5zaG91bGQuaGF2ZS5sZW5ndGgoMSk7XG4gICAgICByZXNbMF0uRUxFTUVOVC5zaG91bGQuZXhpc3Q7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBjb250ZXh0IHdoZW4gY3R4IHBhcmFtIGlzIGFuIG9iamVjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCByZXMgPSBhd2FpdCBjdHguZXhlY0Z1bmMoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByb290UGFnZS5jbGlja01lbnVJdGVtKCdUZXh0IEZpZWxkcycpO1xuICAgICAgICAgICQuZGVsYXkoMjAwMCk7XG4gICAgICAgICAgdmFyIHBhcmVudCA9ICQuZ2V0RWxlbWVudEJ5VHlwZSgnVUlBVGFibGVDZWxsJyk7XG4gICAgICAgICAgdmFyIHJlcyA9ICQuZ2V0RWxlbWVudHNCeVVJQXV0b21hdGlvbihcbiAgICAgICAgICAgICcuZ2V0QWxsV2l0aFByZWRpY2F0ZShcInR5cGUgY29udGFpbnNbY10gXFwndGV4dGZpZWxkXFwnXCIsIHRydWUpJyxcbiAgICAgICAgICAgIHBhcmVudFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJlcy5zaG91bGQuaGF2ZS5sZW5ndGgoMSk7XG4gICAgICByZXNbMF0uRUxFTUVOVC5zaG91bGQuZXhpc3Q7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHdvcmsgd2hlbiByZXRyaWV2aW5nIG9ubHkgb25lIGVsZW1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgcmVzID0gYXdhaXQgY3R4LmV4ZWNGdW5jKFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcm9vdFBhZ2UuY2xpY2tNZW51SXRlbSgnVGV4dCBGaWVsZHMnKTtcbiAgICAgICAgICAkLmRlbGF5KDIwMDApO1xuICAgICAgICAgIHZhciByZXMgPSBbXSwgcGFyZW50LCBlbDtcbiAgICAgICAgICBlbCA9ICQuZ2V0RWxlbWVudEJ5VUlBdXRvbWF0aW9uKFxuICAgICAgICAgICAgJy5nZXRBbGxXaXRoUHJlZGljYXRlKFwidHlwZSBjb250YWluc1tjXSBcXCd0ZXh0ZmllbGRcXCdcIiwgdHJ1ZSknXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXMucHVzaChlbCk7XG5cbiAgICAgICAgICBlbCA9ICQuZ2V0RWxlbWVudEJ5VUlBdXRvbWF0aW9uKCckLmdldEVsZW1lbnRCeVR5cGUoXFwnVUlBVGFibGVDZWxsXFwnKS5nZXRBbGxXaXRoUHJlZGljYXRlKFwidHlwZSBjb250YWluc1tjXSBcXCd0ZXh0ZmllbGRcXCdcIiwgdHJ1ZSknKTtcbiAgICAgICAgICByZXMucHVzaChlbCk7XG5cbiAgICAgICAgICBwYXJlbnQgPSAkLmdldEVsZW1lbnRzQnlUeXBlKCdVSUFUYWJsZUNlbGwnKVsxXTtcbiAgICAgICAgICB2YXIgcGFyZW50SWQgPSAkLmdldElkKHBhcmVudCk7XG4gICAgICAgICAgZWwgPSAkLmdldEVsZW1lbnRCeVVJQXV0b21hdGlvbihcbiAgICAgICAgICAgICcuZ2V0QWxsV2l0aFByZWRpY2F0ZShcInR5cGUgY29udGFpbnNbY10gXFwndGV4dGZpZWxkXFwnXCIsIHRydWUpJyxcbiAgICAgICAgICAgIHBhcmVudElkXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXMucHVzaChlbCk7XG5cbiAgICAgICAgICBwYXJlbnQgPSAkLmdldEVsZW1lbnRzQnlUeXBlKCdVSUFUYWJsZUNlbGwnKVsyXTtcbiAgICAgICAgICBlbCA9ICQuZ2V0RWxlbWVudEJ5VUlBdXRvbWF0aW9uKFxuICAgICAgICAgICAgJy5nZXRBbGxXaXRoUHJlZGljYXRlKFwidHlwZSBjb250YWluc1tjXSBcXCd0ZXh0ZmllbGRcXCdcIiwgdHJ1ZSknLFxuICAgICAgICAgICAgcGFyZW50XG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXMucHVzaChlbCk7XG5cbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB9XG4gICAgICApO1xuICAgICAgcmVzLnNob3VsZC5oYXZlLmxlbmd0aCg0KTtcbiAgICAgIHJlc1swXS5FTEVNRU5ULnNob3VsZC5leGlzdDtcbiAgICB9KTtcblxuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLi8uLiJ9
