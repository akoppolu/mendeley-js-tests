'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _setupBase = require("../setup-base");

var _setupBase2 = _interopRequireDefault(_setupBase);

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _helpersRecipes = require('../helpers/recipes');

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

describe('testapp - find element', function () {
  var _this2 = this;

  var session = (0, _setupBase2['default'])(this, _desired2['default']);
  var driver = session.driver;

  describe('by id', function () {
    var _this = this;

    it('should first attempt to match accessibility id', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'ComputeSumButton'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getAttribute('label', el));

          case 5:
            context$3$0.sent.should.equal('Compute Sum');

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should attempt to match by string if no accessibility id matches', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'Compute Sum'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getAttribute('label', el));

          case 5:
            context$3$0.sent.should.equal('Compute Sum');

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should use a localized string if the id is a localization key', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'main.button.computeSum'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.getAttribute('label', el));

          case 5:
            context$3$0.sent.should.equal('Compute Sum');

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should be able to return multiple matches', function callee$2$0() {
      var els;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElements('id', 'TextField'));

          case 2:
            els = context$3$0.sent;

            els.length.should.be.greaterThan(1);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  it('should find a single element on the app', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('class name', 'UIAButton'));

        case 2:
          el = context$2$0.sent;

          el.should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should not find any invalid elements on the app and throw error', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('class name', 'UIAButtonNotThere'))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 7/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should find alerts when they exist', function callee$1$0() {
    var els, alert;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements('class name', 'UIAButton'));

        case 2:
          els = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.click(els[1]));

        case 5:
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(driver.findElement('class name', 'UIAAlert'));

        case 7:
          alert = context$2$0.sent;
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(driver.findElementFromElement('accessibility id', 'OK', alert));

        case 10:
          context$2$0.sent.should.exist;
          context$2$0.next = 13;
          return _regeneratorRuntime.awrap(driver.findElementFromElement('accessibility id', 'Cancel', alert));

        case 13:
          context$2$0.sent.should.exist;
          context$2$0.next = 16;
          return _regeneratorRuntime.awrap(driver.postDismissAlert());

        case 16:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should not find alerts when they dont exist', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('class name', 'UIAAlert'))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 7/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should get an error when strategy doesnt exist', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('css selector', 'UIAButton'))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 32/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should find all elements by class name in the app', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements('class name', 'UIAButton'));

        case 2:
          els = context$2$0.sent;

          [4, 7, 8].should.contain(els.length);
          els[0].should.exist;

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should not find any elements on the app but fail gracefully', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements('class name', 'UIAButtonNotThere'));

        case 2:
          els = context$2$0.sent;

          els.should.have.length(0);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should find element by valid name', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('accessibility id', 'ComputeSumButton'));

        case 2:
          el = context$2$0.sent;

          el.should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should not find element by invalid name but return respective error code', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('accessibility id', 'InvalidNameForElement'))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 7/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should find an element with accessibility id containing an apostrophe', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('accessibility id', "Access'ibility"));

        case 2:
          el = context$2$0.sent;

          el.should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should not find element by incomplete class name but return respective error code', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement('class name', 'notAValidReference'))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 32/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });

  it('should find multiple elements by valid name', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElements('accessibility id', 'AppElem'));

        case 2:
          els = context$2$0.sent;

          els.should.have.length(3);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3Rlc3RhcHAvZmluZC1lbGVtZW50LXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozt5QkFBa0IsZUFBZTs7Ozt1QkFDYixXQUFXOzs7OzhCQUNLLG9CQUFvQjs7d0JBQzFDLFVBQVU7Ozs7QUFFeEIsUUFBUSxDQUFDLHdCQUF3QixFQUFFLFlBQVk7OztBQUM3QyxNQUFJLE9BQU8sR0FBRyw0QkFBTSxJQUFJLHVCQUFVLENBQUM7QUFDbkMsTUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQzs7QUFFNUIsVUFBUSxDQUFDLE9BQU8sRUFBRSxZQUFZOzs7QUFDNUIsTUFBRSxDQUFDLGdEQUFnRCxFQUFFO1VBQy9DLEVBQUU7Ozs7OzZDQUFTLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxFQUFFLGtCQUFrQixDQUFDOzs7QUFBdkQsY0FBRTs7NkNBQ0MsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDOzs7NkJBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhOzs7Ozs7O0tBQ3BFLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsa0VBQWtFLEVBQUU7VUFDakUsRUFBRTs7Ozs7NkNBQVMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDOzs7QUFBbEQsY0FBRTs7NkNBQ0MsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDOzs7NkJBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhOzs7Ozs7O0tBQ3BFLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsK0RBQStELEVBQUU7VUFDOUQsRUFBRTs7Ozs7NkNBQVMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUUsd0JBQXdCLENBQUM7OztBQUE3RCxjQUFFOzs2Q0FDQyxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUM7Ozs2QkFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLGFBQWE7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Qzs7Ozs7OztHQUMzQixDQUFDLENBQUM7Q0FFSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvdGVzdGFwcC9maW5kLWVsZW1lbnQtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgc2V0dXAgZnJvbSBcIi4uL3NldHVwLWJhc2VcIjtcbmltcG9ydCBkZXNpcmVkIGZyb20gJy4vZGVzaXJlZCc7XG5pbXBvcnQgeyB0aHJvd01hdGNoYWJsZUVycm9yIH0gZnJvbSAnLi4vaGVscGVycy9yZWNpcGVzJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcblxuZGVzY3JpYmUoJ3Rlc3RhcHAgLSBmaW5kIGVsZW1lbnQnLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBzZXNzaW9uID0gc2V0dXAodGhpcywgZGVzaXJlZCk7XG4gIGxldCBkcml2ZXIgPSBzZXNzaW9uLmRyaXZlcjtcblxuICBkZXNjcmliZSgnYnkgaWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBmaXJzdCBhdHRlbXB0IHRvIG1hdGNoIGFjY2Vzc2liaWxpdHkgaWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2lkJywgJ0NvbXB1dGVTdW1CdXR0b24nKTtcbiAgICAgIChhd2FpdCBkcml2ZXIuZ2V0QXR0cmlidXRlKCdsYWJlbCcsIGVsKSkuc2hvdWxkLmVxdWFsKCdDb21wdXRlIFN1bScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhdHRlbXB0IHRvIG1hdGNoIGJ5IHN0cmluZyBpZiBubyBhY2Nlc3NpYmlsaXR5IGlkIG1hdGNoZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2lkJywgJ0NvbXB1dGUgU3VtJyk7XG4gICAgICAoYXdhaXQgZHJpdmVyLmdldEF0dHJpYnV0ZSgnbGFiZWwnLCBlbCkpLnNob3VsZC5lcXVhbCgnQ29tcHV0ZSBTdW0nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGEgbG9jYWxpemVkIHN0cmluZyBpZiB0aGUgaWQgaXMgYSBsb2NhbGl6YXRpb24ga2V5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCdpZCcsICdtYWluLmJ1dHRvbi5jb21wdXRlU3VtJyk7XG4gICAgICAoYXdhaXQgZHJpdmVyLmdldEF0dHJpYnV0ZSgnbGFiZWwnLCBlbCkpLnNob3VsZC5lcXVhbCgnQ29tcHV0ZSBTdW0nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byByZXR1cm4gbXVsdGlwbGUgbWF0Y2hlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBlbHMgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnRzKCdpZCcsICdUZXh0RmllbGQnKTtcbiAgICAgIGVscy5sZW5ndGguc2hvdWxkLmJlLmdyZWF0ZXJUaGFuKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZpbmQgYSBzaW5nbGUgZWxlbWVudCBvbiB0aGUgYXBwJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnY2xhc3MgbmFtZScsICdVSUFCdXR0b24nKTtcbiAgICBlbC5zaG91bGQuZXhpc3Q7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgbm90IGZpbmQgYW55IGludmFsaWQgZWxlbWVudHMgb24gdGhlIGFwcCBhbmQgdGhyb3cgZXJyb3InLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgQi5yZXNvbHZlKGRyaXZlci5maW5kRWxlbWVudCgnY2xhc3MgbmFtZScsICdVSUFCdXR0b25Ob3RUaGVyZScpKVxuICAgICAgLmNhdGNoKHRocm93TWF0Y2hhYmxlRXJyb3IpXG4gICAgICAuc2hvdWxkLmJlLnJlamVjdGVkV2l0aCgvanNvbndwQ29kZTogNy8pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZpbmQgYWxlcnRzIHdoZW4gdGhleSBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWxzID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50cygnY2xhc3MgbmFtZScsICdVSUFCdXR0b24nKTtcbiAgICBhd2FpdCBkcml2ZXIuY2xpY2soZWxzWzFdKTtcbiAgICBsZXQgYWxlcnQgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2NsYXNzIG5hbWUnLCAnVUlBQWxlcnQnKTtcbiAgICAoYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50RnJvbUVsZW1lbnQoJ2FjY2Vzc2liaWxpdHkgaWQnLCAnT0snLCBhbGVydCkpLnNob3VsZC5leGlzdDtcbiAgICAoYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50RnJvbUVsZW1lbnQoJ2FjY2Vzc2liaWxpdHkgaWQnLCAnQ2FuY2VsJywgYWxlcnQpKS5zaG91bGQuZXhpc3Q7XG4gICAgYXdhaXQgZHJpdmVyLnBvc3REaXNtaXNzQWxlcnQoKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBub3QgZmluZCBhbGVydHMgd2hlbiB0aGV5IGRvbnQgZXhpc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgQi5yZXNvbHZlKGRyaXZlci5maW5kRWxlbWVudCgnY2xhc3MgbmFtZScsICdVSUFBbGVydCcpKVxuICAgICAgLmNhdGNoKHRocm93TWF0Y2hhYmxlRXJyb3IpXG4gICAgICAuc2hvdWxkLmJlLnJlamVjdGVkV2l0aCgvanNvbndwQ29kZTogNy8pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGdldCBhbiBlcnJvciB3aGVuIHN0cmF0ZWd5IGRvZXNudCBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBCLnJlc29sdmUoZHJpdmVyLmZpbmRFbGVtZW50KCdjc3Mgc2VsZWN0b3InLCAnVUlBQnV0dG9uJykpXG4gICAgICAuY2F0Y2godGhyb3dNYXRjaGFibGVFcnJvcilcbiAgICAgIC5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKC9qc29ud3BDb2RlOiAzMi8pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZpbmQgYWxsIGVsZW1lbnRzIGJ5IGNsYXNzIG5hbWUgaW4gdGhlIGFwcCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWxzID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50cygnY2xhc3MgbmFtZScsICdVSUFCdXR0b24nKTtcbiAgICBbNCwgNywgOF0uc2hvdWxkLmNvbnRhaW4oZWxzLmxlbmd0aCk7XG4gICAgZWxzWzBdLnNob3VsZC5leGlzdDtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBub3QgZmluZCBhbnkgZWxlbWVudHMgb24gdGhlIGFwcCBidXQgZmFpbCBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbHMgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnRzKCdjbGFzcyBuYW1lJywgJ1VJQUJ1dHRvbk5vdFRoZXJlJyk7XG4gICAgZWxzLnNob3VsZC5oYXZlLmxlbmd0aCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBmaW5kIGVsZW1lbnQgYnkgdmFsaWQgbmFtZScsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2FjY2Vzc2liaWxpdHkgaWQnLCAnQ29tcHV0ZVN1bUJ1dHRvbicpO1xuICAgIGVsLnNob3VsZC5leGlzdDtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBub3QgZmluZCBlbGVtZW50IGJ5IGludmFsaWQgbmFtZSBidXQgcmV0dXJuIHJlc3BlY3RpdmUgZXJyb3IgY29kZScsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBCLnJlc29sdmUoZHJpdmVyLmZpbmRFbGVtZW50KCdhY2Nlc3NpYmlsaXR5IGlkJywgJ0ludmFsaWROYW1lRm9yRWxlbWVudCcpKVxuICAgICAgLmNhdGNoKHRocm93TWF0Y2hhYmxlRXJyb3IpXG4gICAgICAuc2hvdWxkLmJlLnJlamVjdGVkV2l0aCgvanNvbndwQ29kZTogNy8pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZpbmQgYW4gZWxlbWVudCB3aXRoIGFjY2Vzc2liaWxpdHkgaWQgY29udGFpbmluZyBhbiBhcG9zdHJvcGhlJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsIFwiQWNjZXNzJ2liaWxpdHlcIik7XG4gICAgZWwuc2hvdWxkLmV4aXN0O1xuICB9KTtcblxuICBpdCgnc2hvdWxkIG5vdCBmaW5kIGVsZW1lbnQgYnkgaW5jb21wbGV0ZSBjbGFzcyBuYW1lIGJ1dCByZXR1cm4gcmVzcGVjdGl2ZSBlcnJvciBjb2RlJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IEIucmVzb2x2ZShkcml2ZXIuZmluZEVsZW1lbnQoJ2NsYXNzIG5hbWUnLCAnbm90QVZhbGlkUmVmZXJlbmNlJykpXG4gICAgICAuY2F0Y2godGhyb3dNYXRjaGFibGVFcnJvcilcbiAgICAgIC5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKC9qc29ud3BDb2RlOiAzMi8pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZpbmQgbXVsdGlwbGUgZWxlbWVudHMgYnkgdmFsaWQgbmFtZScsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWxzID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50cygnYWNjZXNzaWJpbGl0eSBpZCcsICdBcHBFbGVtJyk7XG4gICAgZWxzLnNob3VsZC5oYXZlLmxlbmd0aCgzKTtcbiAgfSk7XG5cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLiJ9
