'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _setupBase = require("../../setup-base");

var _setupBase2 = _interopRequireDefault(_setupBase);

var _desired = require('../desired');

var _desired2 = _interopRequireDefault(_desired);

var _helpersEnv = require('../../helpers/env');

var _helpersEnv2 = _interopRequireDefault(_helpersEnv);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _helpersRecipes = require('../../helpers/recipes');

describe('testapp - timeout', function () {
  var _this = this;

  this.timeout(_helpersEnv2['default'].MOCHA_INIT_TIMEOUT);

  afterEach(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].delay(3000));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  describe('implicit wait', function () {
    var _this2 = this;

    var session = (0, _setupBase2['default'])(this, _desired2['default']);
    var driver = session.driver;

    var impWaitCheck = function impWaitCheck(strat, sel, impWaitMs) {
      var beforeMs, missingEls, afterMs;
      return _regeneratorRuntime.async(function impWaitCheck$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            beforeMs = new Date().getTime();
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.findElements(strat, sel));

          case 3:
            missingEls = context$3$0.sent;
            afterMs = new Date().getTime();

            (afterMs - beforeMs).should.be.below(impWaitMs + 2000);
            (afterMs - beforeMs).should.be.above(impWaitMs);
            missingEls.should.have.length(0);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    };

    var impWaitCheckSingle = function impWaitCheckSingle(strat, sel, impWaitMs) {
      var beforeMs, afterMs;
      return _regeneratorRuntime.async(function impWaitCheckSingle$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            beforeMs = new Date().getTime();
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.findElement(strat, sel))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 7/));

          case 3:
            afterMs = new Date().getTime();

            (afterMs - beforeMs).should.be.below(impWaitMs + 2000);
            (afterMs - beforeMs).should.be.above(impWaitMs);

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    };

    it('should set the implicit wait for finding elements', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.implicitWait(4000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(impWaitCheck('class name', 'UIANotGonnaBeHere', 4000));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(impWaitCheck('accessibility id', 'FoShoIAintHere', 4000));

          case 6:
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(impWaitCheckSingle('accessibility id', 'FoShoIAintHere', 4000));

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should work with small command timeout', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.timeouts('command', 5000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.implicitWait(10000));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(impWaitCheck('class name', 'UIANotGonnaBeHere', 10000));

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should work even with a reset in the middle', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.timeouts('command', 60000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.implicitWait(4000));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(impWaitCheck('class name', 'UIANotGonnaBeHere', 4000));

          case 6:
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(driver.reset());

          case 8:
            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(_bluebird2['default'].delay(3000));

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(impWaitCheck('class name', 'UIANotGonnaBeHere', 4000));

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });
});
// cooldown
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3Rlc3RhcHAvdGltZW91dC9pbXBsaWNpdC13YWl0LXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozt5QkFBa0Isa0JBQWtCOzs7O3VCQUNoQixZQUFZOzs7OzBCQUNoQixtQkFBbUI7Ozs7d0JBQ3JCLFVBQVU7Ozs7OEJBQ1ksdUJBQXVCOztBQUUzRCxRQUFRLENBQUMsbUJBQW1CLEVBQUUsWUFBWTs7O0FBQ3hDLE1BQUksQ0FBQyxPQUFPLENBQUMsd0JBQUksa0JBQWtCLENBQUMsQ0FBQzs7QUFFckMsV0FBUyxDQUFDOzs7OzsyQ0FBb0Isc0JBQUUsS0FBSyxDQUFDLElBQUksQ0FBQzs7Ozs7OztHQUFHLENBQUMsQ0FBQzs7QUFFaEQsVUFBUSxDQUFDLGVBQWUsRUFBRSxZQUFZOzs7QUFDcEMsUUFBSSxPQUFPLEdBQUcsNEJBQU0sSUFBSSx1QkFBVSxDQUFDO0FBQ25DLFFBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7O0FBRTVCLFFBQUksWUFBWSxHQUFHLFNBQWYsWUFBWSxDQUFtQixLQUFLLEVBQUUsR0FBRyxFQUFFLFNBQVM7VUFDbEQsUUFBUSxFQUNSLFVBQVUsRUFDVixPQUFPOzs7O0FBRlAsb0JBQVEsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRTs7NkNBQ1osTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDOzs7QUFBbEQsc0JBQVU7QUFDVixtQkFBTyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFOztBQUNsQyxhQUFDLE9BQU8sR0FBRyxRQUFRLENBQUEsQ0FBRSxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDdkQsYUFBQyxPQUFPLEdBQUcsUUFBUSxDQUFBLENBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDaEQsc0JBQVUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQzs7Ozs7OztLQUNsQyxDQUFDOztBQUVGLFFBQUksa0JBQWtCLEdBQUcsU0FBckIsa0JBQWtCLENBQW1CLEtBQUssRUFBRSxHQUFHLEVBQUUsU0FBUztVQUN4RCxRQUFRLEVBSVIsT0FBTzs7OztBQUpQLG9CQUFRLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUU7OzZDQUM3QixzQkFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsU0FDdkMscUNBQXFCLENBQzFCLE1BQU0sQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQzs7O0FBQ3RDLG1CQUFPLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUU7O0FBQ2xDLGFBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQSxDQUFFLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsQ0FBQztBQUN2RCxhQUFDLE9BQU8sR0FBRyxRQUFRLENBQUEsQ0FBRSxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQzs7Ozs7OztLQUNqRCxDQUFDOztBQUVGLE1BQUUsQ0FBQyxtREFBbUQsRUFBRTs7Ozs7NkNBQ2hELE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDOzs7OzZDQUN6QixZQUFZLENBQUMsWUFBWSxFQUFFLG1CQUFtQixFQUFFLElBQUksQ0FBQzs7Ozs2Q0FDckQsWUFBWSxDQUFDLGtCQUFrQixFQUFFLGdCQUFnQixFQUFFLElBQUksQ0FBQzs7Ozs2Q0FDeEQsa0JBQWtCLENBQUMsa0JBQWtCLEVBQUUsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDOzs7Ozs7O0tBQ3JFLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsd0NBQXdDLEVBQUU7Ozs7OzZDQUNyQyxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUM7Ozs7NkNBQ2hDLE1BQU0sQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDOzs7OzZDQUMxQixZQUFZLENBQUMsWUFBWSxFQUFFLG1CQUFtQixFQUFFLEtBQUssQ0FBQzs7Ozs7OztLQUM3RCxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLDZDQUE2QyxFQUFFOzs7Ozs2Q0FDMUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDOzs7OzZDQUNqQyxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQzs7Ozs2Q0FDekIsWUFBWSxDQUFDLFlBQVksRUFBRSxtQkFBbUIsRUFBRSxJQUFJLENBQUM7Ozs7NkNBQ3JELE1BQU0sQ0FBQyxLQUFLLEVBQUU7Ozs7NkNBQ2Qsc0JBQUUsS0FBSyxDQUFDLElBQUksQ0FBQzs7Ozs2Q0FDYixZQUFZLENBQUMsWUFBWSxFQUFFLG1CQUFtQixFQUFFLElBQUksQ0FBQzs7Ozs7OztLQUM1RCxDQUFDLENBQUM7R0FFSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvdGVzdGFwcC90aW1lb3V0L2ltcGxpY2l0LXdhaXQtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgc2V0dXAgZnJvbSBcIi4uLy4uL3NldHVwLWJhc2VcIjtcbmltcG9ydCBkZXNpcmVkIGZyb20gJy4uL2Rlc2lyZWQnO1xuaW1wb3J0IGVudiBmcm9tICcuLi8uLi9oZWxwZXJzL2Vudic7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyB0aHJvd01hdGNoYWJsZUVycm9yIH0gZnJvbSAnLi4vLi4vaGVscGVycy9yZWNpcGVzJztcblxuZGVzY3JpYmUoJ3Rlc3RhcHAgLSB0aW1lb3V0JywgZnVuY3Rpb24gKCkge1xuICB0aGlzLnRpbWVvdXQoZW52Lk1PQ0hBX0lOSVRfVElNRU9VVCk7XG5cbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHsgYXdhaXQgQi5kZWxheSgzMDAwKTsgfSk7XG5cbiAgZGVzY3JpYmUoJ2ltcGxpY2l0IHdhaXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHNlc3Npb24gPSBzZXR1cCh0aGlzLCBkZXNpcmVkKTtcbiAgICBsZXQgZHJpdmVyID0gc2Vzc2lvbi5kcml2ZXI7XG5cbiAgICBsZXQgaW1wV2FpdENoZWNrID0gYXN5bmMgZnVuY3Rpb24gKHN0cmF0LCBzZWwsIGltcFdhaXRNcykge1xuICAgICAgbGV0IGJlZm9yZU1zID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICBsZXQgbWlzc2luZ0VscyA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudHMoc3RyYXQsIHNlbCk7XG4gICAgICBsZXQgYWZ0ZXJNcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgKGFmdGVyTXMgLSBiZWZvcmVNcykuc2hvdWxkLmJlLmJlbG93KGltcFdhaXRNcyArIDIwMDApO1xuICAgICAgKGFmdGVyTXMgLSBiZWZvcmVNcykuc2hvdWxkLmJlLmFib3ZlKGltcFdhaXRNcyk7XG4gICAgICBtaXNzaW5nRWxzLnNob3VsZC5oYXZlLmxlbmd0aCgwKTtcbiAgICB9O1xuXG4gICAgbGV0IGltcFdhaXRDaGVja1NpbmdsZSA9IGFzeW5jIGZ1bmN0aW9uIChzdHJhdCwgc2VsLCBpbXBXYWl0TXMpIHtcbiAgICAgIGxldCBiZWZvcmVNcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgYXdhaXQgQi5yZXNvbHZlKGRyaXZlci5maW5kRWxlbWVudChzdHJhdCwgc2VsKSlcbiAgICAgICAgLmNhdGNoKHRocm93TWF0Y2hhYmxlRXJyb3IpXG4gICAgICAgIC5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKC9qc29ud3BDb2RlOiA3Lyk7XG4gICAgICBsZXQgYWZ0ZXJNcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgKGFmdGVyTXMgLSBiZWZvcmVNcykuc2hvdWxkLmJlLmJlbG93KGltcFdhaXRNcyArIDIwMDApO1xuICAgICAgKGFmdGVyTXMgLSBiZWZvcmVNcykuc2hvdWxkLmJlLmFib3ZlKGltcFdhaXRNcyk7XG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgc2V0IHRoZSBpbXBsaWNpdCB3YWl0IGZvciBmaW5kaW5nIGVsZW1lbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLmltcGxpY2l0V2FpdCg0MDAwKTtcbiAgICAgIGF3YWl0IGltcFdhaXRDaGVjaygnY2xhc3MgbmFtZScsICdVSUFOb3RHb25uYUJlSGVyZScsIDQwMDApO1xuICAgICAgYXdhaXQgaW1wV2FpdENoZWNrKCdhY2Nlc3NpYmlsaXR5IGlkJywgJ0ZvU2hvSUFpbnRIZXJlJywgNDAwMCk7XG4gICAgICBhd2FpdCBpbXBXYWl0Q2hlY2tTaW5nbGUoJ2FjY2Vzc2liaWxpdHkgaWQnLCAnRm9TaG9JQWludEhlcmUnLCA0MDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd29yayB3aXRoIHNtYWxsIGNvbW1hbmQgdGltZW91dCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGRyaXZlci50aW1lb3V0cygnY29tbWFuZCcsIDUwMDApO1xuICAgICAgYXdhaXQgZHJpdmVyLmltcGxpY2l0V2FpdCgxMDAwMCk7XG4gICAgICBhd2FpdCBpbXBXYWl0Q2hlY2soJ2NsYXNzIG5hbWUnLCAnVUlBTm90R29ubmFCZUhlcmUnLCAxMDAwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHdvcmsgZXZlbiB3aXRoIGEgcmVzZXQgaW4gdGhlIG1pZGRsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGRyaXZlci50aW1lb3V0cygnY29tbWFuZCcsIDYwMDAwKTtcbiAgICAgIGF3YWl0IGRyaXZlci5pbXBsaWNpdFdhaXQoNDAwMCk7XG4gICAgICBhd2FpdCBpbXBXYWl0Q2hlY2soJ2NsYXNzIG5hbWUnLCAnVUlBTm90R29ubmFCZUhlcmUnLCA0MDAwKTtcbiAgICAgIGF3YWl0IGRyaXZlci5yZXNldCgpO1xuICAgICAgYXdhaXQgQi5kZWxheSgzMDAwKTsgLy8gY29vbGRvd25cbiAgICAgIGF3YWl0IGltcFdhaXRDaGVjaygnY2xhc3MgbmFtZScsICdVSUFOb3RHb25uYUJlSGVyZScsIDQwMDApO1xuICAgIH0pO1xuXG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uLy4uIn0=
