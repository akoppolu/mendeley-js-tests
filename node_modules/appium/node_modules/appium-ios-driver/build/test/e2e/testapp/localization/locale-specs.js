'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _setupBase = require("../../setup-base");

var _setupBase2 = _interopRequireDefault(_setupBase);

var _desired = require('../desired');

var _desired2 = _interopRequireDefault(_desired);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _helpersEnv = require('../../helpers/env');

var _helpersEnv2 = _interopRequireDefault(_helpersEnv);

var _appiumSupport = require('appium-support');

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

describe('localization - locale @skip-real-device', function () {
  var _this = this;

  this.timeout(_helpersEnv2['default'].MOCHA_INIT_TIMEOUT);

  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          if (!process.env.HOME) {
            context$2$0.next = 3;
            break;
          }

          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(_appiumSupport.fs.rimraf(_path2['default'].resolve(process.env.HOME, 'Library/Application Support/iPhone Simulator')));

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  describe('default locale', function () {
    var _this2 = this;

    var session = (0, _setupBase2['default'])(this, _desired2['default']);
    var driver = session.driver;

    it('should be english @skip-ios8', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            res = driver.execute('$.mainApp().preferencesValueForKey("AppleLocale");');

            res.should.become('en_US');

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });

  describe('changing locale @skip-real-device', function () {
    var _this3 = this;

    var session = (0, _setupBase2['default'])(this, _lodash2['default'].defaults({
      locale: 'fr' }, _desired2['default']));
    var driver = session.driver;

    it('should be fr', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            res = driver.execute('$.mainApp().preferencesValueForKey("AppleLocale");');

            res.should.become('fr');

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });
  });

  describe('changing back @skip-real-device', function () {
    var _this4 = this;

    var session = (0, _setupBase2['default'])(this, _lodash2['default'].defaults({
      locale: 'en_US' }, _desired2['default']));
    var driver = session.driver;

    it('should be en', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            res = driver.execute('$.mainApp().preferencesValueForKey("AppleLocale");');

            res.should.become('en_US');

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this4);
    });
  });
});

// cleaning up dir cause we've messed up with the config

// ios8 doesn't do default locale; it will be whatever was last in
// the sim
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3Rlc3RhcHAvbG9jYWxpemF0aW9uL2xvY2FsZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7eUJBQWtCLGtCQUFrQjs7Ozt1QkFDaEIsWUFBWTs7OztzQkFDbEIsUUFBUTs7OzswQkFDTixtQkFBbUI7Ozs7NkJBQ2YsZ0JBQWdCOztvQkFDbkIsTUFBTTs7OztBQUV2QixRQUFRLENBQUMseUNBQXlDLEVBQUUsWUFBWTs7O0FBQzlELE1BQUksQ0FBQyxPQUFPLENBQUMsd0JBQUksa0JBQWtCLENBQUMsQ0FBQzs7QUFFckMsT0FBSyxDQUFDOzs7O2VBQ0EsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJOzs7Ozs7MkNBRVosa0JBQUcsTUFBTSxDQUFDLGtCQUFLLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSw4Q0FBOEMsQ0FBQyxDQUFDOzs7Ozs7O0dBRWxHLENBQUMsQ0FBQztBQUNILFVBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxZQUFZOzs7QUFDckMsUUFBSSxPQUFPLEdBQUcsNEJBQU0sSUFBSSx1QkFBVSxDQUFDO0FBQ25DLFFBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7O0FBRTVCLE1BQUUsQ0FBQyw4QkFBOEIsRUFBRTtVQUc3QixHQUFHOzs7O0FBQUgsZUFBRyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsb0RBQW9ELENBQUM7O0FBQzlFLGVBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDOzs7Ozs7O0tBQzVCLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQzs7QUFFSCxVQUFRLENBQUMsbUNBQW1DLEVBQUUsWUFBWTs7O0FBQ3hELFFBQUksT0FBTyxHQUFHLDRCQUFNLElBQUksRUFBRSxvQkFBRSxRQUFRLENBQUM7QUFDbkMsWUFBTSxFQUFFLElBQUksRUFBQyx1QkFBVSxDQUFDLENBQUM7QUFDM0IsUUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQzs7QUFFNUIsTUFBRSxDQUFDLGNBQWMsRUFBRTtVQUNiLEdBQUc7Ozs7QUFBSCxlQUFHLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxvREFBb0QsQ0FBQzs7QUFDOUUsZUFBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7Ozs7Ozs7S0FDekIsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDOztBQUVILFVBQVEsQ0FBQyxpQ0FBaUMsRUFBRSxZQUFZOzs7QUFDdEQsUUFBSSxPQUFPLEdBQUcsNEJBQU0sSUFBSSxFQUFFLG9CQUFFLFFBQVEsQ0FBQztBQUNuQyxZQUFNLEVBQUUsT0FBTyxFQUFDLHVCQUFVLENBQUMsQ0FBQztBQUM5QixRQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDOztBQUU1QixNQUFFLENBQUMsY0FBYyxFQUFFO1VBQ2IsR0FBRzs7OztBQUFILGVBQUcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLG9EQUFvRCxDQUFDOztBQUM5RSxlQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQzs7Ozs7OztLQUM1QixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FFSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvdGVzdGFwcC9sb2NhbGl6YXRpb24vbG9jYWxlLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHNldHVwIGZyb20gXCIuLi8uLi9zZXR1cC1iYXNlXCI7XG5pbXBvcnQgZGVzaXJlZCBmcm9tICcuLi9kZXNpcmVkJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgZW52IGZyb20gJy4uLy4uL2hlbHBlcnMvZW52JztcbmltcG9ydCB7IGZzIH0gZnJvbSAgJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5kZXNjcmliZSgnbG9jYWxpemF0aW9uIC0gbG9jYWxlIEBza2lwLXJlYWwtZGV2aWNlJywgZnVuY3Rpb24gKCkge1xuICB0aGlzLnRpbWVvdXQoZW52Lk1PQ0hBX0lOSVRfVElNRU9VVCk7XG5cbiAgYWZ0ZXIoYXN5bmMgKCkgPT4ge1xuICAgIGlmIChwcm9jZXNzLmVudi5IT01FKSB7XG4gICAgICAvLyBjbGVhbmluZyB1cCBkaXIgY2F1c2Ugd2UndmUgbWVzc2VkIHVwIHdpdGggdGhlIGNvbmZpZ1xuICAgICAgYXdhaXQgZnMucmltcmFmKHBhdGgucmVzb2x2ZShwcm9jZXNzLmVudi5IT01FLCAnTGlicmFyeS9BcHBsaWNhdGlvbiBTdXBwb3J0L2lQaG9uZSBTaW11bGF0b3InKSk7XG4gICAgfVxuICB9KTtcbiAgZGVzY3JpYmUoJ2RlZmF1bHQgbG9jYWxlJywgZnVuY3Rpb24gKCkge1xuICAgIGxldCBzZXNzaW9uID0gc2V0dXAodGhpcywgZGVzaXJlZCk7XG4gICAgbGV0IGRyaXZlciA9IHNlc3Npb24uZHJpdmVyO1xuXG4gICAgaXQoJ3Nob3VsZCBiZSBlbmdsaXNoIEBza2lwLWlvczgnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBpb3M4IGRvZXNuJ3QgZG8gZGVmYXVsdCBsb2NhbGU7IGl0IHdpbGwgYmUgd2hhdGV2ZXIgd2FzIGxhc3QgaW5cbiAgICAgIC8vIHRoZSBzaW1cbiAgICAgIGxldCByZXMgPSBkcml2ZXIuZXhlY3V0ZSgnJC5tYWluQXBwKCkucHJlZmVyZW5jZXNWYWx1ZUZvcktleShcIkFwcGxlTG9jYWxlXCIpOycpO1xuICAgICAgcmVzLnNob3VsZC5iZWNvbWUoJ2VuX1VTJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjaGFuZ2luZyBsb2NhbGUgQHNraXAtcmVhbC1kZXZpY2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHNlc3Npb24gPSBzZXR1cCh0aGlzLCBfLmRlZmF1bHRzKHtcbiAgICAgIGxvY2FsZTogJ2ZyJ30sIGRlc2lyZWQpKTtcbiAgICBsZXQgZHJpdmVyID0gc2Vzc2lvbi5kcml2ZXI7XG5cbiAgICBpdCgnc2hvdWxkIGJlIGZyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGRyaXZlci5leGVjdXRlKCckLm1haW5BcHAoKS5wcmVmZXJlbmNlc1ZhbHVlRm9yS2V5KFwiQXBwbGVMb2NhbGVcIik7Jyk7XG4gICAgICByZXMuc2hvdWxkLmJlY29tZSgnZnInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NoYW5naW5nIGJhY2sgQHNraXAtcmVhbC1kZXZpY2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IHNlc3Npb24gPSBzZXR1cCh0aGlzLCBfLmRlZmF1bHRzKHtcbiAgICAgIGxvY2FsZTogJ2VuX1VTJ30sIGRlc2lyZWQpKTtcbiAgICBsZXQgZHJpdmVyID0gc2Vzc2lvbi5kcml2ZXI7XG5cbiAgICBpdCgnc2hvdWxkIGJlIGVuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGRyaXZlci5leGVjdXRlKCckLm1haW5BcHAoKS5wcmVmZXJlbmNlc1ZhbHVlRm9yS2V5KFwiQXBwbGVMb2NhbGVcIik7Jyk7XG4gICAgICByZXMuc2hvdWxkLmJlY29tZSgnZW5fVVMnKTtcbiAgICB9KTtcbiAgfSk7XG5cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLi8uLiJ9
