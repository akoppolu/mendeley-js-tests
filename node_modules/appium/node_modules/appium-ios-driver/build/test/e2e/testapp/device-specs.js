"use strict";

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _helpersSession = require('../helpers/session');

var _helpersEnv = require('../helpers/env');

var _helpersEnv2 = _interopRequireDefault(_helpersEnv);

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

require('../helpers/setup_testlibs');

describe('testapp - device @skip-real-device', function () {
  this.timeout(_helpersEnv2['default'].MOCHA_INIT_TIMEOUT);

  describe('invalid deviceName', function () {
    var _this = this;

    it('should fail gracefully with an invalid deviceName', function callee$2$0() {
      var session;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            session = new _helpersSession.Session(_lodash2['default'].defaults({ deviceName: "iFailure 3.5-inch" }, _desired2['default']), { 'no-retry': true });
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(session.setUp()).should.be.rejectedWith(/Could not find a device to launch/));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });
  describe('generic deviceName', function () {
    var _this2 = this;

    var session = undefined;

    afterEach(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(session.tearDown(this.currentTest.state === 'passed'));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should work with a generic iPhone deviceName', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            session = new _helpersSession.Session(_lodash2['default'].defaults({ deviceName: "iPhone Simulator" }, _desired2['default']), { 'no-retry': true });
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(session.setUp());

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should work with a generic iPad deviceName', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            session = new _helpersSession.Session(_lodash2['default'].defaults({ deviceName: "iPad Simulator" }, _desired2['default']), { 'no-retry': true });
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(session.setUp());

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });

  // TODO: reenable when realdevice logic is in
  describe("real device", function () {
    var _this3 = this;

    it("shouldn't try to validate against sims", function callee$2$0() {
      var session;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            session = new _helpersSession.Session(_lodash2['default'].defaults({ deviceName: "BadSimulator", udid: "12341234123412341234" }, _desired2['default']), { 'no-retry': true });
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(session.setUp()).should.be.rejectedWith(/ideviceinstaller/));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3Rlc3RhcHAvZGV2aWNlLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7Ozs7O3NCQUVDLFFBQVE7Ozs7OEJBQ0Usb0JBQW9COzswQkFDNUIsZ0JBQWdCOzs7O3VCQUNaLFdBQVc7Ozs7d0JBQ2pCLFVBQVU7Ozs7UUFDakIsMkJBQTJCOztBQUVsQyxRQUFRLENBQUMsb0NBQW9DLEVBQUUsWUFBWTtBQUN6RCxNQUFJLENBQUMsT0FBTyxDQUFDLHdCQUFJLGtCQUFrQixDQUFDLENBQUM7O0FBRXJDLFVBQVEsQ0FBQyxvQkFBb0IsRUFBRSxZQUFZOzs7QUFDekMsTUFBRSxDQUFDLG1EQUFtRCxFQUFFO1VBQ2xELE9BQU87Ozs7QUFBUCxtQkFBTyxHQUFHLDRCQUFZLG9CQUFFLFFBQVEsQ0FBQyxFQUFDLFVBQVUsRUFBRSxtQkFBbUIsRUFBQyx1QkFBVyxFQUMvRSxFQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUMsQ0FBQzs7NkNBRWYsc0JBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUM3QixNQUFNLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQyxtQ0FBbUMsQ0FBQzs7Ozs7OztLQUMvRCxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7QUFDSCxVQUFRLENBQUMsb0JBQW9CLEVBQUUsWUFBWTs7O0FBQ3pDLFFBQUksT0FBTyxZQUFBLENBQUM7O0FBRVosYUFBUyxDQUFDOzs7Ozs2Q0FDRixPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxLQUFLLFFBQVEsQ0FBQzs7Ozs7OztLQUM1RCxDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLDhDQUE4QyxFQUFFOzs7O0FBQ2pELG1CQUFPLEdBQUcsNEJBQVksb0JBQUUsUUFBUSxDQUFDLEVBQUMsVUFBVSxFQUFFLGtCQUFrQixFQUFDLHVCQUFXLEVBQzFFLEVBQUMsVUFBVSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7OzZDQUNoQixPQUFPLENBQUMsS0FBSyxFQUFFOzs7Ozs7O0tBQ3RCLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsNENBQTRDLEVBQUU7Ozs7QUFDL0MsbUJBQU8sR0FBRyw0QkFBWSxvQkFBRSxRQUFRLENBQUMsRUFBQyxVQUFVLEVBQUUsZ0JBQWdCLEVBQUMsdUJBQVcsRUFDeEUsRUFBQyxVQUFVLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQzs7NkNBQ2hCLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Ozs7Ozs7S0FDdEIsQ0FBQyxDQUFDO0dBRUosQ0FBQyxDQUFDOzs7QUFHSCxVQUFRLENBQUMsYUFBYSxFQUFFLFlBQVk7OztBQUNsQyxNQUFFLENBQUMsd0NBQXdDLEVBQUU7VUFDdkMsT0FBTzs7OztBQUFQLG1CQUFPLEdBQUcsNEJBQ1osb0JBQUUsUUFBUSxDQUFDLEVBQUMsVUFBVSxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsc0JBQXNCLEVBQUMsdUJBQVcsRUFDaEYsRUFBQyxVQUFVLEVBQUUsSUFBSSxFQUFDLENBQ25COzs2Q0FDSyxzQkFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQzdCLE1BQU0sQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLGtCQUFrQixDQUFDOzs7Ozs7O0tBQzlDLENBQUMsQ0FBQztHQUNKLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2UyZS90ZXN0YXBwL2RldmljZS1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgU2Vzc2lvbiB9IGZyb20gJy4uL2hlbHBlcnMvc2Vzc2lvbic7XG5pbXBvcnQgZW52IGZyb20gJy4uL2hlbHBlcnMvZW52JztcbmltcG9ydCBkZXNpcmVkIGZyb20gJy4vZGVzaXJlZCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgJy4uL2hlbHBlcnMvc2V0dXBfdGVzdGxpYnMnO1xuXG5kZXNjcmliZSgndGVzdGFwcCAtIGRldmljZSBAc2tpcC1yZWFsLWRldmljZScsIGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50aW1lb3V0KGVudi5NT0NIQV9JTklUX1RJTUVPVVQpO1xuXG4gIGRlc2NyaWJlKCdpbnZhbGlkIGRldmljZU5hbWUnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBmYWlsIGdyYWNlZnVsbHkgd2l0aCBhbiBpbnZhbGlkIGRldmljZU5hbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgc2Vzc2lvbiA9IG5ldyBTZXNzaW9uKF8uZGVmYXVsdHMoe2RldmljZU5hbWU6IFwiaUZhaWx1cmUgMy41LWluY2hcIn0sICBkZXNpcmVkKSxcbiAgICAgICAgeyduby1yZXRyeSc6IHRydWV9KTtcblxuICAgICAgYXdhaXQgQi5yZXNvbHZlKHNlc3Npb24uc2V0VXAoKSlcbiAgICAgICAgLnNob3VsZC5iZS5yZWplY3RlZFdpdGgoL0NvdWxkIG5vdCBmaW5kIGEgZGV2aWNlIHRvIGxhdW5jaC8pO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2dlbmVyaWMgZGV2aWNlTmFtZScsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgc2Vzc2lvbjtcblxuICAgIGFmdGVyRWFjaChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBzZXNzaW9uLnRlYXJEb3duKHRoaXMuY3VycmVudFRlc3Quc3RhdGUgPT09ICdwYXNzZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd29yayB3aXRoIGEgZ2VuZXJpYyBpUGhvbmUgZGV2aWNlTmFtZScsIGFzeW5jICgpID0+IHtcbiAgICAgIHNlc3Npb24gPSBuZXcgU2Vzc2lvbihfLmRlZmF1bHRzKHtkZXZpY2VOYW1lOiBcImlQaG9uZSBTaW11bGF0b3JcIn0sICBkZXNpcmVkKSxcbiAgICAgICAgeyduby1yZXRyeSc6IHRydWV9KTtcbiAgICAgIGF3YWl0IHNlc3Npb24uc2V0VXAoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgd29yayB3aXRoIGEgZ2VuZXJpYyBpUGFkIGRldmljZU5hbWUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBzZXNzaW9uID0gbmV3IFNlc3Npb24oXy5kZWZhdWx0cyh7ZGV2aWNlTmFtZTogXCJpUGFkIFNpbXVsYXRvclwifSwgIGRlc2lyZWQpLFxuICAgICAgICB7J25vLXJldHJ5JzogdHJ1ZX0pO1xuICAgICAgYXdhaXQgc2Vzc2lvbi5zZXRVcCgpO1xuICAgIH0pO1xuXG4gIH0pO1xuXG4gIC8vIFRPRE86IHJlZW5hYmxlIHdoZW4gcmVhbGRldmljZSBsb2dpYyBpcyBpblxuICBkZXNjcmliZShcInJlYWwgZGV2aWNlXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBpdChcInNob3VsZG4ndCB0cnkgdG8gdmFsaWRhdGUgYWdhaW5zdCBzaW1zXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBzZXNzaW9uID0gbmV3IFNlc3Npb24oXG4gICAgICAgIF8uZGVmYXVsdHMoe2RldmljZU5hbWU6IFwiQmFkU2ltdWxhdG9yXCIsIHVkaWQ6IFwiMTIzNDEyMzQxMjM0MTIzNDEyMzRcIn0sICBkZXNpcmVkKSxcbiAgICAgICAgeyduby1yZXRyeSc6IHRydWV9XG4gICAgICApO1xuICAgICAgYXdhaXQgQi5yZXNvbHZlKHNlc3Npb24uc2V0VXAoKSlcbiAgICAgICAgLnNob3VsZC5iZS5yZWplY3RlZFdpdGgoL2lkZXZpY2VpbnN0YWxsZXIvKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4ifQ==
