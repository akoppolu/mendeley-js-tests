'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _setupBase = require("../setup-base");

var _setupBase2 = _interopRequireDefault(_setupBase);

var _helpersSession = require('../helpers/session');

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _helpersRecipes = require('../helpers/recipes');

describe('testapp - location - 1 @skip-ci', function () {
  var _this = this;

  var session = (0, _setupBase2['default'])(this, _desired2['default']);
  var driver = session.driver;

  it('should return the right x/y coordinates for getLocation', function callee$1$0() {
    var el, loc;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('class name', 'UIAButton'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getLocation(el));

        case 5:
          loc = context$2$0.sent;

          [94, 110].should.contain(parseInt(loc.x, 10));
          loc.y.should.be.above(120);

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should return the right x/y coordinates for getLocationInView', function callee$1$0() {
    var el, loc;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('class name', 'UIAButton'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getLocation(el));

        case 5:
          loc = context$2$0.sent;

          [94, 110].should.contain(parseInt(loc.x, 10));
          loc.y.should.be.above(120);

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should not error with valid lat/lon and no options', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.setGeoLocation({ latitude: -30, longitude: 30 }));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should error with invalid lat/lon and no options', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(driver.setGeoLocation({ latitude: -150, longitude: 30 }))['catch'](_helpersRecipes.throwMatchableError).should.be.rejectedWith(/jsonwpCode: 17 latitude/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});

describe('testapp - location - 2 @skip-ci', function () {
  var _this2 = this;

  var session = (0, _setupBase2['default'])(this, _lodash2['default'].defaults({ locationServicesAuthorized: true, bundleId: 'io.appium.TestApp' }, _desired2['default']), { noReset: true });
  var driver = session.driver;

  it('should be able to be turned on', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('accessibility id', 'locationStatus'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getAttribute('value', el));

        case 5:
          context$2$0.sent.should.equal(1);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this2);
  });
});

describe('testapp - location - 3 @skip-ci', function () {
  var _this3 = this;

  it('should not work without bundleId', function callee$1$0() {
    var session;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          session = new _helpersSession.Session(_lodash2['default'].defaults({ locationServicesAuthorized: true }, _desired2['default']), { 'no-retry': true });
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(_bluebird2['default'].resolve(session.setUp()).should.be.rejectedWith(/must set the bundleId/));

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this3);
  });
});

describe('testapp - location - 4 @skip-ci @skip-real-device', function () {
  var _this4 = this;

  var session = (0, _setupBase2['default'])(this, _lodash2['default'].defaults({ locationServicesAuthorized: false, bundleId: 'io.appium.TestApp' }, _desired2['default']), { noReset: true });
  var driver = session.driver;

  it('should be able to be turned off', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('accessibility id', 'locationStatus'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getAttribute('value', el));

        case 5:
          context$2$0.sent.should.equal(0);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this4);
  });
});

describe('testapp - location - 5 @skip-ci', function () {
  var _this5 = this;

  var session = (0, _setupBase2['default'])(this, _lodash2['default'].defaults({
    locationServicesAuthorized: true,
    bundleId: 'io.appium.TestApp',
    app: 'test/assets/TestApp.zip'
  }, _desired2['default']), { noReset: true });
  var driver = session.driver;

  it('should be able to be turned on when using a zip/ipa file', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.findElement('accessibility id', 'locationStatus'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.getAttribute('value', el));

        case 5:
          context$2$0.sent.should.equal(1);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this5);
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3Rlc3RhcHAvbG9jYXRpb24tc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O3lCQUFrQixlQUFlOzs7OzhCQUNULG9CQUFvQjs7dUJBQ3hCLFdBQVc7Ozs7d0JBQ2pCLFVBQVU7Ozs7c0JBQ1YsUUFBUTs7Ozs4QkFDYyxvQkFBb0I7O0FBR3hELFFBQVEsQ0FBQyxpQ0FBaUMsRUFBRSxZQUFZOzs7QUFDdEQsTUFBSSxPQUFPLEdBQUcsNEJBQU0sSUFBSSx1QkFBVSxDQUFDO0FBQ25DLE1BQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7O0FBRTVCLElBQUUsQ0FBQyx5REFBeUQsRUFBRTtRQUN4RCxFQUFFLEVBQ0YsR0FBRzs7Ozs7MkNBRFEsTUFBTSxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUUsV0FBVyxDQUFDOzs7QUFBeEQsWUFBRTs7MkNBQ1UsTUFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7OztBQUFsQyxhQUFHOztBQUNQLFdBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUM5QyxhQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDOzs7Ozs7O0dBQzVCLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsK0RBQStELEVBQUU7UUFDOUQsRUFBRSxFQUNGLEdBQUc7Ozs7OzJDQURRLE1BQU0sQ0FBQyxXQUFXLENBQUMsWUFBWSxFQUFFLFdBQVcsQ0FBQzs7O0FBQXhELFlBQUU7OzJDQUNVLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDOzs7QUFBbEMsYUFBRzs7QUFDUCxXQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FB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OEJBQTBCLEVBQUUsSUFBSTtBQUNoQyxZQUFRLEVBQUUsbUJBQW1CO0FBQzdCLE9BQUcsRUFBRSx5QkFBeUI7R0FDL0IsdUJBQVUsRUFBRSxFQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO0FBQzlCLE1BQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7O0FBRTVCLElBQUUsQ0FBQywwREFBMEQsRUFBRTtRQUN6RCxFQUFFOzs7OzsyQ0FBUyxNQUFNLENBQUMsV0FBVyxDQUFDLGtCQUFrQixFQUFFLGdCQUFnQixDQUFDOzs7QUFBbkUsWUFBRTs7MkNBQ0MsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDOzs7MkJBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDOzs7Ozs7O0dBQ3hELENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2UyZS90ZXN0YXBwL2xvY2F0aW9uLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHNldHVwIGZyb20gXCIuLi9zZXR1cC1iYXNlXCI7XG5pbXBvcnQgeyBTZXNzaW9uIH0gZnJvbSAnLi4vaGVscGVycy9zZXNzaW9uJztcbmltcG9ydCBkZXNpcmVkIGZyb20gJy4vZGVzaXJlZCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgdGhyb3dNYXRjaGFibGVFcnJvciB9IGZyb20gJy4uL2hlbHBlcnMvcmVjaXBlcyc7XG5cblxuZGVzY3JpYmUoJ3Rlc3RhcHAgLSBsb2NhdGlvbiAtIDEgQHNraXAtY2knLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBzZXNzaW9uID0gc2V0dXAodGhpcywgZGVzaXJlZCk7XG4gIGxldCBkcml2ZXIgPSBzZXNzaW9uLmRyaXZlcjtcblxuICBpdCgnc2hvdWxkIHJldHVybiB0aGUgcmlnaHQgeC95IGNvb3JkaW5hdGVzIGZvciBnZXRMb2NhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2NsYXNzIG5hbWUnLCAnVUlBQnV0dG9uJyk7XG4gICAgbGV0IGxvYyA9IGF3YWl0IGRyaXZlci5nZXRMb2NhdGlvbihlbCk7XG4gICAgWzk0LCAxMTBdLnNob3VsZC5jb250YWluKHBhcnNlSW50KGxvYy54LCAxMCkpO1xuICAgIGxvYy55LnNob3VsZC5iZS5hYm92ZSgxMjApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJldHVybiB0aGUgcmlnaHQgeC95IGNvb3JkaW5hdGVzIGZvciBnZXRMb2NhdGlvbkluVmlldycsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2NsYXNzIG5hbWUnLCAnVUlBQnV0dG9uJyk7XG4gICAgbGV0IGxvYyA9IGF3YWl0IGRyaXZlci5nZXRMb2NhdGlvbihlbCk7XG4gICAgWzk0LCAxMTBdLnNob3VsZC5jb250YWluKHBhcnNlSW50KGxvYy54LCAxMCkpO1xuICAgIGxvYy55LnNob3VsZC5iZS5hYm92ZSgxMjApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIG5vdCBlcnJvciB3aXRoIHZhbGlkIGxhdC9sb24gYW5kIG5vIG9wdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgZHJpdmVyLnNldEdlb0xvY2F0aW9uKHtsYXRpdHVkZTogLTMwLCBsb25naXR1ZGU6IDMwfSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZXJyb3Igd2l0aCBpbnZhbGlkIGxhdC9sb24gYW5kIG5vIG9wdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgQi5yZXNvbHZlKGRyaXZlci5zZXRHZW9Mb2NhdGlvbih7bGF0aXR1ZGU6IC0xNTAsIGxvbmdpdHVkZTogMzB9KSlcbiAgICAgIC5jYXRjaCh0aHJvd01hdGNoYWJsZUVycm9yKVxuICAgICAgLnNob3VsZC5iZS5yZWplY3RlZFdpdGgoL2pzb253cENvZGU6IDE3IGxhdGl0dWRlLyk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCd0ZXN0YXBwIC0gbG9jYXRpb24gLSAyIEBza2lwLWNpJywgZnVuY3Rpb24gKCkge1xuICBsZXQgc2Vzc2lvbiA9IHNldHVwKHRoaXMsIF8uZGVmYXVsdHMoXG4gICAge2xvY2F0aW9uU2VydmljZXNBdXRob3JpemVkOiB0cnVlLCBidW5kbGVJZDogJ2lvLmFwcGl1bS5UZXN0QXBwJ30sXG4gICAgZGVzaXJlZCksIHtub1Jlc2V0OiB0cnVlfSk7XG4gIGxldCBkcml2ZXIgPSBzZXNzaW9uLmRyaXZlcjtcblxuICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gYmUgdHVybmVkIG9uJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsICdsb2NhdGlvblN0YXR1cycpO1xuICAgIChhd2FpdCBkcml2ZXIuZ2V0QXR0cmlidXRlKCd2YWx1ZScsIGVsKSkuc2hvdWxkLmVxdWFsKDEpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgndGVzdGFwcCAtIGxvY2F0aW9uIC0gMyBAc2tpcC1jaScsIGZ1bmN0aW9uICgpIHtcblxuICBpdCgnc2hvdWxkIG5vdCB3b3JrIHdpdGhvdXQgYnVuZGxlSWQnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IHNlc3Npb24gPSBuZXcgU2Vzc2lvbihfLmRlZmF1bHRzKHtsb2NhdGlvblNlcnZpY2VzQXV0aG9yaXplZDogdHJ1ZX0sICBkZXNpcmVkKSxcbiAgICAgIHsnbm8tcmV0cnknOiB0cnVlfSk7XG4gICAgYXdhaXQgQi5yZXNvbHZlKHNlc3Npb24uc2V0VXAoKSlcbiAgICAgIC5zaG91bGQuYmUucmVqZWN0ZWRXaXRoKC9tdXN0IHNldCB0aGUgYnVuZGxlSWQvKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3Rlc3RhcHAgLSBsb2NhdGlvbiAtIDQgQHNraXAtY2kgQHNraXAtcmVhbC1kZXZpY2UnLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBzZXNzaW9uID0gc2V0dXAodGhpcywgXy5kZWZhdWx0cyhcbiAgICB7bG9jYXRpb25TZXJ2aWNlc0F1dGhvcml6ZWQ6IGZhbHNlLCBidW5kbGVJZDogJ2lvLmFwcGl1bS5UZXN0QXBwJ30sXG4gICAgZGVzaXJlZCksIHtub1Jlc2V0OiB0cnVlfSk7XG4gIGxldCBkcml2ZXIgPSBzZXNzaW9uLmRyaXZlcjtcblxuICBpdCgnc2hvdWxkIGJlIGFibGUgdG8gYmUgdHVybmVkIG9mZicsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2FjY2Vzc2liaWxpdHkgaWQnLCAnbG9jYXRpb25TdGF0dXMnKTtcbiAgICAoYXdhaXQgZHJpdmVyLmdldEF0dHJpYnV0ZSgndmFsdWUnLCBlbCkpLnNob3VsZC5lcXVhbCgwKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3Rlc3RhcHAgLSBsb2NhdGlvbiAtIDUgQHNraXAtY2knLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBzZXNzaW9uID0gc2V0dXAodGhpcywgXy5kZWZhdWx0cyh7XG4gICAgbG9jYXRpb25TZXJ2aWNlc0F1dGhvcml6ZWQ6IHRydWUsXG4gICAgYnVuZGxlSWQ6ICdpby5hcHBpdW0uVGVzdEFwcCcsXG4gICAgYXBwOiAndGVzdC9hc3NldHMvVGVzdEFwcC56aXAnXG4gIH0sIGRlc2lyZWQpLCB7bm9SZXNldDogdHJ1ZX0pO1xuICBsZXQgZHJpdmVyID0gc2Vzc2lvbi5kcml2ZXI7XG5cbiAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIGJlIHR1cm5lZCBvbiB3aGVuIHVzaW5nIGEgemlwL2lwYSBmaWxlJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxlbWVudCgnYWNjZXNzaWJpbGl0eSBpZCcsICdsb2NhdGlvblN0YXR1cycpO1xuICAgIChhd2FpdCBkcml2ZXIuZ2V0QXR0cmlidXRlKCd2YWx1ZScsIGVsKSkuc2hvdWxkLmVxdWFsKDEpO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLiJ9
