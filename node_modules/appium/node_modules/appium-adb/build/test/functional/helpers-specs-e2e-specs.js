'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _libHelpersJs = require('../../lib/helpers.js');

var _appiumSupport = require('appium-support');

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

function getFixture(file) {
  return _path2['default'].resolve(__dirname, '..', '..', '..', 'test', 'fixtures', file);
}

var should = _chai2['default'].should(),
    apkPath = _path2['default'].resolve(_libHelpersJs.rootDir, 'test', 'fixtures', 'ContactManager.apk');
_chai2['default'].use(_chaiAsPromised2['default']);

describe('Helpers', function () {
  it('getAndroidPlatformAndPath should return null', function callee$1$0() {
    var android_home, result;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          android_home = process.env.ANDROID_HOME;

          // temp setting android_home to null.
          process.env.ANDROID_HOME = null;
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap((0, _libHelpersJs.getAndroidPlatformAndPath)());

        case 4:
          result = context$2$0.sent;

          should.not.exist(result);
          // resetting ANDROID_HOME
          process.env.ANDROID_HOME = android_home;

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('getAndroidPlatformAndPath should return platform and path for android', function callee$1$0() {
    var _ref, platform, platformPath;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _libHelpersJs.getAndroidPlatformAndPath)());

        case 2:
          _ref = context$2$0.sent;
          platform = _ref.platform;
          platformPath = _ref.platformPath;

          platform.should.exist;
          platformPath.should.exist;

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  // TODO make it work on CI
  it.skip('assertZipArchive should assert zip existing', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _libHelpersJs.assertZipArchive)(apkPath));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  describe('unzipFile', function () {
    it('should unzip a .zip file', function callee$2$0() {
      var temp;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_appiumSupport.tempDir.openDir());

          case 2:
            temp = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.copyFile(getFixture('TestZip.zip'), _path2['default'].resolve(temp, 'TestZip.zip')));

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap((0, _libHelpersJs.unzipFile)(_path2['default'].resolve(temp, 'TestZip.zip')));

          case 7:
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.readFile(_path2['default'].resolve(temp, 'TestZip', 'a.txt'), 'utf8').should.eventually.equal('Hello World'));

          case 9:
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.readFile(_path2['default'].resolve(temp, 'TestZip', 'b.txt'), 'utf8').should.eventually.equal('Foobar'));

          case 11:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should unzip a .zip file (force isWindows to be true so we can test the internal zip library)', function callee$2$0() {
      var forceWindows, temp;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            forceWindows = _sinon2['default'].stub(_appiumSupport.system, 'isWindows', function () {
              return true;
            });
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_appiumSupport.tempDir.openDir());

          case 3:
            temp = context$3$0.sent;
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.copyFile(getFixture('TestZip.zip'), _path2['default'].resolve(temp, 'TestZip.zip')));

          case 6:
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap((0, _libHelpersJs.unzipFile)(_path2['default'].resolve(temp, 'TestZip.zip')));

          case 8:
            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.readFile(_path2['default'].resolve(temp, 'TestZip', 'a.txt'), 'utf8').should.eventually.equal('Hello World'));

          case 10:
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.readFile(_path2['default'].resolve(temp, 'TestZip', 'b.txt'), 'utf8').should.eventually.equal('Foobar'));

          case 12:
            forceWindows.restore();

          case 13:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9oZWxwZXJzLXNwZWNzLWUyZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7OztvQkFBaUIsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7NEJBQ21DLHNCQUFzQjs7NkJBQ2xFLGdCQUFnQjs7cUJBQ2xDLE9BQU87Ozs7b0JBQ1IsTUFBTTs7OztBQUV2QixTQUFTLFVBQVUsQ0FBRSxJQUFJLEVBQUU7QUFDekIsU0FBTyxrQkFBSyxPQUFPLENBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFDbkMsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO0NBQ3ZDOztBQUdELElBQU0sTUFBTSxHQUFHLGtCQUFLLE1BQU0sRUFBRTtJQUN0QixPQUFPLEdBQUcsa0JBQUssT0FBTyx3QkFBVSxNQUFNLEVBQ2YsVUFBVSxFQUFFLG9CQUFvQixDQUFDLENBQUM7QUFDL0Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsUUFBUSxDQUFDLFNBQVMsRUFBRSxZQUFNO0FBQ3hCLElBQUUsQ0FBQyw4Q0FBOEMsRUFBRTtRQUM3QyxZQUFZLEVBR1osTUFBTTs7OztBQUhOLHNCQUFZLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZOzs7QUFFM0MsaUJBQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQzs7MkNBQ2IsOENBQTJCOzs7QUFBMUMsZ0JBQU07O0FBQ1YsZ0JBQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDOztBQUV6QixpQkFBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDOzs7Ozs7O0dBQ3pDLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsdUVBQXVFLEVBQUU7Y0FDckUsUUFBUSxFQUFFLFlBQVk7Ozs7OzsyQ0FBVSw4Q0FBMkI7Ozs7QUFBM0Qsa0JBQVEsUUFBUixRQUFRO0FBQUUsc0JBQVksUUFBWixZQUFZOztBQUMzQixrQkFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7QUFDdEIsc0JBQVksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDOzs7Ozs7O0dBQzNCLENBQUMsQ0FBQzs7QUFFSCxJQUFFLENBQUMsSUFBSSxDQUFDLDZDQUE2QyxFQUFFOzs7OzsyQ0FDL0Msb0NBQWlCLE9BQU8sQ0FBQzs7Ozs7OztHQUNoQyxDQUFDLENBQUM7O0FBRUgsVUFBUSxDQUFDLFdBQVcsRUFBRSxZQUFNO0FBQzFCLE1BQUUsQ0FBQywwQkFBMEIsRUFBRTtVQUN2QixJQUFJOzs7Ozs2Q0FBUyx1QkFBUSxPQUFPLEVBQUU7OztBQUE5QixnQkFBSTs7NkNBQ0osa0JBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsRUFBRSxrQkFBSyxPQUFPLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFDOzs7OzZDQUN6RSw2QkFBVSxrQkFBSyxPQUFPLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFDOzs7OzZDQUM1QyxrQkFBRyxRQUFRLENBQUMsa0JBQUssT0FBTyxDQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsT0FBTyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDOzs7OzZDQUNsRyxrQkFBRyxRQUFRLENBQUMsa0JBQUssT0FBTyxDQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsT0FBTyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDOzs7Ozs7O0tBQ3BHLENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsK0ZBQStGLEVBQUU7VUFDNUYsWUFBWSxFQUNaLElBQUk7Ozs7QUFESix3QkFBWSxHQUFHLG1CQUFNLElBQUksd0JBQVMsV0FBVyxFQUFFO3FCQUFNLElBQUk7YUFBQSxDQUFDOzs2Q0FDN0MsdUJBQVEsT0FBTyxFQUFFOzs7QUFBOUIsZ0JBQUk7OzZDQUNKLGtCQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLEVBQUUsa0JBQUssT0FBTyxDQUFDLElBQUksRUFBRSxhQUFhLENBQUMsQ0FBQzs7Ozs2Q0FDekUsNkJBQVUsa0JBQUssT0FBTyxDQUFDLElBQUksRUFBRSxhQUFhLENBQUMsQ0FBQzs7Ozs2Q0FDNUMsa0JBQUcsUUFBUSxDQUFDLGtCQUFLLE9BQU8sQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQzs7Ozs2Q0FDbEcsa0JBQUcsUUFBUSxDQUFDLGtCQUFLLE9BQU8sQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQzs7O0FBQ25HLHdCQUFZLENBQUMsT0FBTyxFQUFFLENBQUM7Ozs7Ozs7S0FDeEIsQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBRUosQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvZnVuY3Rpb25hbC9oZWxwZXJzLXNwZWNzLWUyZS1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuaW1wb3J0IHsgZ2V0QW5kcm9pZFBsYXRmb3JtQW5kUGF0aCwgYXNzZXJ0WmlwQXJjaGl2ZSwgcm9vdERpciwgdW56aXBGaWxlIH0gZnJvbSAnLi4vLi4vbGliL2hlbHBlcnMuanMnO1xuaW1wb3J0IHsgZnMsIHRlbXBEaXIsIHN5c3RlbSB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuZnVuY3Rpb24gZ2V0Rml4dHVyZSAoZmlsZSkge1xuICByZXR1cm4gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJy4uJywgJ3Rlc3QnLFxuICAgICAgICAgICAgICAgICAgICAgICdmaXh0dXJlcycsIGZpbGUpO1xufVxuXG5cbmNvbnN0IHNob3VsZCA9IGNoYWkuc2hvdWxkKCksXG4gICAgICBhcGtQYXRoID0gcGF0aC5yZXNvbHZlKHJvb3REaXIsICd0ZXN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2ZpeHR1cmVzJywgJ0NvbnRhY3RNYW5hZ2VyLmFwaycpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5kZXNjcmliZSgnSGVscGVycycsICgpID0+IHtcbiAgaXQoJ2dldEFuZHJvaWRQbGF0Zm9ybUFuZFBhdGggc2hvdWxkIHJldHVybiBudWxsJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBhbmRyb2lkX2hvbWUgPSBwcm9jZXNzLmVudi5BTkRST0lEX0hPTUU7XG4gICAgLy8gdGVtcCBzZXR0aW5nIGFuZHJvaWRfaG9tZSB0byBudWxsLlxuICAgIHByb2Nlc3MuZW52LkFORFJPSURfSE9NRSA9IG51bGw7XG4gICAgbGV0IHJlc3VsdCA9IGF3YWl0IGdldEFuZHJvaWRQbGF0Zm9ybUFuZFBhdGgoKTtcbiAgICBzaG91bGQubm90LmV4aXN0KHJlc3VsdCk7XG4gICAgLy8gcmVzZXR0aW5nIEFORFJPSURfSE9NRVxuICAgIHByb2Nlc3MuZW52LkFORFJPSURfSE9NRSA9IGFuZHJvaWRfaG9tZTtcbiAgfSk7XG5cbiAgaXQoJ2dldEFuZHJvaWRQbGF0Zm9ybUFuZFBhdGggc2hvdWxkIHJldHVybiBwbGF0Zm9ybSBhbmQgcGF0aCBmb3IgYW5kcm9pZCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQge3BsYXRmb3JtLCBwbGF0Zm9ybVBhdGh9ID0gYXdhaXQgZ2V0QW5kcm9pZFBsYXRmb3JtQW5kUGF0aCgpO1xuICAgIHBsYXRmb3JtLnNob3VsZC5leGlzdDtcbiAgICBwbGF0Zm9ybVBhdGguc2hvdWxkLmV4aXN0O1xuICB9KTtcbiAgLy8gVE9ETyBtYWtlIGl0IHdvcmsgb24gQ0lcbiAgaXQuc2tpcCgnYXNzZXJ0WmlwQXJjaGl2ZSBzaG91bGQgYXNzZXJ0IHppcCBleGlzdGluZycsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBhc3NlcnRaaXBBcmNoaXZlKGFwa1BhdGgpO1xuICB9KTtcblxuICBkZXNjcmliZSgndW56aXBGaWxlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdW56aXAgYSAuemlwIGZpbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZW1wID0gYXdhaXQgdGVtcERpci5vcGVuRGlyKCk7XG4gICAgICBhd2FpdCBmcy5jb3B5RmlsZShnZXRGaXh0dXJlKCdUZXN0WmlwLnppcCcpLCBwYXRoLnJlc29sdmUodGVtcCwgJ1Rlc3RaaXAuemlwJykpO1xuICAgICAgYXdhaXQgdW56aXBGaWxlKHBhdGgucmVzb2x2ZSh0ZW1wLCAnVGVzdFppcC56aXAnKSk7XG4gICAgICBhd2FpdCBmcy5yZWFkRmlsZShwYXRoLnJlc29sdmUodGVtcCwgJ1Rlc3RaaXAnLCAnYS50eHQnKSwgJ3V0ZjgnKS5zaG91bGQuZXZlbnR1YWxseS5lcXVhbCgnSGVsbG8gV29ybGQnKTtcbiAgICAgIGF3YWl0IGZzLnJlYWRGaWxlKHBhdGgucmVzb2x2ZSh0ZW1wLCAnVGVzdFppcCcsICdiLnR4dCcpLCAndXRmOCcpLnNob3VsZC5ldmVudHVhbGx5LmVxdWFsKCdGb29iYXInKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdW56aXAgYSAuemlwIGZpbGUgKGZvcmNlIGlzV2luZG93cyB0byBiZSB0cnVlIHNvIHdlIGNhbiB0ZXN0IHRoZSBpbnRlcm5hbCB6aXAgbGlicmFyeSknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBmb3JjZVdpbmRvd3MgPSBzaW5vbi5zdHViKHN5c3RlbSwgJ2lzV2luZG93cycsICgpID0+IHRydWUpO1xuICAgICAgY29uc3QgdGVtcCA9IGF3YWl0IHRlbXBEaXIub3BlbkRpcigpO1xuICAgICAgYXdhaXQgZnMuY29weUZpbGUoZ2V0Rml4dHVyZSgnVGVzdFppcC56aXAnKSwgcGF0aC5yZXNvbHZlKHRlbXAsICdUZXN0WmlwLnppcCcpKTtcbiAgICAgIGF3YWl0IHVuemlwRmlsZShwYXRoLnJlc29sdmUodGVtcCwgJ1Rlc3RaaXAuemlwJykpO1xuICAgICAgYXdhaXQgZnMucmVhZEZpbGUocGF0aC5yZXNvbHZlKHRlbXAsICdUZXN0WmlwJywgJ2EudHh0JyksICd1dGY4Jykuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJ0hlbGxvIFdvcmxkJyk7XG4gICAgICBhd2FpdCBmcy5yZWFkRmlsZShwYXRoLnJlc29sdmUodGVtcCwgJ1Rlc3RaaXAnLCAnYi50eHQnKSwgJ3V0ZjgnKS5zaG91bGQuZXZlbnR1YWxseS5lcXVhbCgnRm9vYmFyJyk7XG4gICAgICBmb3JjZVdpbmRvd3MucmVzdG9yZSgpO1xuICAgIH0pO1xuICB9KTtcblxufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
