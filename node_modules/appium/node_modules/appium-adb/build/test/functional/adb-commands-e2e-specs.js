'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _ = require('../..');

var _2 = _interopRequireDefault(_);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _libHelpersJs = require('../../lib/helpers.js');

var _setup = require('./setup');

_chai2['default'].use(_chaiAsPromised2['default']);
var expect = _chai2['default'].expect;

// change according to CI
var IME = 'com.example.android.softkeyboard/.SoftKeyboard',
    defaultIMEs = ['com.android.inputmethod.latin/.LatinIME', 'io.appium.android.ime/.UnicodeIME'],
    contactManagerPath = _path2['default'].resolve(_libHelpersJs.rootDir, 'test', 'fixtures', 'ContactManager.apk'),
    pkg = 'com.example.android.contactmanager',
    activity = 'ContactManager';

describe('adb commands', function () {
  var _this = this;

  this.timeout(_setup.MOCHA_TIMEOUT);

  var adb = undefined;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_2['default'].createADB());

        case 2:
          adb = context$2$0.sent;

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('getApiLevel should get correct api level', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.getApiLevel());

        case 2:
          context$2$0.t0 = _setup.apiLevel;
          context$2$0.sent.should.equal(context$2$0.t0);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('getPlatformVersion should get correct platform version', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.getPlatformVersion());

        case 2:
          context$2$0.t0 = _setup.platformVersion;
          context$2$0.sent.should.include(context$2$0.t0);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('availableIMEs should get list of available IMEs', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.availableIMEs());

        case 2:
          context$2$0.sent.should.have.length.above(0);

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('enabledIMEs should get list of enabled IMEs', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.enabledIMEs());

        case 2:
          context$2$0.sent.should.have.length.above(0);

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('defaultIME should get default IME', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.t0 = defaultIMEs.should;
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(adb.defaultIME());

        case 3:
          context$2$0.t1 = context$2$0.sent;
          context$2$0.t0.include.call(context$2$0.t0, context$2$0.t1);

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('enableIME and disableIME should enable and disble IME', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.disableIME(IME));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(adb.enabledIMEs());

        case 4:
          context$2$0.t0 = IME;
          context$2$0.sent.should.not.include(context$2$0.t0);
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(adb.enableIME(IME));

        case 8:
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(adb.enabledIMEs());

        case 10:
          context$2$0.t1 = IME;
          context$2$0.sent.should.include(context$2$0.t1);
          context$2$0.next = 14;
          return _regeneratorRuntime.awrap(adb.enabledIMEs());

        case 14:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('processExists should be able to find ui process', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.processExists('com.android.systemui'));

        case 2:
          context$2$0.sent.should.be['true'];

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('ping should return true', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.ping());

        case 2:
          context$2$0.sent.should.be['true'];

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('getPIDsByName should return pids', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.getPIDsByName('m.android.phone'));

        case 2:
          context$2$0.sent.should.have.length.above(0);

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('killProcessesByName should kill process', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(adb.startApp({ pkg: pkg, activity: activity }));

        case 4:
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(adb.killProcessesByName(pkg));

        case 6:
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(adb.getPIDsByName(pkg));

        case 8:
          context$2$0.sent.should.have.length(0);

        case 9:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('killProcessByPID should kill process', function callee$1$0() {
    var pids;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.install(contactManagerPath));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(adb.startApp({ pkg: pkg, activity: activity }));

        case 4:
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(adb.getPIDsByName(pkg));

        case 6:
          pids = context$2$0.sent;

          pids.should.have.length.above(0);
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(adb.killProcessByPID(pids[0]));

        case 10:
          context$2$0.next = 12;
          return _regeneratorRuntime.awrap(adb.getPIDsByName(pkg));

        case 12:
          context$2$0.sent.length.should.equal(0);

        case 13:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should get device language and country', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          if (!(parseInt(_setup.apiLevel, 10) >= 23)) {
            context$2$0.next = 2;
            break;
          }

          return context$2$0.abrupt('return', this.skip());

        case 2:
          if (!process.env.TRAVIS) {
            context$2$0.next = 4;
            break;
          }

          return context$2$0.abrupt('return', this.skip());

        case 4:
          context$2$0.t0 = ['en', 'fr'].should;
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(adb.getDeviceSysLanguage());

        case 7:
          context$2$0.t1 = context$2$0.sent;
          context$2$0.t0.contain.call(context$2$0.t0, context$2$0.t1);
          context$2$0.t2 = ['US', 'EN_US', 'EN', 'FR'].should;
          context$2$0.next = 12;
          return _regeneratorRuntime.awrap(adb.getDeviceSysCountry());

        case 12:
          context$2$0.t3 = context$2$0.sent;
          context$2$0.t2.contain.call(context$2$0.t2, context$2$0.t3);

        case 14:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should set device language and country', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          if (!(parseInt(_setup.apiLevel, 10) >= 23)) {
            context$2$0.next = 2;
            break;
          }

          return context$2$0.abrupt('return', this.skip());

        case 2:
          if (!process.env.TRAVIS) {
            context$2$0.next = 4;
            break;
          }

          return context$2$0.abrupt('return', this.skip());

        case 4:
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(adb.setDeviceSysLanguage('fr'));

        case 6:
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(adb.setDeviceSysCountry('fr'));

        case 8:
          context$2$0.next = 10;
          return _regeneratorRuntime.awrap(adb.reboot());

        case 10:
          context$2$0.next = 12;
          return _regeneratorRuntime.awrap(adb.getDeviceSysLanguage().should.eventually.equal('fr'));

        case 12:
          context$2$0.next = 14;
          return _regeneratorRuntime.awrap(adb.getDeviceSysCountry().should.eventually.equal('FR'));

        case 14:
          context$2$0.next = 16;
          return _regeneratorRuntime.awrap(adb.setDeviceSysLanguage('en'));

        case 16:
          context$2$0.next = 18;
          return _regeneratorRuntime.awrap(adb.setDeviceSysCountry('us'));

        case 18:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should get device locale', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          if (!(parseInt(_setup.apiLevel, 10) < 23)) {
            context$2$0.next = 2;
            break;
          }

          return context$2$0.abrupt('return', this.skip());

        case 2:
          context$2$0.t0 = ['us'].should;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(adb.getDeviceLocale());

        case 5:
          context$2$0.t1 = context$2$0.sent;
          context$2$0.t0.contain.call(context$2$0.t0, context$2$0.t1);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should forward the port', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.forwardPort(4724, 4724));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should remove forwarded port', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.forwardPort(8200, 6790));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(adb.adbExec(['forward', '--list']));

        case 4:
          context$2$0.sent.should.contain('tcp:8200');
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(adb.removePortForward(8200));

        case 7:
          context$2$0.next = 9;
          return _regeneratorRuntime.awrap(adb.adbExec(['forward', '--list']));

        case 9:
          context$2$0.sent.should.not.contain('tcp:8200');

        case 10:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should start logcat from adb', function callee$1$0() {
    var logs;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.startLogcat());

        case 2:
          logs = adb.logcat.getLogs();

          logs.should.have.length.above(0);
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(adb.stopLogcat());

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should get model', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.getModel());

        case 2:
          context$2$0.sent.should.not.be['null'];

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should get manufacturer', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.getManufacturer());

        case 2:
          context$2$0.sent.should.not.be['null'];

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should get screen size', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(adb.getScreenSize());

        case 2:
          context$2$0.sent.should.not.be['null'];

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  describe('app permissions', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      var _this2 = this;

      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          before(function callee$2$0() {
            var deviceApiLevel, isInstalled;
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.getApiLevel());

                case 2:
                  deviceApiLevel = context$3$0.sent;

                  if (deviceApiLevel < 23) {
                    //test should skip if the device API < 23
                    this.skip();
                  }
                  context$3$0.next = 6;
                  return _regeneratorRuntime.awrap(adb.isAppInstalled('io.appium.android.apis'));

                case 6:
                  isInstalled = context$3$0.sent;

                  if (!isInstalled) {
                    context$3$0.next = 10;
                    break;
                  }

                  context$3$0.next = 10;
                  return _regeneratorRuntime.awrap(adb.uninstallApk('io.appium.android.apis'));

                case 10:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, this);
          });
          it('should install and grant all permission', function callee$2$0() {
            var apiDemos, requestedPermissions;
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  apiDemos = _path2['default'].resolve(_libHelpersJs.rootDir, 'test', 'fixtures', 'ApiDemos-debug.apk');
                  context$3$0.next = 3;
                  return _regeneratorRuntime.awrap(adb.install(apiDemos));

                case 3:
                  context$3$0.next = 5;
                  return _regeneratorRuntime.awrap(adb.isAppInstalled('io.appium.android.apis'));

                case 5:
                  context$3$0.sent.should.be['true'];
                  context$3$0.next = 8;
                  return _regeneratorRuntime.awrap(adb.grantAllPermissions('io.appium.android.apis'));

                case 8:
                  context$3$0.next = 10;
                  return _regeneratorRuntime.awrap(adb.getReqPermissions('io.appium.android.apis'));

                case 10:
                  requestedPermissions = context$3$0.sent;
                  context$3$0.next = 13;
                  return _regeneratorRuntime.awrap(adb.getGrantedPermissions('io.appium.android.apis'));

                case 13:
                  context$3$0.t0 = context$3$0.sent;
                  context$3$0.t1 = requestedPermissions;
                  expect(context$3$0.t0).to.have.members(context$3$0.t1);

                case 16:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this2);
          });
          it('should revoke permission', function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.revokePermission('io.appium.android.apis', 'android.permission.RECEIVE_SMS'));

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.getGrantedPermissions('io.appium.android.apis'));

                case 4:
                  context$3$0.t0 = context$3$0.sent;
                  context$3$0.t1 = ['android.permission.RECEIVE_SMS'];
                  expect(context$3$0.t0).to.not.have.members(context$3$0.t1);

                case 7:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this2);
          });
          it('should grant permission', function callee$2$0() {
            return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
              while (1) switch (context$3$0.prev = context$3$0.next) {
                case 0:
                  context$3$0.next = 2;
                  return _regeneratorRuntime.awrap(adb.grantPermission('io.appium.android.apis', 'android.permission.RECEIVE_SMS'));

                case 2:
                  context$3$0.next = 4;
                  return _regeneratorRuntime.awrap(adb.getGrantedPermissions('io.appium.android.apis'));

                case 4:
                  context$3$0.t0 = context$3$0.sent;
                  context$3$0.t1 = ['android.permission.RECEIVE_SMS'];
                  expect(context$3$0.t0).to.include.members(context$3$0.t1);

                case 7:
                case 'end':
                  return context$3$0.stop();
              }
            }, null, _this2);
          });

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});

// cleanup
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9hZGItY29tbWFuZHMtZTJlLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztvQkFBaUIsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7Z0JBQzdCLE9BQU87Ozs7b0JBQ04sTUFBTTs7Ozs0QkFDQyxzQkFBc0I7O3FCQUNXLFNBQVM7O0FBR2xFLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7QUFDekIsSUFBSSxNQUFNLEdBQUcsa0JBQUssTUFBTSxDQUFDOzs7QUFHekIsSUFBTSxHQUFHLEdBQUcsZ0RBQWdEO0lBQ3RELFdBQVcsR0FBRyxDQUFDLHlDQUF5QyxFQUN6QyxtQ0FBbUMsQ0FBQztJQUNuRCxrQkFBa0IsR0FBRyxrQkFBSyxPQUFPLHdCQUFVLE1BQU0sRUFDZixVQUFVLEVBQUUsb0JBQW9CLENBQUM7SUFDbkUsR0FBRyxHQUFHLG9DQUFvQztJQUMxQyxRQUFRLEdBQUcsZ0JBQWdCLENBQUM7O0FBRWxDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsWUFBWTs7O0FBQ25DLE1BQUksQ0FBQyxPQUFPLHNCQUFlLENBQUM7O0FBRTVCLE1BQUksR0FBRyxZQUFBLENBQUM7QUFDUixRQUFNLENBQUM7Ozs7OzJDQUNPLGNBQUksU0FBUyxFQUFFOzs7QUFBM0IsYUFBRzs7Ozs7OztHQUNKLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQywwQ0FBMEMsRUFBRTs7Ozs7MkNBQ3RDLEdBQUcsQ0FBQyxXQUFXLEVBQUU7Ozs7MkJBQUUsTUFBTSxDQUFDLEtBQUs7Ozs7Ozs7R0FDdkMsQ0FBQyxDQUFDO0FBQ0gsSUFBRSxDQUFDLHdEQUF3RCxFQUFFOzs7OzsyQ0FDcEQsR0FBRyxDQUFDLGtCQUFrQixFQUFFOzs7OzJCQUFFLE1BQU0sQ0FBQyxPQUFPOzs7Ozs7O0dBQ2hELENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyxpREFBaUQsRUFBRTs7Ozs7MkNBQzdDLEdBQUcsQ0FBQyxhQUFhLEVBQUU7OzsyQkFBRSxNQUFNLENBQUMsSUFB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b0I7QUFBdEcsd0JBQU0saUJBQTRELEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTzs7Ozs7OztXQUNsRixDQUFDLENBQUM7QUFDSCxZQUFFLENBQUMsMEJBQTBCLEVBQUU7Ozs7O21EQUN2QixHQUFHLENBQUMsZ0JBQWdCLENBQUMsd0JBQXdCLEVBQUUsZ0NBQWdDLENBQUM7Ozs7bURBQ3pFLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyx3QkFBd0IsQ0FBQzs7OzttQ0FBc0IsQ0FBQyxnQ0FBZ0MsQ0FBQztBQUF4SCx3QkFBTSxpQkFBNEQsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTzs7Ozs7OztXQUN0RixDQUFDLENBQUM7QUFDSCxZQUFFLENBQUMseUJBQXlCLEVBQUU7Ozs7O21EQUN0QixHQUFHLENBQUMsZUFBZSxDQUFDLHdCQUF3QixFQUFFLGdDQUFnQyxDQUFDOzs7O21EQUN4RSxHQUFHLENBQUMscUJBQXFCLENBQUMsd0JBQXdCLENBQUM7Ozs7bUNBQXFCLENBQUMsZ0NBQWdDLENBQUM7QUFBdkgsd0JBQU0saUJBQTRELEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTzs7Ozs7OztXQUNyRixDQUFDLENBQUM7Ozs7Ozs7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9mdW5jdGlvbmFsL2FkYi1jb21tYW5kcy1lMmUtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCBBREIgZnJvbSAnLi4vLi4nO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyByb290RGlyIH0gZnJvbSAnLi4vLi4vbGliL2hlbHBlcnMuanMnO1xuaW1wb3J0IHsgYXBpTGV2ZWwsIHBsYXRmb3JtVmVyc2lvbiwgTU9DSEFfVElNRU9VVCB9IGZyb20gJy4vc2V0dXAnO1xuXG5cbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcbmxldCBleHBlY3QgPSBjaGFpLmV4cGVjdDtcblxuLy8gY2hhbmdlIGFjY29yZGluZyB0byBDSVxuY29uc3QgSU1FID0gJ2NvbS5leGFtcGxlLmFuZHJvaWQuc29mdGtleWJvYXJkLy5Tb2Z0S2V5Ym9hcmQnLFxuICAgICAgZGVmYXVsdElNRXMgPSBbJ2NvbS5hbmRyb2lkLmlucHV0bWV0aG9kLmxhdGluLy5MYXRpbklNRScsXG4gICAgICAgICAgICAgICAgICAgICAnaW8uYXBwaXVtLmFuZHJvaWQuaW1lLy5Vbmljb2RlSU1FJ10sXG4gICAgICBjb250YWN0TWFuYWdlclBhdGggPSBwYXRoLnJlc29sdmUocm9vdERpciwgJ3Rlc3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdmaXh0dXJlcycsICdDb250YWN0TWFuYWdlci5hcGsnKSxcbiAgICAgIHBrZyA9ICdjb20uZXhhbXBsZS5hbmRyb2lkLmNvbnRhY3RtYW5hZ2VyJyxcbiAgICAgIGFjdGl2aXR5ID0gJ0NvbnRhY3RNYW5hZ2VyJztcblxuZGVzY3JpYmUoJ2FkYiBjb21tYW5kcycsIGZ1bmN0aW9uICgpIHtcbiAgdGhpcy50aW1lb3V0KE1PQ0hBX1RJTUVPVVQpO1xuXG4gIGxldCBhZGI7XG4gIGJlZm9yZShhc3luYyAoKSA9PiB7XG4gICAgYWRiID0gYXdhaXQgQURCLmNyZWF0ZUFEQigpO1xuICB9KTtcbiAgaXQoJ2dldEFwaUxldmVsIHNob3VsZCBnZXQgY29ycmVjdCBhcGkgbGV2ZWwnLCBhc3luYyAoKSA9PiB7XG4gICAgKGF3YWl0IGFkYi5nZXRBcGlMZXZlbCgpKS5zaG91bGQuZXF1YWwoYXBpTGV2ZWwpO1xuICB9KTtcbiAgaXQoJ2dldFBsYXRmb3JtVmVyc2lvbiBzaG91bGQgZ2V0IGNvcnJlY3QgcGxhdGZvcm0gdmVyc2lvbicsIGFzeW5jICgpID0+IHtcbiAgICAoYXdhaXQgYWRiLmdldFBsYXRmb3JtVmVyc2lvbigpKS5zaG91bGQuaW5jbHVkZShwbGF0Zm9ybVZlcnNpb24pO1xuICB9KTtcbiAgaXQoJ2F2YWlsYWJsZUlNRXMgc2hvdWxkIGdldCBsaXN0IG9mIGF2YWlsYWJsZSBJTUVzJywgYXN5bmMgKCkgPT4ge1xuICAgIChhd2FpdCBhZGIuYXZhaWxhYmxlSU1FcygpKS5zaG91bGQuaGF2ZS5sZW5ndGguYWJvdmUoMCk7XG4gIH0pO1xuICBpdCgnZW5hYmxlZElNRXMgc2hvdWxkIGdldCBsaXN0IG9mIGVuYWJsZWQgSU1FcycsIGFzeW5jICgpID0+IHtcbiAgICAoYXdhaXQgYWRiLmVuYWJsZWRJTUVzKCkpLnNob3VsZC5oYXZlLmxlbmd0aC5hYm92ZSgwKTtcbiAgfSk7XG4gIGl0KCdkZWZhdWx0SU1FIHNob3VsZCBnZXQgZGVmYXVsdCBJTUUnLCBhc3luYyAoKSA9PiB7XG4gICAgZGVmYXVsdElNRXMuc2hvdWxkLmluY2x1ZGUoYXdhaXQgYWRiLmRlZmF1bHRJTUUoKSk7XG4gIH0pO1xuICBpdCgnZW5hYmxlSU1FIGFuZCBkaXNhYmxlSU1FIHNob3VsZCBlbmFibGUgYW5kIGRpc2JsZSBJTUUnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgYWRiLmRpc2FibGVJTUUoSU1FKTtcbiAgICAoYXdhaXQgYWRiLmVuYWJsZWRJTUVzKCkpLnNob3VsZC5ub3QuaW5jbHVkZShJTUUpO1xuICAgIGF3YWl0IGFkYi5lbmFibGVJTUUoSU1FKTtcbiAgICAoYXdhaXQgYWRiLmVuYWJsZWRJTUVzKCkpLnNob3VsZC5pbmNsdWRlKElNRSk7XG4gICAgYXdhaXQgYWRiLmVuYWJsZWRJTUVzKCk7XG4gIH0pO1xuICBpdCgncHJvY2Vzc0V4aXN0cyBzaG91bGQgYmUgYWJsZSB0byBmaW5kIHVpIHByb2Nlc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgKGF3YWl0IGFkYi5wcm9jZXNzRXhpc3RzKCdjb20uYW5kcm9pZC5zeXN0ZW11aScpKS5zaG91bGQuYmUudHJ1ZTtcbiAgfSk7XG4gIGl0KCdwaW5nIHNob3VsZCByZXR1cm4gdHJ1ZScsIGFzeW5jICgpID0+IHtcbiAgICAoYXdhaXQgYWRiLnBpbmcoKSkuc2hvdWxkLmJlLnRydWU7XG4gIH0pO1xuICBpdCgnZ2V0UElEc0J5TmFtZSBzaG91bGQgcmV0dXJuIHBpZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgKGF3YWl0IGFkYi5nZXRQSURzQnlOYW1lKCdtLmFuZHJvaWQucGhvbmUnKSkuc2hvdWxkLmhhdmUubGVuZ3RoLmFib3ZlKDApO1xuICB9KTtcbiAgaXQoJ2tpbGxQcm9jZXNzZXNCeU5hbWUgc2hvdWxkIGtpbGwgcHJvY2VzcycsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBhZGIuaW5zdGFsbChjb250YWN0TWFuYWdlclBhdGgpO1xuICAgIGF3YWl0IGFkYi5zdGFydEFwcCh7cGtnLCBhY3Rpdml0eX0pO1xuICAgIGF3YWl0IGFkYi5raWxsUHJvY2Vzc2VzQnlOYW1lKHBrZyk7XG4gICAgKGF3YWl0IGFkYi5nZXRQSURzQnlOYW1lKHBrZykpLnNob3VsZC5oYXZlLmxlbmd0aCgwKTtcbiAgfSk7XG4gIGl0KCdraWxsUHJvY2Vzc0J5UElEIHNob3VsZCBraWxsIHByb2Nlc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgYWRiLmluc3RhbGwoY29udGFjdE1hbmFnZXJQYXRoKTtcbiAgICBhd2FpdCBhZGIuc3RhcnRBcHAoe3BrZywgYWN0aXZpdHl9KTtcbiAgICBsZXQgcGlkcyA9IGF3YWl0IGFkYi5nZXRQSURzQnlOYW1lKHBrZyk7XG4gICAgcGlkcy5zaG91bGQuaGF2ZS5sZW5ndGguYWJvdmUoMCk7XG4gICAgYXdhaXQgYWRiLmtpbGxQcm9jZXNzQnlQSUQocGlkc1swXSk7XG4gICAgKGF3YWl0IGFkYi5nZXRQSURzQnlOYW1lKHBrZykpLmxlbmd0aC5zaG91bGQuZXF1YWwoMCk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGdldCBkZXZpY2UgbGFuZ3VhZ2UgYW5kIGNvdW50cnknLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHBhcnNlSW50KGFwaUxldmVsLCAxMCkgPj0gMjMpIHJldHVybiB0aGlzLnNraXAoKTtcbiAgICBpZiAocHJvY2Vzcy5lbnYuVFJBVklTKSByZXR1cm4gdGhpcy5za2lwKCk7XG5cbiAgICBbJ2VuJywgJ2ZyJ10uc2hvdWxkLmNvbnRhaW4oYXdhaXQgYWRiLmdldERldmljZVN5c0xhbmd1YWdlKCkpO1xuICAgIFsnVVMnLCAnRU5fVVMnLCAnRU4nLCAnRlInXS5zaG91bGQuY29udGFpbihhd2FpdCBhZGIuZ2V0RGV2aWNlU3lzQ291bnRyeSgpKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgc2V0IGRldmljZSBsYW5ndWFnZSBhbmQgY291bnRyeScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAocGFyc2VJbnQoYXBpTGV2ZWwsIDEwKSA+PSAyMykgcmV0dXJuIHRoaXMuc2tpcCgpO1xuICAgIGlmIChwcm9jZXNzLmVudi5UUkFWSVMpIHJldHVybiB0aGlzLnNraXAoKTtcblxuICAgIGF3YWl0IGFkYi5zZXREZXZpY2VTeXNMYW5ndWFnZSgnZnInKTtcbiAgICBhd2FpdCBhZGIuc2V0RGV2aWNlU3lzQ291bnRyeSgnZnInKTtcbiAgICBhd2FpdCBhZGIucmVib290KCk7XG4gICAgYXdhaXQgYWRiLmdldERldmljZVN5c0xhbmd1YWdlKCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJ2ZyJyk7XG4gICAgYXdhaXQgYWRiLmdldERldmljZVN5c0NvdW50cnkoKS5zaG91bGQuZXZlbnR1YWxseS5lcXVhbCgnRlInKTtcbiAgICAvLyBjbGVhbnVwXG4gICAgYXdhaXQgYWRiLnNldERldmljZVN5c0xhbmd1YWdlKCdlbicpO1xuICAgIGF3YWl0IGFkYi5zZXREZXZpY2VTeXNDb3VudHJ5KCd1cycpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBnZXQgZGV2aWNlIGxvY2FsZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAocGFyc2VJbnQoYXBpTGV2ZWwsIDEwKSA8IDIzKSByZXR1cm4gdGhpcy5za2lwKCk7XG5cbiAgICBbJ3VzJ10uc2hvdWxkLmNvbnRhaW4oYXdhaXQgYWRiLmdldERldmljZUxvY2FsZSgpKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZm9yd2FyZCB0aGUgcG9ydCcsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBhZGIuZm9yd2FyZFBvcnQoNDcyNCwgNDcyNCk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIHJlbW92ZSBmb3J3YXJkZWQgcG9ydCcsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBhZGIuZm9yd2FyZFBvcnQoODIwMCwgNjc5MCk7XG4gICAgKGF3YWl0IGFkYi5hZGJFeGVjKFtgZm9yd2FyZGAsIGAtLWxpc3RgXSkpLnNob3VsZC5jb250YWluKCd0Y3A6ODIwMCcpO1xuICAgIGF3YWl0IGFkYi5yZW1vdmVQb3J0Rm9yd2FyZCg4MjAwKTtcbiAgICAoYXdhaXQgYWRiLmFkYkV4ZWMoW2Bmb3J3YXJkYCwgYC0tbGlzdGBdKSkuc2hvdWxkLm5vdC5jb250YWluKCd0Y3A6ODIwMCcpO1xuXG4gIH0pO1xuICBpdCgnc2hvdWxkIHN0YXJ0IGxvZ2NhdCBmcm9tIGFkYicsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBhZGIuc3RhcnRMb2djYXQoKTtcbiAgICBsZXQgbG9ncyA9IGFkYi5sb2djYXQuZ2V0TG9ncygpO1xuICAgIGxvZ3Muc2hvdWxkLmhhdmUubGVuZ3RoLmFib3ZlKDApO1xuICAgIGF3YWl0IGFkYi5zdG9wTG9nY2F0KCk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGdldCBtb2RlbCcsIGFzeW5jICgpID0+IHtcbiAgICAoYXdhaXQgYWRiLmdldE1vZGVsKCkpLnNob3VsZC5ub3QuYmUubnVsbDtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZ2V0IG1hbnVmYWN0dXJlcicsIGFzeW5jICgpID0+IHtcbiAgICAoYXdhaXQgYWRiLmdldE1hbnVmYWN0dXJlcigpKS5zaG91bGQubm90LmJlLm51bGw7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGdldCBzY3JlZW4gc2l6ZScsIGFzeW5jICgpID0+IHtcbiAgICAoYXdhaXQgYWRiLmdldFNjcmVlblNpemUoKSkuc2hvdWxkLm5vdC5iZS5udWxsO1xuICB9KTtcbiAgZGVzY3JpYmUoJ2FwcCBwZXJtaXNzaW9ucycsIGFzeW5jICgpID0+IHtcbiAgICBiZWZvcmUoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IGRldmljZUFwaUxldmVsID0gYXdhaXQgYWRiLmdldEFwaUxldmVsKCk7XG4gICAgICBpZiAoZGV2aWNlQXBpTGV2ZWwgPCAyMykge1xuICAgICAgICAvL3Rlc3Qgc2hvdWxkIHNraXAgaWYgdGhlIGRldmljZSBBUEkgPCAyM1xuICAgICAgICB0aGlzLnNraXAoKTtcbiAgICAgIH1cbiAgICAgIGxldCBpc0luc3RhbGxlZCA9IGF3YWl0IGFkYi5pc0FwcEluc3RhbGxlZCgnaW8uYXBwaXVtLmFuZHJvaWQuYXBpcycpO1xuICAgICAgaWYgKGlzSW5zdGFsbGVkKSB7XG4gICAgICAgIGF3YWl0IGFkYi51bmluc3RhbGxBcGsoJ2lvLmFwcGl1bS5hbmRyb2lkLmFwaXMnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGluc3RhbGwgYW5kIGdyYW50IGFsbCBwZXJtaXNzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGFwaURlbW9zID0gcGF0aC5yZXNvbHZlKHJvb3REaXIsICd0ZXN0JyxcbiAgICAgICAgICAnZml4dHVyZXMnLCAnQXBpRGVtb3MtZGVidWcuYXBrJyk7XG4gICAgICBhd2FpdCBhZGIuaW5zdGFsbChhcGlEZW1vcyk7XG4gICAgICAoYXdhaXQgYWRiLmlzQXBwSW5zdGFsbGVkKCdpby5hcHBpdW0uYW5kcm9pZC5hcGlzJykpLnNob3VsZC5iZS50cnVlO1xuICAgICAgYXdhaXQgYWRiLmdyYW50QWxsUGVybWlzc2lvbnMoJ2lvLmFwcGl1bS5hbmRyb2lkLmFwaXMnKTtcbiAgICAgIGxldCByZXF1ZXN0ZWRQZXJtaXNzaW9ucyA9IGF3YWl0IGFkYi5nZXRSZXFQZXJtaXNzaW9ucygnaW8uYXBwaXVtLmFuZHJvaWQuYXBpcycpO1xuICAgICAgZXhwZWN0KGF3YWl0IGFkYi5nZXRHcmFudGVkUGVybWlzc2lvbnMoJ2lvLmFwcGl1bS5hbmRyb2lkLmFwaXMnKSkudG8uaGF2ZS5tZW1iZXJzKHJlcXVlc3RlZFBlcm1pc3Npb25zKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHJldm9rZSBwZXJtaXNzaW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgYWRiLnJldm9rZVBlcm1pc3Npb24oJ2lvLmFwcGl1bS5hbmRyb2lkLmFwaXMnLCAnYW5kcm9pZC5wZXJtaXNzaW9uLlJFQ0VJVkVfU01TJyk7XG4gICAgICBleHBlY3QoYXdhaXQgYWRiLmdldEdyYW50ZWRQZXJtaXNzaW9ucygnaW8uYXBwaXVtLmFuZHJvaWQuYXBpcycpKS50by5ub3QuaGF2ZS5tZW1iZXJzKFsnYW5kcm9pZC5wZXJtaXNzaW9uLlJFQ0VJVkVfU01TJ10pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZ3JhbnQgcGVybWlzc2lvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGFkYi5ncmFudFBlcm1pc3Npb24oJ2lvLmFwcGl1bS5hbmRyb2lkLmFwaXMnLCAnYW5kcm9pZC5wZXJtaXNzaW9uLlJFQ0VJVkVfU01TJyk7XG4gICAgICBleHBlY3QoYXdhaXQgYWRiLmdldEdyYW50ZWRQZXJtaXNzaW9ucygnaW8uYXBwaXVtLmFuZHJvaWQuYXBpcycpKS50by5pbmNsdWRlLm1lbWJlcnMoWydhbmRyb2lkLnBlcm1pc3Npb24uUkVDRUlWRV9TTVMnXSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
