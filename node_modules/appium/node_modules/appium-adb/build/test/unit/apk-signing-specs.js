'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _this = this;

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _ = require('../..');

var _2 = _interopRequireDefault(_);

var _libHelpersJs = require('../../lib/helpers.js');

var helpers = _interopRequireWildcard(_libHelpersJs);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _teen_process = require('teen_process');

var teen_process = _interopRequireWildcard(_teen_process);

var _appiumSupport = require('appium-support');

var appiumSupport = _interopRequireWildcard(_appiumSupport);

var _appiumTestSupport = require('appium-test-support');

_chai2['default'].use(_chaiAsPromised2['default']);

var selendroidTestApp = _path2['default'].resolve(helpers.rootDir, 'test', 'fixtures', 'selendroid-test-app.apk'),
    helperJarPath = _path2['default'].resolve(helpers.rootDir, 'jars'),
    keystorePath = _path2['default'].resolve(helpers.rootDir, 'test', 'fixtures', 'appiumtest.keystore'),
    keyAlias = 'appiumtest',
    password = 'android',
    selendroidTestAppPackage = 'io.selendroid.testapp',
    java_dummy_path = 'java_dummy_path',
    java_home = 'java_home',
    tempDir = appiumSupport.tempDir,
    fs = appiumSupport.fs;

describe('signing', function () {
  var adb = new _2['default']();
  adb.keystorePath = keystorePath;
  adb.keyAlias = keyAlias;
  adb.keystorePassword = password;
  adb.keyPassword = password;

  describe('signWithDefaultCert', (0, _appiumTestSupport.withMocks)({ teen_process: teen_process, helpers: helpers }, function (mocks) {
    it('should call exec with correct args', function callee$2$0() {
      var signPath;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            signPath = _path2['default'].resolve(helperJarPath, 'sign.jar');

            mocks.helpers.expects("getJavaForOs").returns(java_dummy_path);
            mocks.teen_process.expects("exec").once().withExactArgs(java_dummy_path, ['-jar', signPath, selendroidTestApp, '--override']).returns("");
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(adb.signWithDefaultCert(selendroidTestApp));

          case 5:
            mocks.teen_process.verify();

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should throw error for invalid file path', function callee$2$0() {
      var dummyPath;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            dummyPath = "dummyPath";
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(adb.signWithDefaultCert(dummyPath).should.eventually.be.rejected);

          case 3:
            mocks.teen_process.verify();
            mocks.helpers.verify();

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
  describe('signWithCustomCert', (0, _appiumTestSupport.withMocks)({ teen_process: teen_process, helpers: helpers }, function (mocks) {
    it('should call exec with correct args', function callee$2$0() {
      var jarsigner;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            jarsigner = _path2['default'].resolve(java_home, 'bin', 'jarsigner');

            if (appiumSupport.system.isWindows()) {
              jarsigner = jarsigner + '.exe';
            }
            adb.useKeystore = true;
            mocks.helpers.expects("getJavaHome").returns(java_home);
            mocks.helpers.expects("getJavaForOs").returns(java_dummy_path);
            mocks.teen_process.expects("exec").withExactArgs(java_dummy_path, ['-jar', _path2['default'].resolve(helperJarPath, 'unsign.jar'), selendroidTestApp]).returns("");
            mocks.teen_process.expects("exec").withExactArgs(jarsigner, ['-sigalg', 'MD5withRSA', '-digestalg', 'SHA1', '-keystore', keystorePath, '-storepass', password, '-keypass', password, selendroidTestApp, keyAlias]).returns("");
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(adb.signWithCustomCert(selendroidTestApp));

          case 9:
            mocks.teen_process.verify();
            mocks.helpers.verify();

          case 11:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
  describe('getKeystoreMd5', (0, _appiumTestSupport.withMocks)({ teen_process: teen_process }, function (mocks) {
    it('should call exec with correct args', function callee$2$0() {
      var h, keytool, md5Str, md5;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            h = "a-fA-F0-9";
            keytool = _path2['default'].resolve(java_home, 'bin', 'keytool');
            md5Str = ['.*MD5.*((?:[', h, ']{2}:){15}[', h, ']{2})'].join('');
            md5 = new RegExp(md5Str, 'mi');

            adb.useKeystore = true;
            mocks.teen_process.expects("exec").once().withExactArgs(keytool, ['-v', '-list', '-alias', keyAlias, '-keystore', keystorePath, '-storepass', password]).returns("");
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(adb.getKeystoreMd5(keytool, md5));

          case 8:
            mocks.teen_process.verify();

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
  // Skipping as unable to mock mkdirp, this case is covered in e2e tests for now.
  // TODO: find ways to mock mkdirp
  describe.skip('zipAlignApk', (0, _appiumTestSupport.withMocks)({ teen_process: teen_process, adb: adb, appiumSupport: appiumSupport, fs: fs, tempDir: tempDir }, function (mocks) {
    it('should call exec with correct args', function callee$2$0() {
      var alignedApk;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            alignedApk = "dummy_path";

            mocks.tempDir.expects('path').once().withExactArgs({ prefix: 'appium', suffix: '.tmp' }).returns(alignedApk);
            mocks.adb.expects('initZipAlign').once().withExactArgs().returns("");
            mocks.appiumSupport.expects('mkdirp').once().withExactArgs(_path2['default'].dirname(alignedApk)).returns("");
            mocks.teen_process.expects("exec").once().withExactArgs(adb.binaries.zipalign, ['-f', '4', selendroidTestApp, alignedApk]);
            mocks.fs.expects("mv").once().withExactArgs(alignedApk, selendroidTestApp, { mkdirp: true }).returns("");
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(adb.zipAlignApk(selendroidTestApp));

          case 8:
            mocks.adb.verify();
            mocks.appiumSupport.verify();
            mocks.teen_process.verify();
            mocks.tempDir.verify();
            mocks.fs.verify();

          case 13:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
  describe('checkApkCert', (0, _appiumTestSupport.withMocks)({ teen_process: teen_process, helpers: helpers, adb: adb }, function (mocks) {
    it('should return false for apk not present', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.helpers.expects("getJavaForOs").returns(java_dummy_path);
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(adb.checkApkCert('dummyPath', 'dummyPackage'));

          case 3:
            context$3$0.sent.should.be['false'];

            mocks.helpers.verify();

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should call exec and zipAlign when not using keystore', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.helpers.expects("getJavaForOs").returns(java_dummy_path);
            mocks.teen_process.expects("exec").once().withExactArgs(java_dummy_path, ['-jar', _path2['default'].resolve(helperJarPath, 'verify.jar'), selendroidTestApp]).returns("");
            mocks.adb.expects('zipAlignApk').once().withExactArgs(selendroidTestApp).returns("");
            adb.useKeystore = false;
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(adb.checkApkCert(selendroidTestApp, selendroidTestAppPackage));

          case 6:
            mocks.adb.verify();
            mocks.teen_process.verify();
            mocks.helpers.verify();

          case 9:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should call checkCustomApkCert when using keystore', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.helpers.expects("getJavaForOs").returns(java_dummy_path);
            mocks.adb.expects('checkCustomApkCert').once().withExactArgs(selendroidTestApp, selendroidTestAppPackage).returns("");
            adb.useKeystore = true;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(adb.checkApkCert(selendroidTestApp, selendroidTestAppPackage));

          case 5:
            mocks.adb.verify();
            mocks.helpers.verify();

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  }));
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9hcGstc2lnbmluZy1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O29CQUFpQixNQUFNOzs7OzhCQUNJLGtCQUFrQjs7OztnQkFDN0IsT0FBTzs7Ozs0QkFDRSxzQkFBc0I7O0lBQW5DLE9BQU87O29CQUNGLE1BQU07Ozs7NEJBQ08sY0FBYzs7SUFBaEMsWUFBWTs7NkJBQ08sZ0JBQWdCOztJQUFuQyxhQUFhOztpQ0FDQyxxQkFBcUI7O0FBRy9DLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0FBRXpCLElBQU0saUJBQWlCLEdBQUcsa0JBQUssT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFDbkMseUJBQXlCLENBQUM7SUFDM0QsYUFBYSxHQUFHLGtCQUFLLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQztJQUNyRCxZQUFZLEdBQUcsa0JBQUssT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFDbkMscUJBQXFCLENBQUM7SUFDbEQsUUFBUSxHQUFHLFlBQVk7SUFDdkIsUUFBUSxHQUFHLFNBQVM7SUFDcEIsd0JBQXdCLEdBQUcsdUJBQXVCO0lBQ2xELGVBQWUsR0FBRyxpQkFBaUI7SUFDbkMsU0FBUyxHQUFHLFdBQVc7SUFDdkIsT0FBTyxHQUFHLGFBQWEsQ0FBQyxPQUFPO0lBQy9CLEVBQUUsR0FBRyxhQUFhLENBQUMsRUFBRSxDQUFDOztBQUU1QixRQUFRLENBQUMsU0FBUyxFQUFFLFlBQU07QUFDeEIsTUFBSSxHQUFHLEdBQUcsbUJBQVMsQ0FBQztBQUNwQixLQUFHLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztBQUNoQyxLQUFHLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztBQUN4QixLQUFHLENBQUMsZ0JBQWdCLEdBQUcsUUFBUSxDQUFDO0FBQ2hDLEtBQUcsQ0FBQyxXQUFXLEdBQUcsUUFBUSxDQUFDOztB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LCJmaWxlIjoidGVzdC91bml0L2Fway1zaWduaW5nLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgQURCIGZyb20gJy4uLy4uJztcbmltcG9ydCAqIGFzIGhlbHBlcnMgZnJvbSAnLi4vLi4vbGliL2hlbHBlcnMuanMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgKiBhcyB0ZWVuX3Byb2Nlc3MgZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCAqIGFzIGFwcGl1bVN1cHBvcnQgZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHsgd2l0aE1vY2tzIH0gZnJvbSAnYXBwaXVtLXRlc3Qtc3VwcG9ydCc7XG5cblxuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5jb25zdCBzZWxlbmRyb2lkVGVzdEFwcCA9IHBhdGgucmVzb2x2ZShoZWxwZXJzLnJvb3REaXIsICd0ZXN0JywgJ2ZpeHR1cmVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzZWxlbmRyb2lkLXRlc3QtYXBwLmFwaycpLFxuICAgICAgaGVscGVySmFyUGF0aCA9IHBhdGgucmVzb2x2ZShoZWxwZXJzLnJvb3REaXIsICdqYXJzJyksXG4gICAgICBrZXlzdG9yZVBhdGggPSBwYXRoLnJlc29sdmUoaGVscGVycy5yb290RGlyLCAndGVzdCcsICdmaXh0dXJlcycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2FwcGl1bXRlc3Qua2V5c3RvcmUnKSxcbiAgICAgIGtleUFsaWFzID0gJ2FwcGl1bXRlc3QnLFxuICAgICAgcGFzc3dvcmQgPSAnYW5kcm9pZCcsXG4gICAgICBzZWxlbmRyb2lkVGVzdEFwcFBhY2thZ2UgPSAnaW8uc2VsZW5kcm9pZC50ZXN0YXBwJyxcbiAgICAgIGphdmFfZHVtbXlfcGF0aCA9ICdqYXZhX2R1bW15X3BhdGgnLFxuICAgICAgamF2YV9ob21lID0gJ2phdmFfaG9tZScsXG4gICAgICB0ZW1wRGlyID0gYXBwaXVtU3VwcG9ydC50ZW1wRGlyLFxuICAgICAgZnMgPSBhcHBpdW1TdXBwb3J0LmZzO1xuXG5kZXNjcmliZSgnc2lnbmluZycsICgpID0+IHtcbiAgbGV0IGFkYiA9IG5ldyBBREIoKTtcbiAgYWRiLmtleXN0b3JlUGF0aCA9IGtleXN0b3JlUGF0aDtcbiAgYWRiLmtleUFsaWFzID0ga2V5QWxpYXM7XG4gIGFkYi5rZXlzdG9yZVBhc3N3b3JkID0gcGFzc3dvcmQ7XG4gIGFkYi5rZXlQYXNzd29yZCA9IHBhc3N3b3JkO1xuXG4gIGRlc2NyaWJlKCdzaWduV2l0aERlZmF1bHRDZXJ0Jywgd2l0aE1vY2tzKHt0ZWVuX3Byb2Nlc3MsIGhlbHBlcnN9LCAobW9ja3MpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGwgZXhlYyB3aXRoIGNvcnJlY3QgYXJncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBzaWduUGF0aCA9IHBhdGgucmVzb2x2ZShoZWxwZXJKYXJQYXRoLCAnc2lnbi5qYXInKTtcbiAgICAgIG1vY2tzLmhlbHBlcnMuZXhwZWN0cyhcImdldEphdmFGb3JPc1wiKVxuICAgICAgICAucmV0dXJucyhqYXZhX2R1bW15X3BhdGgpO1xuICAgICAgbW9ja3MudGVlbl9wcm9jZXNzLmV4cGVjdHMoXCJleGVjXCIpXG4gICAgICAgIC5vbmNlKCkud2l0aEV4YWN0QXJncyhqYXZhX2R1bW15X3BhdGgsIFsnLWphcicsIHNpZ25QYXRoLCBzZWxlbmRyb2lkVGVzdEFwcCwgJy0tb3ZlcnJpZGUnXSlcbiAgICAgICAgLnJldHVybnMoXCJcIik7XG4gICAgICAoYXdhaXQgYWRiLnNpZ25XaXRoRGVmYXVsdENlcnQoc2VsZW5kcm9pZFRlc3RBcHApKTtcbiAgICAgIG1vY2tzLnRlZW5fcHJvY2Vzcy52ZXJpZnkoKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciBpbnZhbGlkIGZpbGUgcGF0aCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBkdW1teVBhdGggPSBcImR1bW15UGF0aFwiO1xuICAgICAgYXdhaXQgYWRiLnNpZ25XaXRoRGVmYXVsdENlcnQoZHVtbXlQYXRoKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZDtcbiAgICAgIG1vY2tzLnRlZW5fcHJvY2Vzcy52ZXJpZnkoKTtcbiAgICAgIG1vY2tzLmhlbHBlcnMudmVyaWZ5KCk7XG4gICAgfSk7XG4gIH0pKTtcbiAgZGVzY3JpYmUoJ3NpZ25XaXRoQ3VzdG9tQ2VydCcsIHdpdGhNb2Nrcyh7dGVlbl9wcm9jZXNzLCBoZWxwZXJzfSwgKG1vY2tzKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxsIGV4ZWMgd2l0aCBjb3JyZWN0IGFyZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgamFyc2lnbmVyID0gcGF0aC5yZXNvbHZlKGphdmFfaG9tZSwgJ2JpbicsICdqYXJzaWduZXInKTtcbiAgICAgIGlmIChhcHBpdW1TdXBwb3J0LnN5c3RlbS5pc1dpbmRvd3MoKSkge1xuICAgICAgICBqYXJzaWduZXIgPSBqYXJzaWduZXIgKyAnLmV4ZSc7XG4gICAgICB9XG4gICAgICBhZGIudXNlS2V5c3RvcmUgPSB0cnVlO1xuICAgICAgbW9ja3MuaGVscGVycy5leHBlY3RzKFwiZ2V0SmF2YUhvbWVcIilcbiAgICAgICAgLnJldHVybnMoamF2YV9ob21lKTtcbiAgICAgIG1vY2tzLmhlbHBlcnMuZXhwZWN0cyhcImdldEphdmFGb3JPc1wiKVxuICAgICAgICAucmV0dXJucyhqYXZhX2R1bW15X3BhdGgpO1xuICAgICAgbW9ja3MudGVlbl9wcm9jZXNzLmV4cGVjdHMoXCJleGVjXCIpXG4gICAgICAgIC53aXRoRXhhY3RBcmdzKGphdmFfZHVtbXlfcGF0aCwgWyctamFyJywgcGF0aC5yZXNvbHZlKGhlbHBlckphclBhdGgsICd1bnNpZ24uamFyJyksIHNlbGVuZHJvaWRUZXN0QXBwXSlcbiAgICAgICAgLnJldHVybnMoXCJcIik7XG4gICAgICBtb2Nrcy50ZWVuX3Byb2Nlc3MuZXhwZWN0cyhcImV4ZWNcIilcbiAgICAgICAgLndpdGhFeGFjdEFyZ3MoamFyc2lnbmVyLCBbJy1zaWdhbGcnLCAnTUQ1d2l0aFJTQScsICctZGlnZXN0YWxnJywgJ1NIQTEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLWtleXN0b3JlJywga2V5c3RvcmVQYXRoLCAnLXN0b3JlcGFzcycsIHBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnLWtleXBhc3MnLCBwYXNzd29yZCwgc2VsZW5kcm9pZFRlc3RBcHAsIGtleUFsaWFzXSlcbiAgICAgICAgLnJldHVybnMoXCJcIik7XG4gICAgICAoYXdhaXQgYWRiLnNpZ25XaXRoQ3VzdG9tQ2VydChzZWxlbmRyb2lkVGVzdEFwcCkpO1xuICAgICAgbW9ja3MudGVlbl9wcm9jZXNzLnZlcmlmeSgpO1xuICAgICAgbW9ja3MuaGVscGVycy52ZXJpZnkoKTtcbiAgICB9KTtcbiAgfSkpO1xuICBkZXNjcmliZSgnZ2V0S2V5c3RvcmVNZDUnLCB3aXRoTW9ja3Moe3RlZW5fcHJvY2Vzc30sIChtb2NrcykgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsbCBleGVjIHdpdGggY29ycmVjdCBhcmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGggPSBcImEtZkEtRjAtOVwiO1xuICAgICAgbGV0IGtleXRvb2wgPSBwYXRoLnJlc29sdmUoamF2YV9ob21lLCAnYmluJywgJ2tleXRvb2wnKTtcbiAgICAgIGxldCBtZDVTdHIgPSBbJy4qTUQ1LiooKD86WycsIGgsICddezJ9Oil7MTV9WycsIGgsICddezJ9KSddLmpvaW4oJycpO1xuICAgICAgbGV0IG1kNSA9IG5ldyBSZWdFeHAobWQ1U3RyLCAnbWknKTtcbiAgICAgIGFkYi51c2VLZXlzdG9yZSA9IHRydWU7XG4gICAgICBtb2Nrcy50ZWVuX3Byb2Nlc3MuZXhwZWN0cyhcImV4ZWNcIilcbiAgICAgICAgLm9uY2UoKS53aXRoRXhhY3RBcmdzKGtleXRvb2wsIFsnLXYnLCAnLWxpc3QnLCAnLWFsaWFzJywga2V5QWxpYXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy1rZXlzdG9yZScsIGtleXN0b3JlUGF0aCwgJy1zdG9yZXBhc3MnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkXSlcbiAgICAgICAgLnJldHVybnMoXCJcIik7XG4gICAgICAoYXdhaXQgYWRiLmdldEtleXN0b3JlTWQ1KGtleXRvb2wsIG1kNSkpO1xuICAgICAgbW9ja3MudGVlbl9wcm9jZXNzLnZlcmlmeSgpO1xuICAgIH0pO1xuICB9KSk7XG4gIC8vIFNraXBwaW5nIGFzIHVuYWJsZSB0byBtb2NrIG1rZGlycCwgdGhpcyBjYXNlIGlzIGNvdmVyZWQgaW4gZTJlIHRlc3RzIGZvciBub3cuXG4gIC8vIFRPRE86IGZpbmQgd2F5cyB0byBtb2NrIG1rZGlycFxuICBkZXNjcmliZS5za2lwKCd6aXBBbGlnbkFwaycsIHdpdGhNb2Nrcyh7dGVlbl9wcm9jZXNzLCBhZGIsIGFwcGl1bVN1cHBvcnQsIGZzLCB0ZW1wRGlyfSwgKG1vY2tzKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxsIGV4ZWMgd2l0aCBjb3JyZWN0IGFyZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgYWxpZ25lZEFwayA9IFwiZHVtbXlfcGF0aFwiO1xuICAgICAgbW9ja3MudGVtcERpci5leHBlY3RzKCdwYXRoJylcbiAgICAgICAgLm9uY2UoKS53aXRoRXhhY3RBcmdzKHtwcmVmaXg6ICdhcHBpdW0nLCBzdWZmaXg6ICcudG1wJ30pXG4gICAgICAgIC5yZXR1cm5zKGFsaWduZWRBcGspO1xuICAgICAgbW9ja3MuYWRiLmV4cGVjdHMoJ2luaXRaaXBBbGlnbicpXG4gICAgICAgIC5vbmNlKCkud2l0aEV4YWN0QXJncygpXG4gICAgICAgIC5yZXR1cm5zKFwiXCIpO1xuICAgICAgbW9ja3MuYXBwaXVtU3VwcG9ydC5leHBlY3RzKCdta2RpcnAnKVxuICAgICAgICAub25jZSgpLndpdGhFeGFjdEFyZ3MocGF0aC5kaXJuYW1lKGFsaWduZWRBcGspKVxuICAgICAgICAucmV0dXJucyhcIlwiKTtcbiAgICAgIG1vY2tzLnRlZW5fcHJvY2Vzcy5leHBlY3RzKFwiZXhlY1wiKVxuICAgICAgICAub25jZSgpLndpdGhFeGFjdEFyZ3MoYWRiLmJpbmFyaWVzLnppcGFsaWduLCBbJy1mJywgJzQnLCBzZWxlbmRyb2lkVGVzdEFwcCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsaWduZWRBcGtdKTtcbiAgICAgIG1vY2tzLmZzLmV4cGVjdHMoXCJtdlwiKVxuICAgICAgICAub25jZSgpLndpdGhFeGFjdEFyZ3MoYWxpZ25lZEFwaywgc2VsZW5kcm9pZFRlc3RBcHAsIHsgbWtkaXJwOiB0cnVlIH0pXG4gICAgICAgIC5yZXR1cm5zKFwiXCIpO1xuICAgICAgYXdhaXQgYWRiLnppcEFsaWduQXBrKHNlbGVuZHJvaWRUZXN0QXBwKTtcbiAgICAgIG1vY2tzLmFkYi52ZXJpZnkoKTtcbiAgICAgIG1vY2tzLmFwcGl1bVN1cHBvcnQudmVyaWZ5KCk7XG4gICAgICBtb2Nrcy50ZWVuX3Byb2Nlc3MudmVyaWZ5KCk7XG4gICAgICBtb2Nrcy50ZW1wRGlyLnZlcmlmeSgpO1xuICAgICAgbW9ja3MuZnMudmVyaWZ5KCk7XG4gICAgfSk7XG4gIH0pKTtcbiAgZGVzY3JpYmUoJ2NoZWNrQXBrQ2VydCcsIHdpdGhNb2Nrcyh7dGVlbl9wcm9jZXNzLCBoZWxwZXJzLCBhZGJ9LCAobW9ja3MpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBmYWxzZSBmb3IgYXBrIG5vdCBwcmVzZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja3MuaGVscGVycy5leHBlY3RzKFwiZ2V0SmF2YUZvck9zXCIpXG4gICAgICAgIC5yZXR1cm5zKGphdmFfZHVtbXlfcGF0aCk7XG4gICAgICAoYXdhaXQgYWRiLmNoZWNrQXBrQ2VydCgnZHVtbXlQYXRoJywgJ2R1bW15UGFja2FnZScpKS5zaG91bGQuYmUuZmFsc2U7XG4gICAgICBtb2Nrcy5oZWxwZXJzLnZlcmlmeSgpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgY2FsbCBleGVjIGFuZCB6aXBBbGlnbiB3aGVuIG5vdCB1c2luZyBrZXlzdG9yZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tzLmhlbHBlcnMuZXhwZWN0cyhcImdldEphdmFGb3JPc1wiKVxuICAgICAgICAgICAucmV0dXJucyhqYXZhX2R1bW15X3BhdGgpO1xuICAgICAgbW9ja3MudGVlbl9wcm9jZXNzLmV4cGVjdHMoXCJleGVjXCIpXG4gICAgICAgICAgIC5vbmNlKCkud2l0aEV4YWN0QXJncyhqYXZhX2R1bW15X3BhdGgsIFsnLWphcicsIHBhdGgucmVzb2x2ZShoZWxwZXJKYXJQYXRoLCAndmVyaWZ5LmphcicpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVuZHJvaWRUZXN0QXBwXSlcbiAgICAgICAgICAgLnJldHVybnMoXCJcIik7XG4gICAgICBtb2Nrcy5hZGIuZXhwZWN0cygnemlwQWxpZ25BcGsnKVxuICAgICAgICAgICAub25jZSgpLndpdGhFeGFjdEFyZ3Moc2VsZW5kcm9pZFRlc3RBcHApXG4gICAgICAgICAgIC5yZXR1cm5zKFwiXCIpO1xuICAgICAgYWRiLnVzZUtleXN0b3JlID0gZmFsc2U7XG4gICAgICBhd2FpdCBhZGIuY2hlY2tBcGtDZXJ0KHNlbGVuZHJvaWRUZXN0QXBwLCBzZWxlbmRyb2lkVGVzdEFwcFBhY2thZ2UpO1xuICAgICAgbW9ja3MuYWRiLnZlcmlmeSgpO1xuICAgICAgbW9ja3MudGVlbl9wcm9jZXNzLnZlcmlmeSgpO1xuICAgICAgbW9ja3MuaGVscGVycy52ZXJpZnkoKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGNhbGwgY2hlY2tDdXN0b21BcGtDZXJ0IHdoZW4gdXNpbmcga2V5c3RvcmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2Nrcy5oZWxwZXJzLmV4cGVjdHMoXCJnZXRKYXZhRm9yT3NcIilcbiAgICAgICAgICAgLnJldHVybnMoamF2YV9kdW1teV9wYXRoKTtcbiAgICAgIG1vY2tzLmFkYi5leHBlY3RzKCdjaGVja0N1c3RvbUFwa0NlcnQnKVxuICAgICAgICAgICAub25jZSgpLndpdGhFeGFjdEFyZ3Moc2VsZW5kcm9pZFRlc3RBcHAsIHNlbGVuZHJvaWRUZXN0QXBwUGFja2FnZSlcbiAgICAgICAgICAgLnJldHVybnMoXCJcIik7XG4gICAgICBhZGIudXNlS2V5c3RvcmUgPSB0cnVlO1xuICAgICAgYXdhaXQgYWRiLmNoZWNrQXBrQ2VydChzZWxlbmRyb2lkVGVzdEFwcCwgc2VsZW5kcm9pZFRlc3RBcHBQYWNrYWdlKTtcbiAgICAgIG1vY2tzLmFkYi52ZXJpZnkoKTtcbiAgICAgIG1vY2tzLmhlbHBlcnMudmVyaWZ5KCk7XG4gICAgfSk7XG4gIH0pKTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLiJ9
