'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _loggerJs = require('../logger.js');

var _loggerJs2 = _interopRequireDefault(_loggerJs);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var PHONE_NUMBER_PATTERN = /^[\+]?[(]?[0-9]*[)]?[-\s\.]?[0-9]*[-\s\.]?[0-9]{2,}$/im;

var emuMethods = {};
emuMethods.POWER_AC_STATES = {
  POWER_AC_ON: 'on',
  POWER_AC_OFF: 'off'
};
emuMethods.GSM_CALL_ACTIONS = {
  GSM_CALL: 'call',
  GSM_ACCEPT: 'accept',
  GSM_CANCEL: 'cancel',
  GSM_HOLD: 'hold'
};
emuMethods.GSM_VOICE_STATES = {
  GSM_VOICE_UNREGISTERED: 'unregistered',
  GSM_VOICE_HOME: 'home',
  GSM_VOICE_ROAMING: 'roaming',
  GSM_VOICE_SEARCHING: 'searching',
  GSM_VOICE_DENIED: 'denied',
  GSM_VOICE_OFF: 'off',
  GSM_VOICE_ON: 'on'
};
emuMethods.GSM_SIGNAL_STRENGTHS = [0, 1, 2, 3, 4];

emuMethods.isEmulatorConnected = function callee$0$0() {
  var emulators;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    var _this = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.getConnectedEmulators());

      case 2:
        emulators = context$1$0.sent;
        return context$1$0.abrupt('return', !!_lodash2['default'].find(emulators, function (x) {
          return x && x.udid === _this.curDeviceId;
        }));

      case 4:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

emuMethods.verifyEmulatorConnected = function callee$0$0() {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.isEmulatorConnected());

      case 2:
        if (context$1$0.sent) {
          context$1$0.next = 4;
          break;
        }

        _loggerJs2['default'].errorAndThrow('The emulator "' + this.curDeviceId + '" was unexpectedly disconnected');

      case 4:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

emuMethods.fingerprint = function callee$0$0(fingerprintId) {
  var level;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!fingerprintId) {
          _loggerJs2['default'].errorAndThrow('Fingerprint id parameter must be defined');
        }
        // the method used only works for API level 23 and above
        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(this.getApiLevel());

      case 3:
        level = context$1$0.sent;

        if (parseInt(level, 10) < 23) {
          _loggerJs2['default'].errorAndThrow('Device API Level must be >= 23. Current Api level \'' + level + '\'');
        }
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.adbExecEmu(['finger', 'touch', fingerprintId]));

      case 7:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

emuMethods.rotate = function callee$0$0() {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.adbExecEmu(['rotate']));

      case 2:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

emuMethods.powerAC = function callee$0$0() {
  var state = arguments.length <= 0 || arguments[0] === undefined ? 'on' : arguments[0];
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (_lodash2['default'].values(emuMethods.POWER_AC_STATES).indexOf(state) === -1) {
          _loggerJs2['default'].errorAndThrow('Wrong power AC state sent \'' + state + '\'. Supported values: ' + _lodash2['default'].values(emuMethods.POWER_AC_STATES) + ']');
        }
        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(this.adbExecEmu(['power', 'ac', state]));

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

emuMethods.powerCapacity = function callee$0$0() {
  var percent = arguments.length <= 0 || arguments[0] === undefined ? 100 : arguments[0];
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        percent = parseInt(percent, 10);
        if (isNaN(percent) || percent < 0 || percent > 100) {
          _loggerJs2['default'].errorAndThrow('The percentage value should be valid integer between 0 and 100');
        }
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.adbExecEmu(['power', 'capacity', percent]));

      case 4:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

emuMethods.powerOFF = function callee$0$0() {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.powerAC(emuMethods.POWER_AC_STATES.POWER_AC_OFF));

      case 2:
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(this.powerCapacity(0));

      case 4:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

emuMethods.sendSMS = function callee$0$0(phoneNumber) {
  var message = arguments.length <= 1 || arguments[1] === undefined ? '' : arguments[1];
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        message = message.trim();
        if (message === "") {
          _loggerJs2['default'].errorAndThrow('Sending an SMS requires a message');
        }
        phoneNumber = ('' + phoneNumber).replace(/\s*/, "");
        if (!PHONE_NUMBER_PATTERN.test(phoneNumber)) {
          _loggerJs2['default'].errorAndThrow('Invalid sendSMS phoneNumber param ' + phoneNumber);
        }
        context$1$0.next = 6;
        return _regeneratorRuntime.awrap(this.adbExecEmu(['sms', 'send', phoneNumber, message]));

      case 6:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

emuMethods.gsmCall = function callee$0$0(phoneNumber) {
  var action = arguments.length <= 1 || arguments[1] === undefined ? '' : arguments[1];
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (_lodash2['default'].values(emuMethods.GSM_CALL_ACTIONS).indexOf(action) === -1) {
          _loggerJs2['default'].errorAndThrow('Invalid gsm action param ' + action + '. Supported values: ' + _lodash2['default'].values(emuMethods.GSM_CALL_ACTIONS));
        }
        phoneNumber = ('' + phoneNumber).replace(/\s*/, "");
        if (!PHONE_NUMBER_PATTERN.test(phoneNumber)) {
          _loggerJs2['default'].errorAndThrow('Invalid gsmCall phoneNumber param ' + phoneNumber);
        }
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.adbExecEmu(['gsm', action, phoneNumber]));

      case 5:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

emuMethods.gsmSignal = function callee$0$0() {
  var strength = arguments.length <= 0 || arguments[0] === undefined ? 4 : arguments[0];
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        strength = parseInt(strength, 10);
        if (emuMethods.GSM_SIGNAL_STRENGTHS.indexOf(strength) === -1) {
          _loggerJs2['default'].errorAndThrow('Invalid signal strength param ' + strength + '. Supported values: ' + _lodash2['default'].values(emuMethods.GSM_SIGNAL_STRENGTHS));
        }
        _loggerJs2['default'].info('gsm signal-profile <strength> changes the reported strength on next (15s) update.');
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.adbExecEmu(['gsm', 'signal-profile', strength]));

      case 5:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

emuMethods.gsmVoice = function callee$0$0() {
  var state = arguments.length <= 0 || arguments[0] === undefined ? 'on' : arguments[0];
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        // gsm voice <state> allows you to change the state of your GPRS connection
        if (_lodash2['default'].values(emuMethods.GSM_VOICE_STATES).indexOf(state) === -1) {
          _loggerJs2['default'].errorAndThrow('Invalid gsm voice state param ' + state + '. Supported values: ' + _lodash2['default'].values(emuMethods.GSM_VOICE_STATES));
        }
        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(this.adbExecEmu(['gsm', 'voice', state]));

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

exports['default'] = emuMethods;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi90b29scy9hZGItZW11LWNvbW1hbmRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7d0JBQWdCLGNBQWM7Ozs7c0JBQ2hCLFFBQVE7Ozs7QUFFdEIsSUFBTSxvQkFBb0IsR0FBRyx3REFBd0QsQ0FBQzs7QUFFdEYsSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDO0FBQ3BCLFVBQVUsQ0FBQyxlQUFlLEdBQUc7QUFDM0IsYUFBVyxFQUFFLElBQUk7QUFDakIsY0FBWSxFQUFFLEtBQUs7Q0FDcEIsQ0FBQztBQUNGLFVBQVUsQ0FBQyxnQkFBZ0IsR0FBRztBQUM1QixVQUFRLEVBQUcsTUFBTTtBQUNqQixZQUFVLEVBQUUsUUFBUTtBQUNwQixZQUFVLEVBQUUsUUFBUTtBQUNwQixVQUFRLEVBQUUsTUFBTTtDQUNqQixDQUFDO0FBQ0YsVUFBVSxDQUFDLGdCQUFnQixHQUFHO0FBQzVCLHdCQUFzQixFQUFFLGNBQWM7QUFDdEMsZ0JBQWMsRUFBRSxNQUFNO0FBQ3RCLG1CQUFpQixFQUFFLFNBQVM7QUFDNUIscUJBQW1CLEVBQUUsV0FBVztBQUNoQyxrQkFBZ0IsRUFBRSxRQUFRO0FBQzFCLGVBQWEsRUFBRSxLQUFLO0FBQ3BCLGNBQVksRUFBRSxJQUFJO0NBQ25CLENBQUM7QUFDRixVQUFVLENBQUMsb0JBQW9CLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7O0FBRWxELFVBQVUsQ0FBQyxtQkFBbUIsR0FBRztNQUMzQixTQUFTOzs7Ozs7O3lDQUFTLElBQUksQ0FBQyxxQkFBcUIsRUFBRTs7O0FBQTlDLGlCQUFTOzRDQUNOLENBQUMsQ0FBQyxvQkFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLFVBQUMsQ0FBQztpQkFBSyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksS0FBSyxNQUFLLFdBQVc7U0FBQSxDQUFDOzs7Ozs7O0NBQ3BFLENBQUM7O0FBRUYsVUFBVSxDQUFDLHVC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b0JBQUUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtBQUMvRCxnQ0FBSSxhQUFhLG9DQUFrQyxLQUFLLDRCQUF1QixvQkFBRSxNQUFNLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLENBQUcsQ0FBQztTQUN6SDs7eUNBQ0ssSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7Ozs7Ozs7Q0FDL0MsQ0FBQzs7cUJBRWEsVUFBVSIsImZpbGUiOiJsaWIvdG9vbHMvYWRiLWVtdS1jb21tYW5kcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyLmpzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmNvbnN0IFBIT05FX05VTUJFUl9QQVRURVJOID0gL15bXFwrXT9bKF0/WzAtOV0qWyldP1stXFxzXFwuXT9bMC05XSpbLVxcc1xcLl0/WzAtOV17Mix9JC9pbTtcblxubGV0IGVtdU1ldGhvZHMgPSB7fTtcbmVtdU1ldGhvZHMuUE9XRVJfQUNfU1RBVEVTID0ge1xuICBQT1dFUl9BQ19PTjogJ29uJyxcbiAgUE9XRVJfQUNfT0ZGOiAnb2ZmJ1xufTtcbmVtdU1ldGhvZHMuR1NNX0NBTExfQUNUSU9OUyA9IHtcbiAgR1NNX0NBTEwgOiAnY2FsbCcsXG4gIEdTTV9BQ0NFUFQ6ICdhY2NlcHQnLFxuICBHU01fQ0FOQ0VMOiAnY2FuY2VsJyxcbiAgR1NNX0hPTEQ6ICdob2xkJ1xufTtcbmVtdU1ldGhvZHMuR1NNX1ZPSUNFX1NUQVRFUyA9IHtcbiAgR1NNX1ZPSUNFX1VOUkVHSVNURVJFRDogJ3VucmVnaXN0ZXJlZCcsXG4gIEdTTV9WT0lDRV9IT01FOiAnaG9tZScsXG4gIEdTTV9WT0lDRV9ST0FNSU5HOiAncm9hbWluZycsXG4gIEdTTV9WT0lDRV9TRUFSQ0hJTkc6ICdzZWFyY2hpbmcnLFxuICBHU01fVk9JQ0VfREVOSUVEOiAnZGVuaWVkJyxcbiAgR1NNX1ZPSUNFX09GRjogJ29mZicsXG4gIEdTTV9WT0lDRV9PTjogJ29uJ1xufTtcbmVtdU1ldGhvZHMuR1NNX1NJR05BTF9TVFJFTkdUSFMgPSBbMCwgMSwgMiwgMywgNF07XG5cbmVtdU1ldGhvZHMuaXNFbXVsYXRvckNvbm5lY3RlZCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgbGV0IGVtdWxhdG9ycyA9IGF3YWl0IHRoaXMuZ2V0Q29ubmVjdGVkRW11bGF0b3JzKCk7XG4gIHJldHVybiAhIV8uZmluZChlbXVsYXRvcnMsICh4KSA9PiB4ICYmIHgudWRpZCA9PT0gdGhpcy5jdXJEZXZpY2VJZCk7XG59O1xuXG5lbXVNZXRob2RzLnZlcmlmeUVtdWxhdG9yQ29ubmVjdGVkID0gYXN5bmMgZnVuY3Rpb24gKCkge1xuICBpZiAoIShhd2FpdCB0aGlzLmlzRW11bGF0b3JDb25uZWN0ZWQoKSkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIGVtdWxhdG9yIFwiJHt0aGlzLmN1ckRldmljZUlkfVwiIHdhcyB1bmV4cGVjdGVkbHkgZGlzY29ubmVjdGVkYCk7XG4gIH1cbn07XG5cbmVtdU1ldGhvZHMuZmluZ2VycHJpbnQgPSBhc3luYyBmdW5jdGlvbiAoZmluZ2VycHJpbnRJZCkge1xuICBpZiAoIWZpbmdlcnByaW50SWQpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnRmluZ2VycHJpbnQgaWQgcGFyYW1ldGVyIG11c3QgYmUgZGVmaW5lZCcpO1xuICB9XG4gIC8vIHRoZSBtZXRob2QgdXNlZCBvbmx5IHdvcmtzIGZvciBBUEkgbGV2ZWwgMjMgYW5kIGFib3ZlXG4gIGxldCBsZXZlbCA9IGF3YWl0IHRoaXMuZ2V0QXBpTGV2ZWwoKTtcbiAgaWYgKHBhcnNlSW50KGxldmVsLCAxMCkgPCAyMykge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBEZXZpY2UgQVBJIExldmVsIG11c3QgYmUgPj0gMjMuIEN1cnJlbnQgQXBpIGxldmVsICcke2xldmVsfSdgKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydmaW5nZXInLCAndG91Y2gnLCBmaW5nZXJwcmludElkXSk7XG59O1xuXG5lbXVNZXRob2RzLnJvdGF0ZSA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsncm90YXRlJ10pO1xufTtcblxuZW11TWV0aG9kcy5wb3dlckFDID0gYXN5bmMgZnVuY3Rpb24gKHN0YXRlID0gJ29uJykge1xuICBpZiAoXy52YWx1ZXMoZW11TWV0aG9kcy5QT1dFUl9BQ19TVEFURVMpLmluZGV4T2Yoc3RhdGUpID09PSAtMSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBXcm9uZyBwb3dlciBBQyBzdGF0ZSBzZW50ICcke3N0YXRlfScuIFN1cHBvcnRlZCB2YWx1ZXM6ICR7Xy52YWx1ZXMoZW11TWV0aG9kcy5QT1dFUl9BQ19TVEFURVMpfV1gKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydwb3dlcicsICdhYycsIHN0YXRlXSk7XG59O1xuXG5lbXVNZXRob2RzLnBvd2VyQ2FwYWNpdHkgPSBhc3luYyBmdW5jdGlvbiAocGVyY2VudCA9IDEwMCkge1xuICBwZXJjZW50ID0gcGFyc2VJbnQocGVyY2VudCwgMTApO1xuICBpZiAoaXNOYU4ocGVyY2VudCkgfHwgcGVyY2VudCA8IDAgfHwgcGVyY2VudCA+IDEwMCkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBUaGUgcGVyY2VudGFnZSB2YWx1ZSBzaG91bGQgYmUgdmFsaWQgaW50ZWdlciBiZXR3ZWVuIDAgYW5kIDEwMGApO1xuICB9XG4gIGF3YWl0IHRoaXMuYWRiRXhlY0VtdShbJ3Bvd2VyJywgJ2NhcGFjaXR5JywgcGVyY2VudF0pO1xufTtcblxuZW11TWV0aG9kcy5wb3dlck9GRiA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgYXdhaXQgdGhpcy5wb3dlckFDKGVtdU1ldGhvZHMuUE9XRVJfQUNfU1RBVEVTLlBPV0VSX0FDX09GRik7XG4gIGF3YWl0IHRoaXMucG93ZXJDYXBhY2l0eSgwKTtcbn07XG5cbmVtdU1ldGhvZHMuc2VuZFNNUyA9IGFzeW5jIGZ1bmN0aW9uIChwaG9uZU51bWJlciwgbWVzc2FnZSA9ICcnKSB7XG4gIG1lc3NhZ2UgPSBtZXNzYWdlLnRyaW0oKTtcbiAgaWYgKG1lc3NhZ2UgPT09IFwiXCIpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdygnU2VuZGluZyBhbiBTTVMgcmVxdWlyZXMgYSBtZXNzYWdlJyk7XG4gIH1cbiAgcGhvbmVOdW1iZXIgPSBgJHtwaG9uZU51bWJlcn1gLnJlcGxhY2UoL1xccyovLCBcIlwiKTtcbiAgaWYgKCFQSE9ORV9OVU1CRVJfUEFUVEVSTi50ZXN0KHBob25lTnVtYmVyKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBJbnZhbGlkIHNlbmRTTVMgcGhvbmVOdW1iZXIgcGFyYW0gJHtwaG9uZU51bWJlcn1gKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydzbXMnLCAnc2VuZCcsIHBob25lTnVtYmVyLCBtZXNzYWdlXSk7XG59O1xuXG5lbXVNZXRob2RzLmdzbUNhbGwgPSBhc3luYyBmdW5jdGlvbiAocGhvbmVOdW1iZXIsIGFjdGlvbiA9ICcnKSB7XG4gIGlmIChfLnZhbHVlcyhlbXVNZXRob2RzLkdTTV9DQUxMX0FDVElPTlMpLmluZGV4T2YoYWN0aW9uKSA9PT0gLTEpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgSW52YWxpZCBnc20gYWN0aW9uIHBhcmFtICR7YWN0aW9ufS4gU3VwcG9ydGVkIHZhbHVlczogJHtfLnZhbHVlcyhlbXVNZXRob2RzLkdTTV9DQUxMX0FDVElPTlMpfWApO1xuICB9XG4gIHBob25lTnVtYmVyID0gYCR7cGhvbmVOdW1iZXJ9YC5yZXBsYWNlKC9cXHMqLywgXCJcIik7XG4gIGlmICghUEhPTkVfTlVNQkVSX1BBVFRFUk4udGVzdChwaG9uZU51bWJlcikpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgSW52YWxpZCBnc21DYWxsIHBob25lTnVtYmVyIHBhcmFtICR7cGhvbmVOdW1iZXJ9YCk7XG4gIH1cbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsnZ3NtJywgYWN0aW9uLCBwaG9uZU51bWJlcl0pO1xufTtcblxuZW11TWV0aG9kcy5nc21TaWduYWwgPSBhc3luYyBmdW5jdGlvbiAoc3RyZW5ndGggPSA0KSB7XG4gIHN0cmVuZ3RoID0gcGFyc2VJbnQoc3RyZW5ndGgsIDEwKTtcbiAgaWYgKGVtdU1ldGhvZHMuR1NNX1NJR05BTF9TVFJFTkdUSFMuaW5kZXhPZihzdHJlbmd0aCkgPT09IC0xKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYEludmFsaWQgc2lnbmFsIHN0cmVuZ3RoIHBhcmFtICR7c3RyZW5ndGh9LiBTdXBwb3J0ZWQgdmFsdWVzOiAke18udmFsdWVzKGVtdU1ldGhvZHMuR1NNX1NJR05BTF9TVFJFTkdUSFMpfWApO1xuICB9XG4gIGxvZy5pbmZvKCdnc20gc2lnbmFsLXByb2ZpbGUgPHN0cmVuZ3RoPiBjaGFuZ2VzIHRoZSByZXBvcnRlZCBzdHJlbmd0aCBvbiBuZXh0ICgxNXMpIHVwZGF0ZS4nKTtcbiAgYXdhaXQgdGhpcy5hZGJFeGVjRW11KFsnZ3NtJywgJ3NpZ25hbC1wcm9maWxlJywgc3RyZW5ndGhdKTtcbn07XG5cbmVtdU1ldGhvZHMuZ3NtVm9pY2UgPSBhc3luYyBmdW5jdGlvbiAoc3RhdGUgPSAnb24nKSB7XG4gIC8vIGdzbSB2b2ljZSA8c3RhdGU+IGFsbG93cyB5b3UgdG8gY2hhbmdlIHRoZSBzdGF0ZSBvZiB5b3VyIEdQUlMgY29ubmVjdGlvblxuICBpZiAoXy52YWx1ZXMoZW11TWV0aG9kcy5HU01fVk9JQ0VfU1RBVEVTKS5pbmRleE9mKHN0YXRlKSA9PT0gLTEpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgSW52YWxpZCBnc20gdm9pY2Ugc3RhdGUgcGFyYW0gJHtzdGF0ZX0uIFN1cHBvcnRlZCB2YWx1ZXM6ICR7Xy52YWx1ZXMoZW11TWV0aG9kcy5HU01fVk9JQ0VfU1RBVEVTKX1gKTtcbiAgfVxuICBhd2FpdCB0aGlzLmFkYkV4ZWNFbXUoWydnc20nLCAndm9pY2UnLCBzdGF0ZV0pO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZW11TWV0aG9kcztcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
