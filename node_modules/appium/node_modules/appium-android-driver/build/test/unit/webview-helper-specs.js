'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _libWebviewHelpers = require('../../lib/webview-helpers');

var _libWebviewHelpers2 = _interopRequireDefault(_libWebviewHelpers);

var _appiumAdb = require('appium-adb');

var _appiumAdb2 = _interopRequireDefault(_appiumAdb);

var sandbox = _sinon2['default'].sandbox.create();

describe('Webview Helpers', function () {
  var adb = new _appiumAdb2['default']();

  describe('When the webviews are obtained', function () {
    describe('for an app that embeds Chromium', function () {
      var webViews = undefined;

      beforeEach(function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              sandbox.stub(adb, 'shell', function () {
                return 'Num       RefCount Protocol Flags    Type St Inode Path\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  2818 /dev/socket/ss_conn_daemon\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  9231 @mcdaemon\n' + '0000000000000000: 00000002 00000000 00010000 0001 01 245445 @webview_devtools_remote_123\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  2826 /dev/socket/installd\n';
              });

              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(_libWebviewHelpers2['default'].getWebviews(adb, 'webview_devtools_remote_123'));

            case 3:
              webViews = context$4$0.sent;

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });

      afterEach(function () {
        sandbox.restore();
      });

      it('then the unix sockets are queried', function () {
        adb.shell.calledOnce.should.be['true'];
        adb.shell.getCall(0).args[0].should.deep.equal(['cat', '/proc/net/unix']);
      });

      it('then the webview is returned', function () {
        webViews.length.should.equal(1);
        webViews.should.deep.equal(['WEBVIEW_123']);
      });
    });

    describe('for a Chromium webview', function () {
      var webViews = undefined;

      beforeEach(function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              sandbox.stub(adb, 'shell', function () {
                return 'Num       RefCount Protocol Flags    Type St Inode Path\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  2818 /dev/socket/ss_conn_daemon\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  9231 @mcdaemon\n' + '0000000000000000: 00000002 00000000 00010000 0001 01 245445 @chrome_devtools_remote\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  2826 /dev/socket/installd\n';
              });

              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(_libWebviewHelpers2['default'].getWebviews(adb, 'chrome_devtools_remote'));

            case 3:
              webViews = context$4$0.sent;

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });

      afterEach(function () {
        sandbox.restore();
      });

      it('then the unix sockets are queried', function () {
        adb.shell.calledOnce.should.be['true'];
        adb.shell.getCall(0).args[0].should.deep.equal(['cat', '/proc/net/unix']);
      });

      it('then the webview is returned', function () {
        webViews.length.should.equal(1);
        webViews.should.deep.equal(['CHROMIUM']);
      });
    });

    describe('and no webviews exist', function () {
      var webViews = undefined;

      beforeEach(function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              sandbox.stub(adb, 'shell', function () {
                return 'Num       RefCount Protocol Flags    Type St Inode Path\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  2818 /dev/socket/ss_conn_daemon\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  9231 @mcdaemon\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  2826 /dev/socket/installd\n';
              });

              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(_libWebviewHelpers2['default'].getWebviews(adb));

            case 3:
              webViews = context$4$0.sent;

            case 4:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });

      afterEach(function () {
        sandbox.restore();
      });

      it('then the unix sockets are queried', function () {
        adb.shell.calledOnce.should.be['true'];
        adb.shell.getCall(0).args[0].should.deep.equal(['cat', '/proc/net/unix']);
      });

      it('then no webviews are returned', function () {
        webViews.length.should.equal(0);
      });
    });

    describe('and webviews exist', function callee$2$0() {
      var webViews;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        var _this2 = this;

        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            webViews = undefined;

            beforeEach(function callee$3$0() {
              var shellStub;
              return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
                while (1) switch (context$4$0.prev = context$4$0.next) {
                  case 0:
                    shellStub = sandbox.stub(adb, 'shell');

                    shellStub.onCall(0).returns('Num       RefCount Protocol Flags    Type St Inode Path\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  2818 /dev/socket/ss_conn_daemon\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  9231 @mcdaemon\n' + '0000000000000000: 00000002 00000000 00010000 0001 01 245445 @webview_devtools_remote_1234\n' + '0000000000000000: 00000002 00000000 00010000 0001 01  2826 /dev/socket/installd\n');
                    shellStub.onCall(1).returns('USER      PID   PPID  VSIZE  RSS   WCHAN              PC  NAME\n' + 'root      1     0     5792   988   SyS_epoll_ 0000000000 S /init\n' + 'root      2     0     0      0       kthreadd 0000000000 S kthreadd\n' + 'root   1234     2     0      0     SyS_epoll_ 0000000000 S com.application.myapp\n');

                    context$4$0.next = 5;
                    return _regeneratorRuntime.awrap(_libWebviewHelpers2['default'].getWebviews(adb));

                  case 5:
                    webViews = context$4$0.sent;

                  case 6:
                  case 'end':
                    return context$4$0.stop();
                }
              }, null, _this2);
            });

            afterEach(function () {
              sandbox.restore();
            });

            it('then the unix sockets and process list are queried', function () {
              adb.shell.calledTwice.should.be['true'];
              adb.shell.getCall(0).args[0].should.deep.equal(['cat', '/proc/net/unix']);
              adb.shell.getCall(1).args[0].should.equal('ps');
            });

            it('then the webview is returned', function callee$3$0() {
              return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
                while (1) switch (context$4$0.prev = context$4$0.next) {
                  case 0:
                    webViews.length.should.equal(1);
                    webViews.should.deep.equal(['WEBVIEW_com.application.myapp']);

                  case 2:
                  case 'end':
                    return context$4$0.stop();
                }
              }, null, _this2);
            });

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC93ZWJ2aWV3LWhlbHBlci1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7OztxQkFBa0IsT0FBTzs7OztpQ0FDTCwyQkFBMkI7Ozs7eUJBQy9CLFlBQVk7Ozs7QUFFNUIsSUFBSSxPQUFPLEdBQUcsbUJBQU0sT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDOztBQUVyQyxRQUFRLENBQUMsaUJBQWlCLEVBQUUsWUFBTTtBQUNoQyxNQUFJLEdBQUcsR0FBRyw0QkFBUyxDQUFDOztBQUVwQixVQUFRLENBQUMsZ0NBQWdDLEVBQUUsWUFBTTtBQUMvQyxZQUFRLENBQUMsaUNBQWlDLEVBQUUsWUFBTTtBQUNoRCxVQUFJLFFBQVEsWUFBQSxDQUFDOztBQUViLGdCQUFVLENBQUM7Ozs7QUFDVCxxQkFBTyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLFlBQU07QUFDL0IsdUJBQU8sMkRBQTJELEdBQzVELHlGQUF5RixHQUN6Rix3RUFBd0UsR0FDeEUsNEZBQTRGLEdBQzVGLG1GQUFtRixDQUFDO2VBQzNGLENBQUMsQ0FBQzs7OytDQUVjLCtCQUFRLFdBQVcsQ0FBQyxHQUFHLEVBQUUsNkJBQTZCLENBQUM7OztBQUF4RSxzQkFBUTs7Ozs7OztPQUNULENBQUMsQ0FBQzs7QUFFSCxlQUFTLENBQUMsWUFBTTtBQUNkLGVBQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztPQUNuQixDQUFDLENBQUM7O0FBRUgsUUFBRSxDQUFDLG1DQUFtQyxFQUFFLFlBQU07QUFDNUMsV0FBRyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEVBQUUsUUFBSyxDQUFDO0FBQ3BDLFdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7T0FD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QyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEMsNEJBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLCtCQUErQixDQUFDLENBQUMsQ0FBQzs7Ozs7OzthQUMvRCxDQUFDLENBQUM7Ozs7Ozs7S0FDSixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC91bml0L3dlYnZpZXctaGVscGVyLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHNpbm9uIGZyb20gJ3Npbm9uJztcbmltcG9ydCBoZWxwZXJzIGZyb20gJy4uLy4uL2xpYi93ZWJ2aWV3LWhlbHBlcnMnO1xuaW1wb3J0IEFEQiBmcm9tICdhcHBpdW0tYWRiJztcblxubGV0IHNhbmRib3ggPSBzaW5vbi5zYW5kYm94LmNyZWF0ZSgpO1xuXG5kZXNjcmliZSgnV2VidmlldyBIZWxwZXJzJywgKCkgPT4ge1xuICBsZXQgYWRiID0gbmV3IEFEQigpO1xuXG4gIGRlc2NyaWJlKCdXaGVuIHRoZSB3ZWJ2aWV3cyBhcmUgb2J0YWluZWQnLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoJ2ZvciBhbiBhcHAgdGhhdCBlbWJlZHMgQ2hyb21pdW0nLCAoKSA9PiB7XG4gICAgICBsZXQgd2ViVmlld3M7XG4gICAgICBcbiAgICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgICBzYW5kYm94LnN0dWIoYWRiLCAnc2hlbGwnLCAoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuICdOdW0gICAgICAgUmVmQ291bnQgUHJvdG9jb2wgRmxhZ3MgICAgVHlwZSBTdCBJbm9kZSBQYXRoXFxuJyArXG4gICAgICAgICAgICAgICAgJzAwMDAwMDAwMDAwMDAwMDA6IDAwMDAwMDAyIDAwMDAwMDAwIDAwMDEwMDAwIDAwMDEgMDEgIDI4MTggL2Rldi9zb2NrZXQvc3NfY29ubl9kYWVtb25cXG4nICtcbiAgICAgICAgICAgICAgICAnMDAwMDAwMDAwMDAwMDAwMDogMDAwMDAwMDIgMDAwMDAwMDAgMDAwMTAwMDAgMDAwMSAwMSAgOTIzMSBAbWNkYWVtb25cXG4nICtcbiAgICAgICAgICAgICAgICAnMDAwMDAwMDAwMDAwMDAwMDogMDAwMDAwMDIgMDAwMDAwMDAgMDAwMTAwMDAgMDAwMSAwMSAyNDU0NDUgQHdlYnZpZXdfZGV2dG9vbHNfcmVtb3RlXzEyM1xcbicgK1xuICAgICAgICAgICAgICAgICcwMDAwMDAwMDAwMDAwMDAwOiAwMDAwMDAwMiAwMDAwMDAwMCAwMDAxMDAwMCAwMDAxIDAxICAyODI2IC9kZXYvc29ja2V0L2luc3RhbGxkXFxuJztcbiAgICAgICAgfSk7ICBcblxuICAgICAgICB3ZWJWaWV3cyA9IGF3YWl0IGhlbHBlcnMuZ2V0V2Vidmlld3MoYWRiLCAnd2Vidmlld19kZXZ0b29sc19yZW1vdGVfMTIzJyk7XG4gICAgICB9KTtcblxuICAgICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgICAgc2FuZGJveC5yZXN0b3JlKCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3RoZW4gdGhlIHVuaXggc29ja2V0cyBhcmUgcXVlcmllZCcsICgpID0+IHtcbiAgICAgICAgYWRiLnNoZWxsLmNhbGxlZE9uY2Uuc2hvdWxkLmJlLnRydWU7XG4gICAgICAgIGFkYi5zaGVsbC5nZXRDYWxsKDApLmFyZ3NbMF0uc2hvdWxkLmRlZXAuZXF1YWwoWydjYXQnLCAnL3Byb2MvbmV0L3VuaXgnXSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3RoZW4gdGhlIHdlYnZpZXcgaXMgcmV0dXJuZWQnLCAoKSA9PiB7XG4gICAgICAgIHdlYlZpZXdzLmxlbmd0aC5zaG91bGQuZXF1YWwoMSk7XG4gICAgICAgIHdlYlZpZXdzLnNob3VsZC5kZWVwLmVxdWFsKFsnV0VCVklFV18xMjMnXSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdmb3IgYSBDaHJvbWl1bSB3ZWJ2aWV3JywgKCkgPT4ge1xuICAgICAgbGV0IHdlYlZpZXdzO1xuICAgICAgXG4gICAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgICAgc2FuZGJveC5zdHViKGFkYiwgJ3NoZWxsJywgKCkgPT4ge1xuICAgICAgICAgIHJldHVybiAnTnVtICAgICAgIFJlZkNvdW50IFByb3RvY29sIEZsYWdzICAgIFR5cGUgU3QgSW5vZGUgUGF0aFxcbicgK1xuICAgICAgICAgICAgICAgICcwMDAwMDAwMDAwMDAwMDAwOiAwMDAwMDAwMiAwMDAwMDAwMCAwMDAxMDAwMCAwMDAxIDAxICAyODE4IC9kZXYvc29ja2V0L3NzX2Nvbm5fZGFlbW9uXFxuJyArXG4gICAgICAgICAgICAgICAgJzAwMDAwMDAwMDAwMDAwMDA6IDAwMDAwMDAyIDAwMDAwMDAwIDAwMDEwMDAwIDAwMDEgMDEgIDkyMzEgQG1jZGFlbW9uXFxuJyArXG4gICAgICAgICAgICAgICAgJzAwMDAwMDAwMDAwMDAwMDA6IDAwMDAwMDAyIDAwMDAwMDAwIDAwMDEwMDAwIDAwMDEgMDEgMjQ1NDQ1IEBjaHJvbWVfZGV2dG9vbHNfcmVtb3RlXFxuJyArXG4gICAgICAgICAgICAgICAgJzAwMDAwMDAwMDAwMDAwMDA6IDAwMDAwMDAyIDAwMDAwMDAwIDAwMDEwMDAwIDAwMDEgMDEgIDI4MjYgL2Rldi9zb2NrZXQvaW5zdGFsbGRcXG4nO1xuICAgICAgICB9KTsgIFxuXG4gICAgICAgIHdlYlZpZXdzID0gYXdhaXQgaGVscGVycy5nZXRXZWJ2aWV3cyhhZGIsICdjaHJvbWVfZGV2dG9vbHNfcmVtb3RlJyk7XG4gICAgICB9KTtcblxuICAgICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgICAgc2FuZGJveC5yZXN0b3JlKCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3RoZW4gdGhlIHVuaXggc29ja2V0cyBhcmUgcXVlcmllZCcsICgpID0+IHtcbiAgICAgICAgYWRiLnNoZWxsLmNhbGxlZE9uY2Uuc2hvdWxkLmJlLnRydWU7XG4gICAgICAgIGFkYi5zaGVsbC5nZXRDYWxsKDApLmFyZ3NbMF0uc2hvdWxkLmRlZXAuZXF1YWwoWydjYXQnLCAnL3Byb2MvbmV0L3VuaXgnXSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3RoZW4gdGhlIHdlYnZpZXcgaXMgcmV0dXJuZWQnLCAoKSA9PiB7XG4gICAgICAgIHdlYlZpZXdzLmxlbmd0aC5zaG91bGQuZXF1YWwoMSk7XG4gICAgICAgIHdlYlZpZXdzLnNob3VsZC5kZWVwLmVxdWFsKFsnQ0hST01JVU0nXSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdhbmQgbm8gd2Vidmlld3MgZXhpc3QnLCAoKSA9PiB7XG4gICAgICBsZXQgd2ViVmlld3M7XG4gICAgICBcbiAgICAgIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgICBzYW5kYm94LnN0dWIoYWRiLCAnc2hlbGwnLCAoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuICdOdW0gICAgICAgUmVmQ291bnQgUHJvdG9jb2wgRmxhZ3MgICAgVHlwZSBTdCBJbm9kZSBQYXRoXFxuJyArXG4gICAgICAgICAgICAgICAgJzAwMDAwMDAwMDAwMDAwMDA6IDAwMDAwMDAyIDAwMDAwMDAwIDAwMDEwMDAwIDAwMDEgMDEgIDI4MTggL2Rldi9zb2NrZXQvc3NfY29ubl9kYWVtb25cXG4nICtcbiAgICAgICAgICAgICAgICAnMDAwMDAwMDAwMDAwMDAwMDogMDAwMDAwMDIgMDAwMDAwMDAgMDAwMTAwMDAgMDAwMSAwMSAgOTIzMSBAbWNkYWVtb25cXG4nICtcbiAgICAgICAgICAgICAgICAnMDAwMDAwMDAwMDAwMDAwMDogMDAwMDAwMDIgMDAwMDAwMDAgMDAwMTAwMDAgMDAwMSAwMSAgMjgyNiAvZGV2L3NvY2tldC9pbnN0YWxsZFxcbic7XG4gICAgICAgIH0pOyAgXG5cbiAgICAgICAgd2ViVmlld3MgPSBhd2FpdCBoZWxwZXJzLmdldFdlYnZpZXdzKGFkYik7XG4gICAgICB9KTtcblxuICAgICAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICAgICAgc2FuZGJveC5yZXN0b3JlKCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3RoZW4gdGhlIHVuaXggc29ja2V0cyBhcmUgcXVlcmllZCcsICgpID0+IHtcbiAgICAgICAgYWRiLnNoZWxsLmNhbGxlZE9uY2Uuc2hvdWxkLmJlLnRydWU7XG4gICAgICAgIGFkYi5zaGVsbC5nZXRDYWxsKDApLmFyZ3NbMF0uc2hvdWxkLmRlZXAuZXF1YWwoWydjYXQnLCAnL3Byb2MvbmV0L3VuaXgnXSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3RoZW4gbm8gd2Vidmlld3MgYXJlIHJldHVybmVkJywgKCkgPT4ge1xuICAgICAgICB3ZWJWaWV3cy5sZW5ndGguc2hvdWxkLmVxdWFsKDApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnYW5kIHdlYnZpZXdzIGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHdlYlZpZXdzO1xuXG4gICAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IHNoZWxsU3R1YiA9IHNhbmRib3guc3R1YihhZGIsICdzaGVsbCcpO1xuICAgICAgICBcbiAgICAgICAgc2hlbGxTdHViLm9uQ2FsbCgwKS5yZXR1cm5zKCdOdW0gICAgICAgUmVmQ291bnQgUHJvdG9jb2wgRmxhZ3MgICAgVHlwZSBTdCBJbm9kZSBQYXRoXFxuJyArXG4gICAgICAgICAgICAgICAgJzAwMDAwMDAwMDAwMDAwMDA6IDAwMDAwMDAyIDAwMDAwMDAwIDAwMDEwMDAwIDAwMDEgMDEgIDI4MTggL2Rldi9zb2NrZXQvc3NfY29ubl9kYWVtb25cXG4nICtcbiAgICAgICAgICAgICAgICAnMDAwMDAwMDAwMDAwMDAwMDogMDAwMDAwMDIgMDAwMDAwMDAgMDAwMTAwMDAgMDAwMSAwMSAgOTIzMSBAbWNkYWVtb25cXG4nICtcbiAgICAgICAgICAgICAgICAnMDAwMDAwMDAwMDAwMDAwMDogMDAwMDAwMDIgMDAwMDAwMDAgMDAwMTAwMDAgMDAwMSAwMSAyNDU0NDUgQHdlYnZpZXdfZGV2dG9vbHNfcmVtb3RlXzEyMzRcXG4nICtcbiAgICAgICAgICAgICAgICAnMDAwMDAwMDAwMDAwMDAwMDogMDAwMDAwMDIgMDAwMDAwMDAgMDAwMTAwMDAgMDAwMSAwMSAgMjgyNiAvZGV2L3NvY2tldC9pbnN0YWxsZFxcbicpO1xuICAgICAgICBzaGVsbFN0dWIub25DYWxsKDEpLnJldHVybnMoJ1VTRVIgICAgICBQSUQgICBQUElEICBWU0laRSAgUlNTICAgV0NIQU4gICAgICAgICAgICAgIFBDICBOQU1FXFxuJyArXG4gICAgICAgICAgICAgICAgJ3Jvb3QgICAgICAxICAgICAwICAgICA1NzkyICAgOTg4ICAgU3lTX2Vwb2xsXyAwMDAwMDAwMDAwIFMgL2luaXRcXG4nICtcbiAgICAgICAgICAgICAgICAncm9vdCAgICAgIDIgICAgIDAgICAgIDAgICAgICAwICAgICAgIGt0aHJlYWRkIDAwMDAwMDAwMDAgUyBrdGhyZWFkZFxcbicgK1xuICAgICAgICAgICAgICAgICdyb290ICAgMTIzNCAgICAgMiAgICAgMCAgICAgIDAgICAgIFN5U19lcG9sbF8gMDAwMDAwMDAwMCBTIGNvbS5hcHBsaWNhdGlvbi5teWFwcFxcbicpO1xuXG4gICAgICAgIHdlYlZpZXdzID0gYXdhaXQgaGVscGVycy5nZXRXZWJ2aWV3cyhhZGIpO1xuICAgICAgfSk7XG5cbiAgICAgIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCd0aGVuIHRoZSB1bml4IHNvY2tldHMgYW5kIHByb2Nlc3MgbGlzdCBhcmUgcXVlcmllZCcsICgpID0+IHtcbiAgICAgICAgYWRiLnNoZWxsLmNhbGxlZFR3aWNlLnNob3VsZC5iZS50cnVlO1xuICAgICAgICBhZGIuc2hlbGwuZ2V0Q2FsbCgwKS5hcmdzWzBdLnNob3VsZC5kZWVwLmVxdWFsKFsnY2F0JywgJy9wcm9jL25ldC91bml4J10pO1xuICAgICAgICBhZGIuc2hlbGwuZ2V0Q2FsbCgxKS5hcmdzWzBdLnNob3VsZC5lcXVhbCgncHMnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgndGhlbiB0aGUgd2VidmlldyBpcyByZXR1cm5lZCcsIGFzeW5jICgpID0+IHtcbiAgICAgICAgd2ViVmlld3MubGVuZ3RoLnNob3VsZC5lcXVhbCgxKTtcbiAgICAgICAgd2ViVmlld3Muc2hvdWxkLmRlZXAuZXF1YWwoWydXRUJWSUVXX2NvbS5hcHBsaWNhdGlvbi5teWFwcCddKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
