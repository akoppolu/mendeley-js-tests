'use strict';

var _defineProperty = require('babel-runtime/helpers/define-property')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _appiumAndroidBootstrap = require('appium-android-bootstrap');

var _appiumAndroidBootstrap2 = _interopRequireDefault(_appiumAndroidBootstrap);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _mockFs = require('mock-fs');

var _mockFs2 = _interopRequireDefault(_mockFs);

var _ = require('../../..');

var _2 = _interopRequireDefault(_);

var _appiumSupport = require('appium-support');

var _temp = require('temp');

var _temp2 = _interopRequireDefault(_temp);

var driver = undefined;
var sandbox = _sinon2['default'].sandbox.create();
_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('Actions', function () {
  before(function () {
    driver = new _2['default']();
    driver.bootstrap = new _appiumAndroidBootstrap2['default']();
    sandbox.stub(driver.bootstrap, 'sendAction');
  });
  after(function () {
    sandbox.restore();
  });
  describe('Swipe', function () {
    it('should swipe an element', function () {
      driver.swipe(0, 0, 1, 1, 0, 1, 'someElementId');
      driver.bootstrap.sendAction.calledWith('element:swipe').should.be['true'];
    });
    it('should swipe without an element', function () {
      driver.swipe(0, 0, 1, 1, 0, 1);
      driver.bootstrap.sendAction.calledWith('swipe').should.be['true'];
    });
  });
  describe('Flick', function () {
    it('should flick an element', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.flick('someElementId', 0, 0, 1, 1, 1));

          case 2:
            driver.bootstrap.sendAction.calledWith('element:flick').should.be['true'];

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
    it('should flick without an element', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.flick(null, 0, 0, 1, 1, 1));

          case 2:
            driver.bootstrap.sendAction.calledWith('flick').should.be['true'];

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });
  describe('Drag', function () {
    it('should drag an element', function () {
      driver.drag(0, 0, 1, 1, 1, 1, 'someElementId');
      driver.bootstrap.sendAction.calledWith('element:drag').should.be['true'];
    });
    it('should drag without an element', function () {
      driver.drag(0, 0, 1, 1, 1, 1);
      driver.bootstrap.sendAction.calledWith('drag').should.be['true'];
    });
  });
  describe('pullFolder', function () {
    var zippedDir = undefined,
        unzippedDir = undefined,
        tempDir = undefined,
        tempPathStub = undefined;

    before(function () {
      var _mockFS;

      // Create in-memory mock file system for file writes
      zippedDir = '/mock/path/to/zipped';
      unzippedDir = '/mock/path/to/unzipped';
      tempDir = '/mock/path/to/temp-dir';
      (0, _mockFs2['default'])((_mockFS = {}, _defineProperty(_mockFS, zippedDir, {}), _defineProperty(_mockFS, unzippedDir, {}), _defineProperty(_mockFS, tempDir, {}), _mockFS));

      // Stub temp.path to use an in-memory filepath
      tempPathStub = _sinon2['default'].stub(_temp2['default'], 'path', function () {
        return tempDir;
      });
    });

    after(function () {
      tempPathStub.restore();
      _mockFs2['default'].restore();
    });

    it('should pull a folder and return base64 zip', function callee$2$0() {
      var adbPullStub, pull, zippedBase64;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        var _this2 = this;

        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            adbPullStub = undefined;

            pull = function pull(ignore, localPath) {
              return _regeneratorRuntime.async(function pull$(context$4$0) {
                while (1) switch (context$4$0.prev = context$4$0.next) {
                  case 0:
                    context$4$0.next = 2;
                    return _regeneratorRuntime.awrap(_appiumSupport.fs.writeFile(_path2['default'].resolve(localPath, 'a.txt'), 'hello world', { flags: 'w' }));

                  case 2:
                    context$4$0.next = 4;
                    return _regeneratorRuntime.awrap(_appiumSupport.fs.writeFile(_path2['default'].resolve(localPath, 'b.txt'), 'foobar', { flags: 'w' }));

                  case 4:
                  case 'end':
                    return context$4$0.stop();
                }
              }, null, _this2);
            };

            if (!driver.adb) {
              driver.adb = { pull: pull };
            } else {
              adbPullStub = _sinon2['default'].stub(driver.adb, 'pull', pull);
            }

            // Call 'driver.pullFolder' and zip the base64 contents to a .zip file
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.pullFolder('/does/not/matter'));

          case 5:
            zippedBase64 = context$3$0.sent;

            (typeof zippedBase64).should.equal('string');
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.writeFile(_path2['default'].resolve(zippedDir, 'zipped.zip'), zippedBase64, { encoding: 'base64', flags: 'w' }));

          case 9:
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(_appiumSupport.zip.extractAllTo(_path2['default'].resolve(zippedDir, 'zipped.zip'), unzippedDir));

          case 11:
            context$3$0.next = 13;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.readFile(_path2['default'].resolve(unzippedDir, 'a.txt'), 'utf8').should.eventually.equal('hello world'));

          case 13:
            context$3$0.next = 15;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.readFile(_path2['default'].resolve(unzippedDir, 'b.txt'), 'utf8').should.eventually.equal('foobar'));

          case 15:

            // Restore stub
            if (adbPullStub) {
              adbPullStub.restore();
            } else {
              delete driver.adb;
            }

          case 16:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });
});

// Stub in driver.adb and make it pull a folder with two files

// Extract the zip file and verify it's contents
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvdW5pdC9jb21tYW5kcy9hY3Rpb25zLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7b0JBQWlCLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3FCQUMzQixPQUFPOzs7O3NDQUNILDBCQUEwQjs7OztvQkFDL0IsTUFBTTs7OztzQkFDSixTQUFTOzs7O2dCQUNGLFVBQVU7Ozs7NkJBQ1osZ0JBQWdCOztvQkFDdkIsTUFBTTs7OztBQUV2QixJQUFJLE1BQU0sWUFBQSxDQUFDO0FBQ1gsSUFBSSxPQUFPLEdBQUcsbUJBQU0sT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ3JDLGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsUUFBUSxDQUFDLFNBQVMsRUFBRSxZQUFNO0FBQ3hCLFFBQU0sQ0FBQyxZQUFNO0FBQ1gsVUFBTSxHQUFHLG1CQUFtQixDQUFDO0FBQzdCLFVBQU0sQ0FBQyxTQUFTLEdBQUcseUNBQWUsQ0FBQztBQUNuQyxXQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLENBQUM7R0FDOUMsQ0FBQyxDQUFDO0FBQ0gsT0FBSyxDQUFDLFlBQU07QUFDVixXQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7R0FDbkIsQ0FBQyxDQUFDO0FBQ0gsVUFBUSxDQUFDLE9BQU8sRUFBRSxZQUFNO0FBQ3RCLE1BQUUsQ0FBQyx5QkFBeUIsRUFBRSxZQUFNO0FBQ2xDLFlBQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsZUFBZSxDQUFDLENBQUM7QUFDaEQsWUFBTSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLFFBQUssQ0FBQztLQUN4RSxDQUFDLENBQUM7QUFDSCxNQUFFLENB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RixrQkFBRyxRQUFRLENBQUMsa0JBQUssT0FBTyxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUM7Ozs7O0FBRy9GLGdCQUFJLFdBQVcsRUFBRTtBQUNmLHlCQUFXLENBQUMsT0FBTyxFQUFFLENBQUM7YUFDdkIsTUFBTTtBQUNMLHFCQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUM7YUFDbkI7Ozs7Ozs7S0FDRixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC91bml0L2NvbW1hbmRzL2FjdGlvbnMtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgQm9vdHN0cmFwIGZyb20gJ2FwcGl1bS1hbmRyb2lkLWJvb3RzdHJhcCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBtb2NrRlMgZnJvbSAnbW9jay1mcyc7XG5pbXBvcnQgQW5kcm9pZERyaXZlciBmcm9tICcuLi8uLi8uLic7XG5pbXBvcnQgeyBmcywgemlwIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IHRlbXAgZnJvbSAndGVtcCc7XG5cbmxldCBkcml2ZXI7XG5sZXQgc2FuZGJveCA9IHNpbm9uLnNhbmRib3guY3JlYXRlKCk7XG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5kZXNjcmliZSgnQWN0aW9ucycsICgpID0+IHtcbiAgYmVmb3JlKCgpID0+IHtcbiAgICBkcml2ZXIgPSBuZXcgQW5kcm9pZERyaXZlcigpO1xuICAgIGRyaXZlci5ib290c3RyYXAgPSBuZXcgQm9vdHN0cmFwKCk7XG4gICAgc2FuZGJveC5zdHViKGRyaXZlci5ib290c3RyYXAsICdzZW5kQWN0aW9uJyk7XG4gIH0pO1xuICBhZnRlcigoKSA9PiB7XG4gICAgc2FuZGJveC5yZXN0b3JlKCk7XG4gIH0pO1xuICBkZXNjcmliZSgnU3dpcGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzd2lwZSBhbiBlbGVtZW50JywgKCkgPT4ge1xuICAgICAgZHJpdmVyLnN3aXBlKDAsIDAsIDEsIDEsIDAsIDEsICdzb21lRWxlbWVudElkJyk7XG4gICAgICBkcml2ZXIuYm9vdHN0cmFwLnNlbmRBY3Rpb24uY2FsbGVkV2l0aCgnZWxlbWVudDpzd2lwZScpLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgc3dpcGUgd2l0aG91dCBhbiBlbGVtZW50JywgKCkgPT4ge1xuICAgICAgZHJpdmVyLnN3aXBlKDAsIDAsIDEsIDEsIDAsIDEpO1xuICAgICAgZHJpdmVyLmJvb3RzdHJhcC5zZW5kQWN0aW9uLmNhbGxlZFdpdGgoJ3N3aXBlJykuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnRmxpY2snLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmbGljayBhbiBlbGVtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLmZsaWNrKCdzb21lRWxlbWVudElkJywgMCwgMCwgMSwgMSwgMSk7XG4gICAgICBkcml2ZXIuYm9vdHN0cmFwLnNlbmRBY3Rpb24uY2FsbGVkV2l0aCgnZWxlbWVudDpmbGljaycpLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZmxpY2sgd2l0aG91dCBhbiBlbGVtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLmZsaWNrKG51bGwsIDAsIDAsIDEsIDEsIDEpO1xuICAgICAgZHJpdmVyLmJvb3RzdHJhcC5zZW5kQWN0aW9uLmNhbGxlZFdpdGgoJ2ZsaWNrJykuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG4gIH0pO1xuICBkZXNjcmliZSgnRHJhZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRyYWcgYW4gZWxlbWVudCcsICgpID0+IHtcbiAgICAgIGRyaXZlci5kcmFnKDAsIDAsIDEsIDEsIDEsIDEsICdzb21lRWxlbWVudElkJyk7XG4gICAgICBkcml2ZXIuYm9vdHN0cmFwLnNlbmRBY3Rpb24uY2FsbGVkV2l0aCgnZWxlbWVudDpkcmFnJykuc2hvdWxkLmJlLnRydWU7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBkcmFnIHdpdGhvdXQgYW4gZWxlbWVudCcsICgpID0+IHtcbiAgICAgIGRyaXZlci5kcmFnKDAsIDAsIDEsIDEsIDEsIDEpO1xuICAgICAgZHJpdmVyLmJvb3RzdHJhcC5zZW5kQWN0aW9uLmNhbGxlZFdpdGgoJ2RyYWcnKS5zaG91bGQuYmUudHJ1ZTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKCdwdWxsRm9sZGVyJywgKCkgPT4ge1xuICAgIGxldCB6aXBwZWREaXIsIHVuemlwcGVkRGlyLCB0ZW1wRGlyLCB0ZW1wUGF0aFN0dWI7XG5cbiAgICBiZWZvcmUoKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGluLW1lbW9yeSBtb2NrIGZpbGUgc3lzdGVtIGZvciBmaWxlIHdyaXRlc1xuICAgICAgemlwcGVkRGlyID0gJy9tb2NrL3BhdGgvdG8vemlwcGVkJztcbiAgICAgIHVuemlwcGVkRGlyID0gJy9tb2NrL3BhdGgvdG8vdW56aXBwZWQnO1xuICAgICAgdGVtcERpciA9ICcvbW9jay9wYXRoL3RvL3RlbXAtZGlyJztcbiAgICAgIG1vY2tGUyh7XG4gICAgICAgIFt6aXBwZWREaXJdOiB7fSxcbiAgICAgICAgW3VuemlwcGVkRGlyXToge30sXG4gICAgICAgIFt0ZW1wRGlyXToge30sXG4gICAgICB9KTtcblxuICAgICAgLy8gU3R1YiB0ZW1wLnBhdGggdG8gdXNlIGFuIGluLW1lbW9yeSBmaWxlcGF0aFxuICAgICAgdGVtcFBhdGhTdHViID0gc2lub24uc3R1Yih0ZW1wLCAncGF0aCcsICgpID0+IHRlbXBEaXIpO1xuICAgIH0pO1xuXG4gICAgYWZ0ZXIoKCkgPT4ge1xuICAgICAgdGVtcFBhdGhTdHViLnJlc3RvcmUoKTtcbiAgICAgIG1vY2tGUy5yZXN0b3JlKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHB1bGwgYSBmb2xkZXIgYW5kIHJldHVybiBiYXNlNjQgemlwJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU3R1YiBpbiBkcml2ZXIuYWRiIGFuZCBtYWtlIGl0IHB1bGwgYSBmb2xkZXIgd2l0aCB0d28gZmlsZXNcbiAgICAgIGxldCBhZGJQdWxsU3R1YjtcbiAgICAgIGNvbnN0IHB1bGwgPSBhc3luYyAoaWdub3JlLCBsb2NhbFBhdGgpID0+IHtcbiAgICAgICAgYXdhaXQgZnMud3JpdGVGaWxlKHBhdGgucmVzb2x2ZShsb2NhbFBhdGgsICdhLnR4dCcpLCAnaGVsbG8gd29ybGQnLCB7ZmxhZ3M6ICd3J30pO1xuICAgICAgICBhd2FpdCBmcy53cml0ZUZpbGUocGF0aC5yZXNvbHZlKGxvY2FsUGF0aCwgJ2IudHh0JyksICdmb29iYXInLCB7ZmxhZ3M6ICd3J30pO1xuICAgICAgfTtcbiAgICAgIGlmICghZHJpdmVyLmFkYikge1xuICAgICAgICBkcml2ZXIuYWRiID0ge3B1bGx9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYWRiUHVsbFN0dWIgPSBzaW5vbi5zdHViKGRyaXZlci5hZGIsICdwdWxsJywgcHVsbCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGwgJ2RyaXZlci5wdWxsRm9sZGVyJyBhbmQgemlwIHRoZSBiYXNlNjQgY29udGVudHMgdG8gYSAuemlwIGZpbGVcbiAgICAgIGNvbnN0IHppcHBlZEJhc2U2NCA9IGF3YWl0IGRyaXZlci5wdWxsRm9sZGVyKCcvZG9lcy9ub3QvbWF0dGVyJyk7XG4gICAgICAodHlwZW9mKHppcHBlZEJhc2U2NCkpLnNob3VsZC5lcXVhbCgnc3RyaW5nJyk7XG4gICAgICBhd2FpdCBmcy53cml0ZUZpbGUocGF0aC5yZXNvbHZlKHppcHBlZERpciwgJ3ppcHBlZC56aXAnKSwgemlwcGVkQmFzZTY0LCB7ZW5jb2Rpbmc6ICdiYXNlNjQnLCBmbGFnczogJ3cnfSk7XG5cbiAgICAgIC8vIEV4dHJhY3QgdGhlIHppcCBmaWxlIGFuZCB2ZXJpZnkgaXQncyBjb250ZW50c1xuICAgICAgYXdhaXQgemlwLmV4dHJhY3RBbGxUbyhwYXRoLnJlc29sdmUoemlwcGVkRGlyLCAnemlwcGVkLnppcCcpLCB1bnppcHBlZERpcik7XG4gICAgICBhd2FpdCBmcy5yZWFkRmlsZShwYXRoLnJlc29sdmUodW56aXBwZWREaXIsICdhLnR4dCcpLCAndXRmOCcpLnNob3VsZC5ldmVudHVhbGx5LmVxdWFsKCdoZWxsbyB3b3JsZCcpO1xuICAgICAgYXdhaXQgZnMucmVhZEZpbGUocGF0aC5yZXNvbHZlKHVuemlwcGVkRGlyLCAnYi50eHQnKSwgJ3V0ZjgnKS5zaG91bGQuZXZlbnR1YWxseS5lcXVhbCgnZm9vYmFyJyk7XG5cbiAgICAgIC8vIFJlc3RvcmUgc3R1YlxuICAgICAgaWYgKGFkYlB1bGxTdHViKSB7XG4gICAgICAgIGFkYlB1bGxTdHViLnJlc3RvcmUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlbGV0ZSBkcml2ZXIuYWRiO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLiJ9
