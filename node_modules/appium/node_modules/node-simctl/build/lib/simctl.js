'use strict';

var _extends = require('babel-runtime/helpers/extends')['default'];

var _toConsumableArray = require('babel-runtime/helpers/to-consumable-array')['default'];

var _slicedToArray = require('babel-runtime/helpers/sliced-to-array')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _teen_process = require('teen_process');

var _asyncbox = require('asyncbox');

var _appiumSupport = require('appium-support');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var log = _appiumSupport.logger.getLogger('simctl');

function simCommand(command, timeout) {
  var args = arguments.length <= 2 || arguments[2] === undefined ? [] : arguments[2];
  var env = arguments.length <= 3 || arguments[3] === undefined ? {} : arguments[3];
  var executingFunction = arguments.length <= 4 || arguments[4] === undefined ? _teen_process.exec : arguments[4];
  var logErrors = arguments.length <= 5 || arguments[5] === undefined ? true : arguments[5];
  return _regeneratorRuntime.async(function simCommand$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        // run a particular simctl command
        args = ['simctl', command].concat(_toConsumableArray(args));
        // Prefix all passed in environment variables with 'SIMCTL_CHILD_', simctl
        // will then pass these to the child (spawned) process.
        env = _lodash2['default'].defaults(_lodash2['default'].mapKeys(env, function (value, key) {
          return 'SIMCTL_CHILD_' + key;
        }), process.env);

        context$1$0.prev = 2;
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(executingFunction('xcrun', args, { timeout: timeout, env: env }));

      case 5:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 8:
        context$1$0.prev = 8;
        context$1$0.t0 = context$1$0['catch'](2);

        if (logErrors) {
          context$1$0.next = 14;
          break;
        }

        throw context$1$0.t0;

      case 14:
        if (context$1$0.t0.stderr) {
          log.errorAndThrow('simctl error running \'' + command + '\': ' + context$1$0.t0.stderr.trim());
        } else {
          log.errorAndThrow(context$1$0.t0);
        }

      case 15:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[2, 8]]);
}

function simExec(command, timeout) {
  var args = arguments.length <= 2 || arguments[2] === undefined ? [] : arguments[2];
  var env = arguments.length <= 3 || arguments[3] === undefined ? {} : arguments[3];
  var logErrors = arguments.length <= 4 || arguments[4] === undefined ? true : arguments[4];
  return _regeneratorRuntime.async(function simExec$(context$1$0) {
    var _this = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simCommand(command, timeout, args, env, function callee$1$0(c, a, ob) {
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                context$2$0.next = 2;
                return _regeneratorRuntime.awrap((0, _teen_process.exec)(c, a, ob));

              case 2:
                return context$2$0.abrupt('return', context$2$0.sent);

              case 3:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        }, logErrors));

      case 2:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function simSubProcess(command, timeout) {
  var args = arguments.length <= 2 || arguments[2] === undefined ? [] : arguments[2];
  var env = arguments.length <= 3 || arguments[3] === undefined ? {} : arguments[3];
  return _regeneratorRuntime.async(function simSubProcess$(context$1$0) {
    var _this2 = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simCommand(command, timeout, args, env, function callee$1$0(c, a, ob) {
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                return context$2$0.abrupt('return', new _teen_process.SubProcess(c, a, ob));

              case 1:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this2);
        }));

      case 2:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function installApp(udid, appPath) {
  return _regeneratorRuntime.async(function installApp$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simExec('install', 0, [udid, appPath]));

      case 2:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function removeApp(udid, bundleId) {
  return _regeneratorRuntime.async(function removeApp$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simExec('uninstall', 0, [udid, bundleId]));

      case 2:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function launch(udid, bundleId) {
  var tries = arguments.length <= 2 || arguments[2] === undefined ? 5 : arguments[2];
  return _regeneratorRuntime.async(function launch$(context$1$0) {
    var _this3 = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap((0, _asyncbox.retryInterval)(tries, 1000, function callee$1$0() {
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                context$2$0.next = 2;
                return _regeneratorRuntime.awrap(simExec('launch', 0, [udid, bundleId]));

              case 2:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this3);
        }));

      case 2:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function spawn(udid, executablePath) {
  var env = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];
  return _regeneratorRuntime.async(function spawn$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simExec('spawn', 0, [udid, executablePath], env));

      case 2:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function spawnSubProcess(udid, executablePath) {
  var env = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];
  return _regeneratorRuntime.async(function spawnSubProcess$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simSubProcess('spawn', 0, [udid, executablePath], env));

      case 2:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function openUrl(udid, url) {
  return _regeneratorRuntime.async(function openUrl$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simExec('openurl', 0, [udid, url]));

      case 2:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function terminate(udid, bundleId) {
  return _regeneratorRuntime.async(function terminate$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simExec('terminate', 0, [udid, bundleId]));

      case 2:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function getAppContainer(udid, bundleId) {
  var logErrors = arguments.length <= 2 || arguments[2] === undefined ? true : arguments[2];

  var _ref, stdout;

  return _regeneratorRuntime.async(function getAppContainer$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simExec('get_app_container', 0, [udid, bundleId], {}, logErrors));

      case 2:
        _ref = context$1$0.sent;
        stdout = _ref.stdout;
        return context$1$0.abrupt('return', (stdout || '').trim());

      case 5:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function shutdown(udid) {
  return _regeneratorRuntime.async(function shutdown$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simExec('shutdown', 0, [udid]));

      case 2:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function createDevice(name, deviceTypeId, runtimeId) {
  var timeout = arguments.length <= 3 || arguments[3] === undefined ? 10000 : arguments[3];
  var udid, out, reason, retries;
  return _regeneratorRuntime.async(function createDevice$(context$1$0) {
    var _this4 = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        udid = undefined;
        context$1$0.prev = 1;
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(simExec('create', 0, [name, deviceTypeId, runtimeId]));

      case 4:
        out = context$1$0.sent;

        udid = out.stdout.trim();
        context$1$0.next = 13;
        break;

      case 8:
        context$1$0.prev = 8;
        context$1$0.t0 = context$1$0['catch'](1);
        reason = context$1$0.t0.message;

        if (context$1$0.t0.stderr) {
          reason = context$1$0.t0.stderr.trim();
        }
        log.errorAndThrow('Could not create simulator with name \'' + name + '\', device ' + ('type id \'' + deviceTypeId + '\' and runtime id \'' + runtimeId + '\'. Reason: \'' + reason + '\''));

      case 13:
        retries = parseInt(timeout / 1000, 10);
        context$1$0.next = 16;
        return _regeneratorRuntime.awrap((0, _asyncbox.retryInterval)(retries, 1000, function callee$1$0() {
          var devices, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, deviceArr, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, device;

          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                context$2$0.next = 2;
                return _regeneratorRuntime.awrap(getDevices());

              case 2:
                devices = context$2$0.sent;
                _iteratorNormalCompletion = true;
                _didIteratorError = false;
                _iteratorError = undefined;
                context$2$0.prev = 6;
                _iterator = _getIterator(_lodash2['default'].values(devices));

              case 8:
                if (_iteratorNormalCompletion = (_step = _iterator.next()).done) {
                  context$2$0.next = 43;
                  break;
                }

                deviceArr = _step.value;
                _iteratorNormalCompletion2 = true;
                _didIteratorError2 = false;
                _iteratorError2 = undefined;
                context$2$0.prev = 13;
                _iterator2 = _getIterator(deviceArr);

              case 15:
                if (_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done) {
                  context$2$0.next = 26;
                  break;
                }

                device = _step2.value;

                if (!(device.udid === udid)) {
                  context$2$0.next = 23;
                  break;
                }

                if (!(device.state === 'Creating')) {
                  context$2$0.next = 22;
                  break;
                }

                throw new Error('Device still being created');

              case 22:
                return context$2$0.abrupt('return');

              case 23:
                _iteratorNormalCompletion2 = true;
                context$2$0.next = 15;
                break;

              case 26:
                context$2$0.next = 32;
                break;

              case 28:
                context$2$0.prev = 28;
                context$2$0.t0 = context$2$0['catch'](13);
                _didIteratorError2 = true;
                _iteratorError2 = context$2$0.t0;

              case 32:
                context$2$0.prev = 32;
                context$2$0.prev = 33;

                if (!_iteratorNormalCompletion2 && _iterator2['return']) {
                  _iterator2['return']();
                }

              case 35:
                context$2$0.prev = 35;

                if (!_didIteratorError2) {
                  context$2$0.next = 38;
                  break;
                }

                throw _iteratorError2;

              case 38:
                return context$2$0.finish(35);

              case 39:
                return context$2$0.finish(32);

              case 40:
                _iteratorNormalCompletion = true;
                context$2$0.next = 8;
                break;

              case 43:
                context$2$0.next = 49;
                break;

              case 45:
                context$2$0.prev = 45;
                context$2$0.t1 = context$2$0['catch'](6);
                _didIteratorError = true;
                _iteratorError = context$2$0.t1;

              case 49:
                context$2$0.prev = 49;
                context$2$0.prev = 50;

                if (!_iteratorNormalCompletion && _iterator['return']) {
                  _iterator['return']();
                }

              case 52:
                context$2$0.prev = 52;

                if (!_didIteratorError) {
                  context$2$0.next = 55;
                  break;
                }

                throw _iteratorError;

              case 55:
                return context$2$0.finish(52);

              case 56:
                return context$2$0.finish(49);

              case 57:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this4, [[6, 45, 49, 57], [13, 28, 32, 40], [33,, 35, 39], [50,, 52, 56]]);
        }));

      case 16:
        return context$1$0.abrupt('return', udid);

      case 17:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[1, 8]]);
}

function deleteDevice(udid) {
  return _regeneratorRuntime.async(function deleteDevice$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simExec('delete', 0, [udid]));

      case 2:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function eraseDevice(udid) {
  var timeout = arguments.length <= 1 || arguments[1] === undefined ? 1000 : arguments[1];
  var loopFn, retries;
  return _regeneratorRuntime.async(function eraseDevice$(context$1$0) {
    var _this5 = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        loopFn = function loopFn() {
          return _regeneratorRuntime.async(function loopFn$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                context$2$0.next = 2;
                return _regeneratorRuntime.awrap(simExec('erase', 10000, [udid]));

              case 2:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this5);
        };

        retries = parseInt(timeout / 200, 10);
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap((0, _asyncbox.retryInterval)(retries, 200, loopFn));

      case 4:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

function getDevicesByParsing() {
  var _ref2,
  // get the list of devices
  stdout, deviceSectionRe, matches, match, devices, _iteratorNormalCompletion3, _didIteratorError3, _iteratorError3, _iterator3, _step3, sdk, _iteratorNormalCompletion4, _didIteratorError4, _iteratorError4, _iterator4, _step4, line, lineRe, lineMatch;

  return _regeneratorRuntime.async(function getDevicesByParsing$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(simExec('list', 0, ['devices']));

      case 2:
        _ref2 = context$1$0.sent;
        stdout = _ref2.stdout;
        deviceSectionRe = /-- iOS (.+) --(\n\s{4}.+)*/mg;
        matches = [];
        match = deviceSectionRe.exec(stdout);

        // make an entry for each sdk version
        while (match !== null) {
          matches.push(match);
          match = deviceSectionRe.exec(stdout);
        }
        if (matches.length < 1) {
          log.errorAndThrow('Could not find device section');
        }

        // get all the devices for each sdk
        devices = {};
        _iteratorNormalCompletion3 = true;
        _didIteratorError3 = false;
        _iteratorError3 = undefined;
        context$1$0.prev = 13;
        _iterator3 = _getIterator(matches);

      case 15:
        if (_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done) {
          context$1$0.next = 51;
          break;
        }

        match = _step3.value;
        sdk = match[1];

        devices[sdk] = [];
        // split the full match into lines and remove the first
        _iteratorNormalCompletion4 = true;
        _didIteratorError4 = false;
        _iteratorError4 = undefined;
        context$1$0.prev = 22;
        _iterator4 = _getIterator(match[0].split('\n').slice(1));

      case 24:
        if (_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done) {
          context$1$0.next = 34;
          break;
        }

        line = _step4.value;
        lineRe = /([^\s].+) \((\w+-.+\w+)\) \((\w+\s?\w+)\)/;
        lineMatch = lineRe.exec(line);

        if (!(lineMatch === null)) {
          context$1$0.next = 30;
          break;
        }

        throw new Error('Could not match line: ' + line);

      case 30:
        // save the whole thing as ab object in the list for this sdk

        devices[sdk].push({
          name: lineMatch[1],
          udid: lineMatch[2],
          state: lineMatch[3],
          sdk: sdk
        });

      case 31:
        _iteratorNormalCompletion4 = true;
        context$1$0.next = 24;
        break;

      case 34:
        context$1$0.next = 40;
        break;

      case 36:
        context$1$0.prev = 36;
        context$1$0.t0 = context$1$0['catch'](22);
        _didIteratorError4 = true;
        _iteratorError4 = context$1$0.t0;

      case 40:
        context$1$0.prev = 40;
        context$1$0.prev = 41;

        if (!_iteratorNormalCompletion4 && _iterator4['return']) {
          _iterator4['return']();
        }

      case 43:
        context$1$0.prev = 43;

        if (!_didIteratorError4) {
          context$1$0.next = 46;
          break;
        }

        throw _iteratorError4;

      case 46:
        return context$1$0.finish(43);

      case 47:
        return context$1$0.finish(40);

      case 48:
        _iteratorNormalCompletion3 = true;
        context$1$0.next = 15;
        break;

      case 51:
        context$1$0.next = 57;
        break;

      case 53:
        context$1$0.prev = 53;
        context$1$0.t1 = context$1$0['catch'](13);
        _didIteratorError3 = true;
        _iteratorError3 = context$1$0.t1;

      case 57:
        context$1$0.prev = 57;
        context$1$0.prev = 58;

        if (!_iteratorNormalCompletion3 && _iterator3['return']) {
          _iterator3['return']();
        }

      case 60:
        context$1$0.prev = 60;

        if (!_didIteratorError3) {
          context$1$0.next = 63;
          break;
        }

        throw _iteratorError3;

      case 63:
        return context$1$0.finish(60);

      case 64:
        return context$1$0.finish(57);

      case 65:
        return context$1$0.abrupt('return', devices);

      case 66:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[13, 53, 57, 65], [22, 36, 40, 48], [41,, 43, 47], [58,, 60, 64]]);
}

function getDevices() {
  var forSdk = arguments.length <= 0 || arguments[0] === undefined ? null : arguments[0];

  var devices, _ref3, stdout, _iteratorNormalCompletion5, _didIteratorError5, _iteratorError5, _loop, _iterator5, _step5, _ret;

  return _regeneratorRuntime.async(function getDevices$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        devices = undefined;
        context$1$0.prev = 1;
        context$1$0.next = 4;
        return _regeneratorRuntime.awrap(simExec('list', 0, ['devices', '-j']));

      case 4:
        _ref3 = context$1$0.sent;
        stdout = _ref3.stdout;

        /* JSON should be
         * {
         *   "devices" : {
         *     "iOS <sdk>" : [
         *       {
         *         "state" : "Booted",
         *         "availability" : "(available)",
         *         "name" : "iPhone 6",
         *         "udid" : "75E34140-18E8-4D1A-9F45-AAC735DF75DF"
         *       }
         *     ]
         *   }
         * }
         */
        devices = {};
        _iteratorNormalCompletion5 = true;
        _didIteratorError5 = false;
        _iteratorError5 = undefined;
        context$1$0.prev = 10;

        _loop = function () {
          var _step5$value = _slicedToArray(_step5.value, 2);

          var sdkName = _step5$value[0];
          var entries = _step5$value[1];

          if (sdkName.indexOf('iOS') !== 0) {
            return 'continue';
          }
          var sdk = sdkName.replace('iOS ', '');
          devices[sdk] = entries.map(function (el) {
            delete el.availability;
            return _extends({}, el, { sdk: sdk });
          });
        };

        _iterator5 = _getIterator(_lodash2['default'].toPairs(JSON.parse(stdout).devices));

      case 13:
        if (_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done) {
          context$1$0.next = 20;
          break;
        }

        _ret = _loop();

        if (!(_ret === 'continue')) {
          context$1$0.next = 17;
          break;
        }

        return context$1$0.abrupt('continue', 17);

      case 17:
        _iteratorNormalCompletion5 = true;
        context$1$0.next = 13;
        break;

      case 20:
        context$1$0.next = 26;
        break;

      case 22:
        context$1$0.prev = 22;
        context$1$0.t0 = context$1$0['catch'](10);
        _didIteratorError5 = true;
        _iteratorError5 = context$1$0.t0;

      case 26:
        context$1$0.prev = 26;
        context$1$0.prev = 27;

        if (!_iteratorNormalCompletion5 && _iterator5['return']) {
          _iterator5['return']();
        }

      case 29:
        context$1$0.prev = 29;

        if (!_didIteratorError5) {
          context$1$0.next = 32;
          break;
        }

        throw _iteratorError5;

      case 32:
        return context$1$0.finish(29);

      case 33:
        return context$1$0.finish(26);

      case 34:
        context$1$0.next = 43;
        break;

      case 36:
        context$1$0.prev = 36;
        context$1$0.t1 = context$1$0['catch'](1);

        log.debug('Unable to get JSON device list: ' + context$1$0.t1.message);
        log.debug('Falling back to manually parsing');
        context$1$0.next = 42;
        return _regeneratorRuntime.awrap(getDevicesByParsing());

      case 42:
        devices = context$1$0.sent;

      case 43:
        if (!forSdk) {
          context$1$0.next = 47;
          break;
        }

        if (devices[forSdk]) {
          context$1$0.next = 46;
          break;
        }

        throw new Error('Sdk \'' + forSdk + '\' was not in list of simctl sdks');

      case 46:
        return context$1$0.abrupt('return', devices[forSdk]);

      case 47:
        return context$1$0.abrupt('return', devices);

      case 48:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[1, 36], [10, 22, 26, 34], [27,, 29, 33]]);
}

/**
 * Gets base64 screenshot for device (xcode >= 8.1 only)
 * @param {string} udid 
 */
function getScreenshot(udid) {
  var pathToScreenshotPng, screenshotImg;
  return _regeneratorRuntime.async(function getScreenshot$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(_appiumSupport.tempDir.path({ prefix: 'screenshot-' + udid, suffix: '.png' }));

      case 2:
        pathToScreenshotPng = context$1$0.sent;
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(simExec('io', 0, [udid, 'screenshot', pathToScreenshotPng]));

      case 5:
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(_appiumSupport.fs.readFile(pathToScreenshotPng));

      case 7:
        screenshotImg = context$1$0.sent;
        context$1$0.next = 10;
        return _regeneratorRuntime.awrap(_appiumSupport.fs.rimraf(pathToScreenshotPng));

      case 10:
        return context$1$0.abrupt('return', screenshotImg.toString('base64'));

      case 11:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

exports.installApp = installApp;
exports.removeApp = removeApp;
exports.launch = launch;
exports.spawn = spawn;
exports.spawnSubProcess = spawnSubProcess;
exports.openUrl = openUrl;
exports.terminate = terminate;
exports.shutdown = shutdown;
exports.createDevice = createDevice;
exports.getAppContainer = getAppContainer;
exports.getScreenshot = getScreenshot;
exports.deleteDevice = deleteDevice;
exports.eraseDevice = eraseDevice;
exports.getDevices = getDevices;

// if we don't want to see the errors, just throw and allow the calling
// code do what it wants

// make sure that it gets out of the "Creating" state

// need to retry

// stop looking, we're done

// retry erase with a sleep in between because it's flakey

// expect to get a listing like
// -- iOS 8.1 --
//     iPhone 4s (3CA6E7DD-220E-45E5-B716-1E992B3A429C) (Shutdown)
//     ...
// -- iOS 8.2 --
//     iPhone 4s (A99FFFC3-8E19-4DCF-B585-7D9D46B4C16E) (Shutdown)
//     ...
// so, get the `-- iOS X.X --` line to find the sdk (X.X)
// and the rest of the listing in order to later find the devices

// a line is something like
//    iPhone 4s (A99FFFC3-8E19-4DCF-B585-7D9D46B4C16E) (Shutdown)
// retrieve:
//   iPhone 4s
//   A99FFFC3-8E19-4DCF-B585-7D9D46B4C16E
//   Shutdown
// https://regex101.com/r/lG7mK6/3

// if a `forSdk` was passed in, return only the corresponding list

// otherwise return everything
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW1jdGwuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OzRCQUFpQyxjQUFjOzt3QkFDakIsVUFBVTs7NkJBQ0osZ0JBQWdCOztzQkFDdEMsUUFBUTs7OztBQUd0QixJQUFNLEdBQUcsR0FBRyxzQkFBTyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7O0FBRXZDLFNBQWUsVUFBVSxDQUFFLE9BQWMsRUFBRSxPQUFjO01BQUUsSUFBVSx5REFBRyxFQUFFO01BQUUsR0FBRyx5REFBRyxFQUFFO01BQUUsaUJBQWlCO01BQVMsU0FBUyx5REFBRyxJQUFJOzs7OztBQUU5SCxZQUFJLElBQUksUUFBUSxFQUFFLE9BQU8sNEJBQUssSUFBSSxFQUFDLENBQUM7OztBQUdwQyxXQUFHLEdBQUcsb0JBQUUsUUFBUSxDQUFDLG9CQUFFLE9BQU8sQ0FBQyxHQUFHLEVBQUUsVUFBQyxLQUFLLEVBQUUsR0FBRyxFQUFLO0FBQzlDLG1DQUF1QixHQUFHLENBQUc7U0FDOUIsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQzs7Ozt5Q0FHRixpQkFBaUIsQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLEVBQUMsT0FBTyxFQUFQLE9BQU8sRUFBRSxHQUFHLEVBQUgsR0FBRyxFQUFDLENBQUM7Ozs7Ozs7OztZQUV4RCxTQUFTOzs7Ozs7OztBQUlQLFlBQUksZUFBRSxNQUFNLEVBQUU7QUFDbkIsYUFBRyxDQUFDLGFBQWEsNkJBQTBCLE9BQU8sWUFBTSxlQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBRyxDQUFDO1NBQzVFLE1BQU07QUFDTCxhQUFHLENBQUMsYUFBYSxnQkFBRyxDQUFDO1NBQ3RCOzs7Ozs7O0NBRUo7O0FBRUQsU0FBZSxPQUFPLENBQUUsT0FBYyxFQUFFLE9BQWM7TUFBRSxJQUFVLHlEQUFHLEVBQUU7TUFBRSxHQUFHLHlEQUFHLEVBQUU7TUFBRSxTQUFTLHlEQUFHLElBQUk7Ozs7Ozs7eUNBQ3BGLFVBQVUsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsb0JBQU8sQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFOzs7OztpREFDckQsd0JBQUssQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Ozs7Ozs7Ozs7U0FDNUIsRUFBRSxTQUFTLENBQUM7Ozs7Ozs7Ozs7Q0FDZDs7QUFFRCxTQUFlLGFBQWEsQ0FBRSxPQUFjLEVBQUUsT0FBYztNQUFFLElBQVUseURBQUcsRUFBRTtNQUFFLEdBQUcseURBQUcsRUFBRTs7Ozs7Ozt5Q0FDeEUsVUFBVSxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxvQkFBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Ozs7b0RBQzNELDZCQUFlLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDOzs7Ozs7O1NBQ2hDLENBQUM7Ozs7Ozs7Ozs7Q0FDSDs7QUFFRCxTQUFlLFVBQVUsQ0FBRSxJQUFXLEVBQUUsT0FBYzs7Ozs7eUNBQzlDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDOzs7Ozs7O0NBQzdDOztBQUVELFNBQWUsU0FBUyxDQUFFLElBQVcsRUFBRSxRQUFlOzs7Ozt5Q0FDOUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7Ozs7Ozs7Q0FDaEQ7O0FBRUQsU0FBZSxNQUFNLENBQUUsSUFBVyxFQUFFLFFBQWU7TUFBRSxLQUFTLHlEQUFHLENBQUM7Ozs7Ozs7eUNBQzFELDZCQUFjLEtBQUssRUFBRSxJQUFJLEVBQUU7Ozs7O2lEQUN6QixPQUFPLENBQUMsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQzs7Ozs7OztTQUM3QyxDQUFDOzs7Ozs7O0NBQ0g7O0FBRUQsU0FBZSxLQUFLLENBQUUsSUFBVyxFQUFFLGNBQXFCO01BQUUsR0FBRyx5REFBRyxFQUFFOzs7Ozt5Q0FDbkQsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsY0FBYyxDQUFDLEVBQUUsR0FBRyxDQUFDOzs7Ozs7Ozs7O0NBQzlEOztBQUVELFNBQWUsZUFBZSxDQUFFLElBQVcsRUFBRSxjQUFxQjtNQUFFLEdBQUcseURBQUcsRUFBRTs7Ozs7eUNBQzdELGFBQWEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxFQUFFLEdBQUcsQ0FBQzs7Ozs7Ozs7OztDQUNwRTs7QUFFRCxTQUFlLE9BQU8sQ0FBRSxJQUFXLEVBQUUsR0FBVTs7Ozs7eUNBQ2hDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDOzs7Ozs7Ozs7O0NBQ2hEOztBQUVELFNBQWUsU0FBUyxDQUFFLElBQVcsRUFBRSxRQUFlOzs7Ozt5Q0FDOUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7Ozs7Ozs7Q0FDaEQ7O0FBRUQsU0FBZSxlQUFlLENBQUUsSUFBVyxFQUFFLFFBQWU7TUFBRSxTQUFTLHlEQUFHLElBQUk7O1lBQ3ZFLE1BQU07Ozs7Ozt5Q0FBVSxPQUFPLENBQUMsbUJBQW1CLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxFQUFFLEVBQUUsRUFBRSxTQUFTLENBQUM7Ozs7QUFBaEYsY0FBTSxRQUFOLE1BQU07NENBQ0osQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFBLENBQUUsSUFBSSxFQUFFOzs7Ozs7O0NBQzdCOztBQUVELFNBQWUsUUFBUSxDQUFFLElBQVc7Ozs7O3lDQUM1QixPQUFPLENBQUMsVUFBVSxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDOzs7Ozs7O0NBQ3JDOztBQUVELFNBQWUsWUFBWSxDQUFFLElBQVcsRUFBRSxZQUFtQixFQUN6RCxTQUFnQjtNQUFFLE9BQVcseURBQUcsS0FBSztNQUNuQyxJQUFJLEVBRUYsR0FBRyxFQUdILE1BQU0sRUFTUixPQUFPOzs7Ozs7QUFkUCxZQUFJOzs7eUNBRVUsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFLFNBQVMsQ0FBQyxDQUFDOzs7QUFBakUsV0FBRzs7QUFDUCxZQUFJLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQzs7Ozs7OztBQUVyQixjQUFNLEdBQUcsZUFBSSxPQUFPOztBQUN4QixZQUFJLGVBQUksTUFBTSxFQUFFO0FBQ2QsZ0JBQU0sR0FBRyxlQUFJLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUM1QjtBQUNELFdBQUcsQ0FBQyxhQUFhLENBQUMsNENBQXlDLElBQUksbUNBQ2pDLFlBQVksNEJBQXFCLFNBQVMsc0JBQWUsTUFBTSxRQUFHLENBQUMsQ0FBQzs7O0FBSWhHLGVBQU8sR0FBRyxRQUFRLENBQUMsT0FBTyxHQUFHLElBQUksRUFBRSxFQUFFLENBQUM7O3lDQUNwQyw2QkFBYyxPQUFPLEVBQUUsSUFBSSxFQUFFO2NBQzdCLE9BQU8sa0ZBQ0YsU0FBUyx1RkFDUCxNQUFNOzs7Ozs7aURBRkcsVUFBVSxFQUFFOzs7QUFBNUIsdUJBQU87Ozs7O3lDQUNXLG9CQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUM7Ozs7Ozs7O0FBQTlCLHlCQUFTOzs7OzswQ0FDRyxTQUFTOzs7Ozs7OztBQUFuQixzQkFBTTs7c0JBQ1QsTUFBTSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUE7Ozs7O3NCQUNsQixNQUFNLENBQUMsS0FBSyxLQUFLLFVBQVUsQ0FBQTs7Ozs7c0JBRXZCLElBQUksS0FBSyxDQUFDLDRCQUE0QixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1NBUXRELENBQUM7Ozs0Q0FFSyxJQUFJOzs7Ozs7O0NBQ1o7O0FBRUQsU0FBZSxZQUFZLENBQUUsSUFBVzs7Ozs7eUNBQ2hDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7Ozs7Ozs7Q0FDbkM7O0FBRUQsU0FBZSxXQUFXLENBQUUsSUFBVztNQUFFLE9BQVcseURBQUcsSUFBSTtNQUNyRCxNQUFlLEVBSWYsT0FBTzs7Ozs7O0FBSlAsY0FBZSxHQUFHLFNBQWxCLE1BQWU7Ozs7O2lEQUNYLE9BQU8sQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7Ozs7Ozs7U0FDdEM7O0FBRUcsZUFBTyxHQUFHLFFBQVEsQ0FBQyxPQUFPLEdBQUcsR0FBRyxFQUFFLEVBQUUsQ0FBQzs7eUNBQ25DLDZCQUFjLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxDQUFDOzs7Ozs7O0NBQzFDOztBQUVELFNBQWUsbUJBQW1COzs7QUFFM0IsUUFBTSxFQVdQLGVBQXNCLEVBQ3RCLE9BQWEsRUFDYixLQUFZLEVBWVosT0FBYyx1RkFFWixHQUFVLHVGQUdMLElBQVcsRUFPZCxNQUFhLEVBQ2IsU0FBZ0I7Ozs7Ozt5Q0F0Q0gsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQzs7OztBQUEvQyxjQUFNLFNBQU4sTUFBTTtBQVdQLHVCQUFzQixHQUFHLDhCQUE4QjtBQUN2RCxlQUFhLEdBQUcsRUFBRTtBQUNsQixhQUFZLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7OztBQUcvQyxlQUFPLEtBQUssS0FBSyxJQUFJLEVBQUU7QUFDckIsaUJBQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDcEIsZUFBSyxHQUFHLGVBQWUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDdEM7QUFDRCxZQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQ3RCLGFBQUcsQ0FBQyxhQUFhLENBQUMsK0JBQStCLENBQUMsQ0FBQztTQUNwRDs7O0FBR0csZUFBYyxHQUFHLEVBQUU7Ozs7O2tDQUNULE9BQU87Ozs7Ozs7O0FBQWhCLGFBQUs7QUFDSixXQUFVLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQzs7QUFDekIsZUFBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQzs7Ozs7O2tDQUVNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzs7Ozs7Ozs7QUFBNUMsWUFBVztBQU9kLGNBQWEsR0FBRywyQ0FBMkM7QUFDM0QsaUJBQWdCLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7O2NBQ3BDLFNBQVMsS0FBSyxJQUFJLENBQUE7Ozs7O2NBQ2QsSUFBSSxLQUFLLDRCQUEwQixJQUFJLENBQUc7Ozs7O0FBSWxELGVBQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFDaEIsY0FBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDbEIsY0FBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDbEIsZUFBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDbkIsYUFBRyxFQUFILEdBQUc7U0FDSixDQUFDLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs0Q0FJQSxPQUFPOzs7Ozs7O0NBQ2Y7O0FBRUQsU0FBZSxVQUFVO01BQUUsTUFBYSx5REFBRyxJQUFJOztNQUN6QyxPQUFjLFNBRVgsTUFBTTs7Ozs7QUFGVCxlQUFjOzs7eUNBRUssT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7Ozs7QUFBckQsY0FBTSxTQUFOLE1BQU07Ozs7Ozs7Ozs7Ozs7Ozs7QUFlWCxlQUFPLEdBQUcsRUFBRSxDQUFDOzs7Ozs7Ozs7Y0FDSCxPQUFPO2NBQUUsT0FBTzs7QUFDeEIsY0FBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRTtBQUNoQyw4QkFBUztXQUNWO0FBQ0QsY0FBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDdEMsaUJBQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQUMsRUFBRSxFQUFLO0FBQ2pDLG1CQUFPLEVBQUUsQ0FBQyxZQUFZLENBQUM7QUFDdkIsZ0NBQVcsRUFBRSxJQUFFLEdBQUcsRUFBSCxHQUFHLElBQUU7V0FDckIsQ0FBQyxDQUFDOzs7a0NBUjJCLG9CQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVdyRSxXQUFHLENBQUMsS0FBSyxzQ0FBb0MsZUFBSSxPQUFPLENBQUcsQ0FBQztBQUM1RCxXQUFHLENBQUMsS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7O3lDQUM5QixtQkFBbUIsRUFBRTs7O0FBQXJDLGVBQU87OzthQUlMLE1BQU07Ozs7O1lBQ0gsT0FBTyxDQUFDLE1BQU0sQ0FBQzs7Ozs7Y0FDWixJQUFJLEtBQUssWUFBUyxNQUFNLHVDQUFtQzs7OzRDQUU1RCxPQUFPLENBQUMsTUFBTSxDQUFDOzs7NENBSWpCLE9BQU87Ozs7Ozs7Q0FDZjs7Ozs7O0FBTUQsU0FBZSxhQUFhLENBQUUsSUFBVztNQUNuQyxtQkFBbUIsRUFFbkIsYUFBYTs7Ozs7eUNBRmUsdUJBQVEsSUFBSSxDQUFDLEVBQUMsTUFBTSxrQkFBZ0IsSUFBSSxBQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBQyxDQUFDOzs7QUFBeEYsMkJBQW1COzt5Q0FDakIsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFLG1CQUFtQixDQUFDLENBQUM7Ozs7eUNBQ3ZDLGtCQUFHLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQzs7O0FBQXRELHFCQUFhOzt5Q0FDWCxrQkFBRyxNQUFNLENBQUMsbUJBQW1CLENBQUM7Ozs0Q0FDN0IsYUFBYSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUM7Ozs7Ozs7Q0FDeEM7O1FBRVEsVUFBVSxHQUFWLFVBQVU7UUFBRSxTQUFTLEdBQVQsU0FBUztRQUFFLE1BQU0sR0FBTixNQUFNO1FBQUUsS0FBSyxHQUFMLEtBQUs7UUFBRSxlQUFlLEdBQWYsZUFBZTtRQUFFLE9BQU8sR0FBUCxPQUFPO1FBQUUsU0FBUyxHQUFULFNBQVM7UUFBRSxRQUFRLEdBQVIsUUFBUTtRQUFFLFlBQVksR0FBWixZQUFZO1FBQ2pHLGVBQWUsR0FBZixlQUFlO1FBQUUsYUFBYSxHQUFiLGFBQWE7UUFBRSxZQUFZLEdBQVosWUFBWTtRQUFFLFdBQVcsR0FBWCxXQUFXO1FBQUUsVUFBVSxHQUFWLFVBQVUiLCJmaWxlIjoibGliL3NpbWN0bC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4ZWMsIFN1YlByb2Nlc3MgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHsgcmV0cnlJbnRlcnZhbCB9IGZyb20gJ2FzeW5jYm94JztcbmltcG9ydCB7IGxvZ2dlciwgZnMsIHRlbXBEaXIgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5cbmNvbnN0IGxvZyA9IGxvZ2dlci5nZXRMb2dnZXIoJ3NpbWN0bCcpO1xuXG5hc3luYyBmdW5jdGlvbiBzaW1Db21tYW5kIChjb21tYW5kOnN0cmluZywgdGltZW91dDpudW1iZXIsIGFyZ3M6QXJyYXkgPSBbXSwgZW52ID0ge30sIGV4ZWN1dGluZ0Z1bmN0aW9uID0gZXhlYywgbG9nRXJyb3JzID0gdHJ1ZSkge1xuICAvLyBydW4gYSBwYXJ0aWN1bGFyIHNpbWN0bCBjb21tYW5kXG4gIGFyZ3MgPSBbJ3NpbWN0bCcsIGNvbW1hbmQsIC4uLmFyZ3NdO1xuICAvLyBQcmVmaXggYWxsIHBhc3NlZCBpbiBlbnZpcm9ubWVudCB2YXJpYWJsZXMgd2l0aCAnU0lNQ1RMX0NISUxEXycsIHNpbWN0bFxuICAvLyB3aWxsIHRoZW4gcGFzcyB0aGVzZSB0byB0aGUgY2hpbGQgKHNwYXduZWQpIHByb2Nlc3MuXG4gIGVudiA9IF8uZGVmYXVsdHMoXy5tYXBLZXlzKGVudiwgKHZhbHVlLCBrZXkpID0+IHtcbiAgICByZXR1cm4gYFNJTUNUTF9DSElMRF8ke2tleX1gO1xuICB9KSwgcHJvY2Vzcy5lbnYpO1xuXG4gIHRyeSB7XG4gICAgcmV0dXJuIGF3YWl0IGV4ZWN1dGluZ0Z1bmN0aW9uKCd4Y3J1bicsIGFyZ3MsIHt0aW1lb3V0LCBlbnZ9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghbG9nRXJyb3JzKSB7XG4gICAgICAvLyBpZiB3ZSBkb24ndCB3YW50IHRvIHNlZSB0aGUgZXJyb3JzLCBqdXN0IHRocm93IGFuZCBhbGxvdyB0aGUgY2FsbGluZ1xuICAgICAgLy8gY29kZSBkbyB3aGF0IGl0IHdhbnRzXG4gICAgICB0aHJvdyBlO1xuICAgIH0gZWxzZSBpZiAoZS5zdGRlcnIpIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBzaW1jdGwgZXJyb3IgcnVubmluZyAnJHtjb21tYW5kfSc6ICR7ZS5zdGRlcnIudHJpbSgpfWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhlKTtcbiAgICB9XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gc2ltRXhlYyAoY29tbWFuZDpzdHJpbmcsIHRpbWVvdXQ6bnVtYmVyLCBhcmdzOkFycmF5ID0gW10sIGVudiA9IHt9LCBsb2dFcnJvcnMgPSB0cnVlKSB7XG4gIHJldHVybiBhd2FpdCBzaW1Db21tYW5kKGNvbW1hbmQsIHRpbWVvdXQsIGFyZ3MsIGVudiwgYXN5bmMgKGMsIGEsIG9iKSA9PiB7XG4gICAgcmV0dXJuIGF3YWl0IGV4ZWMoYywgYSwgb2IpO1xuICB9LCBsb2dFcnJvcnMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzaW1TdWJQcm9jZXNzIChjb21tYW5kOnN0cmluZywgdGltZW91dDpudW1iZXIsIGFyZ3M6QXJyYXkgPSBbXSwgZW52ID0ge30pIHtcbiAgcmV0dXJuIGF3YWl0IHNpbUNvbW1hbmQoY29tbWFuZCwgdGltZW91dCwgYXJncywgZW52LCBhc3luYyAoYywgYSwgb2IpID0+IHtcbiAgICByZXR1cm4gbmV3IFN1YlByb2Nlc3MoYywgYSwgb2IpO1xuICB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gaW5zdGFsbEFwcCAodWRpZDpzdHJpbmcsIGFwcFBhdGg6c3RyaW5nKTp2b2lkIHtcbiAgYXdhaXQgc2ltRXhlYygnaW5zdGFsbCcsIDAsIFt1ZGlkLCBhcHBQYXRoXSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlbW92ZUFwcCAodWRpZDpzdHJpbmcsIGJ1bmRsZUlkOnN0cmluZyk6dm9pZCB7XG4gIGF3YWl0IHNpbUV4ZWMoJ3VuaW5zdGFsbCcsIDAsIFt1ZGlkLCBidW5kbGVJZF0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBsYXVuY2ggKHVkaWQ6c3RyaW5nLCBidW5kbGVJZDpzdHJpbmcsIHRyaWVzOmludCA9IDUpOnZvaWQge1xuICBhd2FpdCByZXRyeUludGVydmFsKHRyaWVzLCAxMDAwLCBhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgc2ltRXhlYygnbGF1bmNoJywgMCwgW3VkaWQsIGJ1bmRsZUlkXSk7XG4gIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzcGF3biAodWRpZDpzdHJpbmcsIGV4ZWN1dGFibGVQYXRoOnN0cmluZywgZW52ID0ge30pOnZvaWQge1xuICByZXR1cm4gYXdhaXQgc2ltRXhlYygnc3Bhd24nLCAwLCBbdWRpZCwgZXhlY3V0YWJsZVBhdGhdLCBlbnYpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzcGF3blN1YlByb2Nlc3MgKHVkaWQ6c3RyaW5nLCBleGVjdXRhYmxlUGF0aDpzdHJpbmcsIGVudiA9IHt9KTp2b2lkIHtcbiAgcmV0dXJuIGF3YWl0IHNpbVN1YlByb2Nlc3MoJ3NwYXduJywgMCwgW3VkaWQsIGV4ZWN1dGFibGVQYXRoXSwgZW52KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gb3BlblVybCAodWRpZDpzdHJpbmcsIHVybDpzdHJpbmcpOnZvaWQge1xuICByZXR1cm4gYXdhaXQgc2ltRXhlYygnb3BlbnVybCcsIDAsIFt1ZGlkLCB1cmxdKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdGVybWluYXRlICh1ZGlkOnN0cmluZywgYnVuZGxlSWQ6c3RyaW5nKTp2b2lkIHtcbiAgYXdhaXQgc2ltRXhlYygndGVybWluYXRlJywgMCwgW3VkaWQsIGJ1bmRsZUlkXSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEFwcENvbnRhaW5lciAodWRpZDpzdHJpbmcsIGJ1bmRsZUlkOnN0cmluZywgbG9nRXJyb3JzID0gdHJ1ZSkge1xuICBsZXQge3N0ZG91dH0gPSBhd2FpdCBzaW1FeGVjKCdnZXRfYXBwX2NvbnRhaW5lcicsIDAsIFt1ZGlkLCBidW5kbGVJZF0sIHt9LCBsb2dFcnJvcnMpO1xuICByZXR1cm4gKHN0ZG91dCB8fCAnJykudHJpbSgpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzaHV0ZG93biAodWRpZDpzdHJpbmcpOnZvaWQge1xuICBhd2FpdCBzaW1FeGVjKCdzaHV0ZG93bicsIDAsIFt1ZGlkXSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZURldmljZSAobmFtZTpzdHJpbmcsIGRldmljZVR5cGVJZDpzdHJpbmcsXG4gICAgcnVudGltZUlkOnN0cmluZywgdGltZW91dDppbnQgPSAxMDAwMCk6dm9pZCB7XG4gIGxldCB1ZGlkO1xuICB0cnkge1xuICAgIGxldCBvdXQgPSBhd2FpdCBzaW1FeGVjKCdjcmVhdGUnLCAwLCBbbmFtZSwgZGV2aWNlVHlwZUlkLCBydW50aW1lSWRdKTtcbiAgICB1ZGlkID0gb3V0LnN0ZG91dC50cmltKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxldCByZWFzb24gPSBlcnIubWVzc2FnZTtcbiAgICBpZiAoZXJyLnN0ZGVycikge1xuICAgICAgcmVhc29uID0gZXJyLnN0ZGVyci50cmltKCk7XG4gICAgfVxuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgY3JlYXRlIHNpbXVsYXRvciB3aXRoIG5hbWUgJyR7bmFtZX0nLCBkZXZpY2UgYCArXG4gICAgICAgICAgICAgICAgICAgICAgYHR5cGUgaWQgJyR7ZGV2aWNlVHlwZUlkfScgYW5kIHJ1bnRpbWUgaWQgJyR7cnVudGltZUlkfScuIFJlYXNvbjogJyR7cmVhc29ufSdgKTtcbiAgfVxuXG4gIC8vIG1ha2Ugc3VyZSB0aGF0IGl0IGdldHMgb3V0IG9mIHRoZSBcIkNyZWF0aW5nXCIgc3RhdGVcbiAgbGV0IHJldHJpZXMgPSBwYXJzZUludCh0aW1lb3V0IC8gMTAwMCwgMTApO1xuICBhd2FpdCByZXRyeUludGVydmFsKHJldHJpZXMsIDEwMDAsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZGV2aWNlcyA9IGF3YWl0IGdldERldmljZXMoKTtcbiAgICBmb3IgKGxldCBkZXZpY2VBcnIgb2YgXy52YWx1ZXMoZGV2aWNlcykpIHtcbiAgICAgIGZvciAobGV0IGRldmljZSBvZiBkZXZpY2VBcnIpIHtcbiAgICAgICAgaWYgKGRldmljZS51ZGlkID09PSB1ZGlkKSB7XG4gICAgICAgICAgaWYgKGRldmljZS5zdGF0ZSA9PT0gJ0NyZWF0aW5nJykge1xuICAgICAgICAgICAgLy8gbmVlZCB0byByZXRyeVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEZXZpY2Ugc3RpbGwgYmVpbmcgY3JlYXRlZCcpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBzdG9wIGxvb2tpbmcsIHdlJ3JlIGRvbmVcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiB1ZGlkO1xufVxuXG5hc3luYyBmdW5jdGlvbiBkZWxldGVEZXZpY2UgKHVkaWQ6c3RyaW5nKTp2b2lkIHtcbiAgYXdhaXQgc2ltRXhlYygnZGVsZXRlJywgMCwgW3VkaWRdKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZXJhc2VEZXZpY2UgKHVkaWQ6c3RyaW5nLCB0aW1lb3V0OmludCA9IDEwMDApOnZvaWQge1xuICBsZXQgbG9vcEZuOkZ1bmN0aW9uID0gYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IHNpbUV4ZWMoJ2VyYXNlJywgMTAwMDAsIFt1ZGlkXSk7XG4gIH07XG4gIC8vIHJldHJ5IGVyYXNlIHdpdGggYSBzbGVlcCBpbiBiZXR3ZWVuIGJlY2F1c2UgaXQncyBmbGFrZXlcbiAgbGV0IHJldHJpZXMgPSBwYXJzZUludCh0aW1lb3V0IC8gMjAwLCAxMCk7XG4gIGF3YWl0IHJldHJ5SW50ZXJ2YWwocmV0cmllcywgMjAwLCBsb29wRm4pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXREZXZpY2VzQnlQYXJzaW5nICgpOk9iamVjdCB7XG4gIC8vIGdldCB0aGUgbGlzdCBvZiBkZXZpY2VzXG4gIGxldCB7c3Rkb3V0fSA9IGF3YWl0IHNpbUV4ZWMoJ2xpc3QnLCAwLCBbJ2RldmljZXMnXSk7XG5cbiAgLy8gZXhwZWN0IHRvIGdldCBhIGxpc3RpbmcgbGlrZVxuICAvLyAtLSBpT1MgOC4xIC0tXG4gIC8vICAgICBpUGhvbmUgNHMgKDNDQTZFN0RELTIyMEUtNDVFNS1CNzE2LTFFOTkyQjNBNDI5QykgKFNodXRkb3duKVxuICAvLyAgICAgLi4uXG4gIC8vIC0tIGlPUyA4LjIgLS1cbiAgLy8gICAgIGlQaG9uZSA0cyAoQTk5RkZGQzMtOEUxOS00RENGLUI1ODUtN0Q5RDQ2QjRDMTZFKSAoU2h1dGRvd24pXG4gIC8vICAgICAuLi5cbiAgLy8gc28sIGdldCB0aGUgYC0tIGlPUyBYLlggLS1gIGxpbmUgdG8gZmluZCB0aGUgc2RrIChYLlgpXG4gIC8vIGFuZCB0aGUgcmVzdCBvZiB0aGUgbGlzdGluZyBpbiBvcmRlciB0byBsYXRlciBmaW5kIHRoZSBkZXZpY2VzXG4gIGxldCBkZXZpY2VTZWN0aW9uUmU6UmVnRXhwID0gLy0tIGlPUyAoLispIC0tKFxcblxcc3s0fS4rKSovbWc7XG4gIGxldCBtYXRjaGVzOkFycmF5ID0gW107XG4gIGxldCBtYXRjaDpPYmplY3QgPSBkZXZpY2VTZWN0aW9uUmUuZXhlYyhzdGRvdXQpO1xuXG4gIC8vIG1ha2UgYW4gZW50cnkgZm9yIGVhY2ggc2RrIHZlcnNpb25cbiAgd2hpbGUgKG1hdGNoICE9PSBudWxsKSB7XG4gICAgbWF0Y2hlcy5wdXNoKG1hdGNoKTtcbiAgICBtYXRjaCA9IGRldmljZVNlY3Rpb25SZS5leGVjKHN0ZG91dCk7XG4gIH1cbiAgaWYgKG1hdGNoZXMubGVuZ3RoIDwgMSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KCdDb3VsZCBub3QgZmluZCBkZXZpY2Ugc2VjdGlvbicpO1xuICB9XG5cbiAgLy8gZ2V0IGFsbCB0aGUgZGV2aWNlcyBmb3IgZWFjaCBzZGtcbiAgbGV0IGRldmljZXM6T2JqZWN0ID0ge307XG4gIGZvciAobWF0Y2ggb2YgbWF0Y2hlcykge1xuICAgIGxldCBzZGs6c3RyaW5nID0gbWF0Y2hbMV07XG4gICAgZGV2aWNlc1tzZGtdID0gW107XG4gICAgLy8gc3BsaXQgdGhlIGZ1bGwgbWF0Y2ggaW50byBsaW5lcyBhbmQgcmVtb3ZlIHRoZSBmaXJzdFxuICAgIGZvciAobGV0IGxpbmU6c3RyaW5nIG9mIG1hdGNoWzBdLnNwbGl0KCdcXG4nKS5zbGljZSgxKSkge1xuICAgICAgLy8gYSBsaW5lIGlzIHNvbWV0aGluZyBsaWtlXG4gICAgICAvLyAgICBpUGhvbmUgNHMgKEE5OUZGRkMzLThFMTktNERDRi1CNTg1LTdEOUQ0NkI0QzE2RSkgKFNodXRkb3duKVxuICAgICAgLy8gcmV0cmlldmU6XG4gICAgICAvLyAgIGlQaG9uZSA0c1xuICAgICAgLy8gICBBOTlGRkZDMy04RTE5LTREQ0YtQjU4NS03RDlENDZCNEMxNkVcbiAgICAgIC8vICAgU2h1dGRvd25cbiAgICAgIGxldCBsaW5lUmU6UmVnRXhwID0gLyhbXlxcc10uKykgXFwoKFxcdystLitcXHcrKVxcKSBcXCgoXFx3K1xccz9cXHcrKVxcKS87IC8vIGh0dHBzOi8vcmVnZXgxMDEuY29tL3IvbEc3bUs2LzNcbiAgICAgIGxldCBsaW5lTWF0Y2g6T2JqZWN0ID0gbGluZVJlLmV4ZWMobGluZSk7XG4gICAgICBpZiAobGluZU1hdGNoID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IG1hdGNoIGxpbmU6ICR7bGluZX1gKTtcbiAgICAgIH1cbiAgICAgIC8vIHNhdmUgdGhlIHdob2xlIHRoaW5nIGFzIGFiIG9iamVjdCBpbiB0aGUgbGlzdCBmb3IgdGhpcyBzZGtcblxuICAgICAgZGV2aWNlc1tzZGtdLnB1c2goe1xuICAgICAgICBuYW1lOiBsaW5lTWF0Y2hbMV0sXG4gICAgICAgIHVkaWQ6IGxpbmVNYXRjaFsyXSxcbiAgICAgICAgc3RhdGU6IGxpbmVNYXRjaFszXSxcbiAgICAgICAgc2RrLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGRldmljZXM7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldERldmljZXMgKGZvclNkazpzdHJpbmcgPSBudWxsKTpPYmplY3Qge1xuICBsZXQgZGV2aWNlczpPYmplY3Q7XG4gIHRyeSB7XG4gICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgc2ltRXhlYygnbGlzdCcsIDAsIFsnZGV2aWNlcycsICctaiddKTtcbiAgICAvKiBKU09OIHNob3VsZCBiZVxuICAgICAqIHtcbiAgICAgKiAgIFwiZGV2aWNlc1wiIDoge1xuICAgICAqICAgICBcImlPUyA8c2RrPlwiIDogW1xuICAgICAqICAgICAgIHtcbiAgICAgKiAgICAgICAgIFwic3RhdGVcIiA6IFwiQm9vdGVkXCIsXG4gICAgICogICAgICAgICBcImF2YWlsYWJpbGl0eVwiIDogXCIoYXZhaWxhYmxlKVwiLFxuICAgICAqICAgICAgICAgXCJuYW1lXCIgOiBcImlQaG9uZSA2XCIsXG4gICAgICogICAgICAgICBcInVkaWRcIiA6IFwiNzVFMzQxNDAtMThFOC00RDFBLTlGNDUtQUFDNzM1REY3NURGXCJcbiAgICAgKiAgICAgICB9XG4gICAgICogICAgIF1cbiAgICAgKiAgIH1cbiAgICAgKiB9XG4gICAgICovXG4gICAgZGV2aWNlcyA9IHt9O1xuICAgIGZvciAobGV0IFtzZGtOYW1lLCBlbnRyaWVzXSAgb2YgXy50b1BhaXJzKEpTT04ucGFyc2Uoc3Rkb3V0KS5kZXZpY2VzKSkge1xuICAgICAgaWYgKHNka05hbWUuaW5kZXhPZignaU9TJykgIT09IDApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBsZXQgc2RrID0gc2RrTmFtZS5yZXBsYWNlKCdpT1MgJywgJycpO1xuICAgICAgZGV2aWNlc1tzZGtdID0gZW50cmllcy5tYXAoKGVsKSA9PiB7XG4gICAgICAgIGRlbGV0ZSBlbC5hdmFpbGFiaWxpdHk7XG4gICAgICAgIHJldHVybiB7Li4uZWwsIHNka307XG4gICAgICB9KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5kZWJ1ZyhgVW5hYmxlIHRvIGdldCBKU09OIGRldmljZSBsaXN0OiAke2Vyci5tZXNzYWdlfWApO1xuICAgIGxvZy5kZWJ1ZygnRmFsbGluZyBiYWNrIHRvIG1hbnVhbGx5IHBhcnNpbmcnKTtcbiAgICBkZXZpY2VzID0gYXdhaXQgZ2V0RGV2aWNlc0J5UGFyc2luZygpO1xuICB9XG5cbiAgLy8gaWYgYSBgZm9yU2RrYCB3YXMgcGFzc2VkIGluLCByZXR1cm4gb25seSB0aGUgY29ycmVzcG9uZGluZyBsaXN0XG4gIGlmIChmb3JTZGspIHtcbiAgICBpZiAoIWRldmljZXNbZm9yU2RrXSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBTZGsgJyR7Zm9yU2RrfScgd2FzIG5vdCBpbiBsaXN0IG9mIHNpbWN0bCBzZGtzYCk7XG4gICAgfVxuICAgIHJldHVybiBkZXZpY2VzW2ZvclNka107XG4gIH1cblxuICAvLyBvdGhlcndpc2UgcmV0dXJuIGV2ZXJ5dGhpbmdcbiAgcmV0dXJuIGRldmljZXM7XG59XG5cbi8qKlxuICogR2V0cyBiYXNlNjQgc2NyZWVuc2hvdCBmb3IgZGV2aWNlICh4Y29kZSA+PSA4LjEgb25seSlcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRTY3JlZW5zaG90ICh1ZGlkOnN0cmluZyk6c3RyaW5nIHtcbiAgbGV0IHBhdGhUb1NjcmVlbnNob3RQbmcgPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe3ByZWZpeDogYHNjcmVlbnNob3QtJHt1ZGlkfWAsIHN1ZmZpeDogJy5wbmcnfSk7XG4gIGF3YWl0IHNpbUV4ZWMoJ2lvJywgMCwgW3VkaWQsICdzY3JlZW5zaG90JywgcGF0aFRvU2NyZWVuc2hvdFBuZ10pO1xuICBsZXQgc2NyZWVuc2hvdEltZyA9IGF3YWl0IGZzLnJlYWRGaWxlKHBhdGhUb1NjcmVlbnNob3RQbmcpO1xuICBhd2FpdCBmcy5yaW1yYWYocGF0aFRvU2NyZWVuc2hvdFBuZyk7XG4gIHJldHVybiBzY3JlZW5zaG90SW1nLnRvU3RyaW5nKCdiYXNlNjQnKTtcbn1cblxuZXhwb3J0IHsgaW5zdGFsbEFwcCwgcmVtb3ZlQXBwLCBsYXVuY2gsIHNwYXduLCBzcGF3blN1YlByb2Nlc3MsIG9wZW5VcmwsIHRlcm1pbmF0ZSwgc2h1dGRvd24sIGNyZWF0ZURldmljZSxcbiAgICAgICAgIGdldEFwcENvbnRhaW5lciwgZ2V0U2NyZWVuc2hvdCwgZGVsZXRlRGV2aWNlLCBlcmFzZURldmljZSwgZ2V0RGV2aWNlcyB9O1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLiJ9
