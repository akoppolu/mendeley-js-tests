'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _Object$assign = require('babel-runtime/core-js/object/assign')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _appiumBaseDriver = require('appium-base-driver');

var commands = {},
    helpers = {},
    extensions = {};

commands.getAlertText = function callee$0$0() {
  var method, endpoint, _alert, text;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.prev = 0;
        method = 'GET';
        endpoint = '/alert/text';
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, method));

      case 5:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 8:
        context$1$0.prev = 8;
        context$1$0.t0 = context$1$0['catch'](0);

        if (this.isWebContext()) {
          context$1$0.next = 12;
          break;
        }

        throw context$1$0.t0;

      case 12:
        context$1$0.next = 14;
        return _regeneratorRuntime.awrap(this.getAlert());

      case 14:
        _alert = context$1$0.sent;
        context$1$0.next = 17;
        return _regeneratorRuntime.awrap(_alert.getText());

      case 17:
        text = context$1$0.sent;
        return context$1$0.abrupt('return', text);

      case 19:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[0, 8]]);
};

// TODO: WDA does not currently support this natively
commands.setAlertText = function callee$0$0(text) {
  var method, endpoint, _alert2;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        if (!Array.isArray(text)) {
          text = text.split('');
        }
        context$1$0.prev = 1;
        method = 'POST';
        endpoint = '/alert/text';
        context$1$0.next = 6;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, method, text));

      case 6:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 9:
        context$1$0.prev = 9;
        context$1$0.t0 = context$1$0['catch'](1);

        if (this.isWebContext()) {
          context$1$0.next = 13;
          break;
        }

        throw context$1$0.t0;

      case 13:
        context$1$0.next = 15;
        return _regeneratorRuntime.awrap(this.getAlert());

      case 15:
        _alert2 = context$1$0.sent;
        context$1$0.next = 18;
        return _regeneratorRuntime.awrap(_alert2.setText(text));

      case 18:
        return context$1$0.abrupt('return');

      case 19:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[1, 9]]);
};

commands.postAcceptAlert = function callee$0$0() {
  var opts = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

  var method, endpoint, params, _alert3;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.prev = 0;
        method = 'POST';
        endpoint = '/alert/accept';
        params = {};

        if (opts.buttonLabel) {
          params.name = opts.buttonLabel;
        }
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, method, params));

      case 7:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 10:
        context$1$0.prev = 10;
        context$1$0.t0 = context$1$0['catch'](0);

        if (this.isWebContext()) {
          context$1$0.next = 14;
          break;
        }

        throw context$1$0.t0;

      case 14:
        context$1$0.next = 16;
        return _regeneratorRuntime.awrap(this.getAlert());

      case 16:
        _alert3 = context$1$0.sent;

        if (!_alert3.close) {
          context$1$0.next = 22;
          break;
        }

        context$1$0.next = 20;
        return _regeneratorRuntime.awrap(_alert3.close());

      case 20:
        context$1$0.next = 24;
        break;

      case 22:
        context$1$0.next = 24;
        return _regeneratorRuntime.awrap(_alert3.ok());

      case 24:
        return context$1$0.abrupt('return');

      case 25:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[0, 10]]);
};

commands.postDismissAlert = function callee$0$0() {
  var opts = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

  var method, endpoint, params, _alert4;

  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.prev = 0;
        method = 'POST';
        endpoint = '/alert/dismiss';
        params = {};

        if (opts.buttonLabel) {
          params.name = opts.buttonLabel;
        }
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.proxyCommand(endpoint, method, params));

      case 7:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 10:
        context$1$0.prev = 10;
        context$1$0.t0 = context$1$0['catch'](0);

        if (this.isWebContext()) {
          context$1$0.next = 14;
          break;
        }

        throw context$1$0.t0;

      case 14:
        context$1$0.next = 16;
        return _regeneratorRuntime.awrap(this.getAlert());

      case 16:
        _alert4 = context$1$0.sent;

        if (!_alert4.close) {
          context$1$0.next = 22;
          break;
        }

        context$1$0.next = 20;
        return _regeneratorRuntime.awrap(_alert4.close());

      case 20:
        context$1$0.next = 24;
        break;

      case 22:
        context$1$0.next = 24;
        return _regeneratorRuntime.awrap(_alert4.cancel());

      case 24:
        return context$1$0.abrupt('return');

      case 25:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this, [[0, 10]]);
};

commands.getAlertButtons = function callee$0$0() {
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.proxyCommand('/wda/alert/buttons', 'GET'));

      case 2:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 3:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

commands.mobileHandleAlert = function callee$0$0() {
  var opts = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.t0 = opts.action;
        context$1$0.next = context$1$0.t0 === 'accept' ? 3 : context$1$0.t0 === 'dismiss' ? 6 : context$1$0.t0 === 'getButtons' ? 9 : 12;
        break;

      case 3:
        context$1$0.next = 5;
        return _regeneratorRuntime.awrap(this.postAcceptAlert(opts));

      case 5:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 6:
        context$1$0.next = 8;
        return _regeneratorRuntime.awrap(this.postDismissAlert(opts));

      case 8:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 9:
        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(this.getAlertButtons());

      case 11:
        return context$1$0.abrupt('return', context$1$0.sent);

      case 12:
        throw new Error('The \'action\' value should be either \'accept\', \'dismiss\' or \'getButtons\'. ' + ('\'' + opts.action + '\' is provided instead.'));

      case 13:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

helpers.getAlert = function callee$0$0() {
  var possibleAlert, possibleAlertButtons, assertButtonName, alert;
  return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
    var _this = this;

    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.next = 2;
        return _regeneratorRuntime.awrap(this.findNativeElementOrElements('class name', 'XCUIElementTypeScrollView', true));

      case 2:
        possibleAlert = context$1$0.sent;

        if (!(possibleAlert.length !== 1)) {
          context$1$0.next = 5;
          break;
        }

        throw new _appiumBaseDriver.errors.NoAlertOpenError();

      case 5:
        context$1$0.next = 7;
        return _regeneratorRuntime.awrap(this.findNativeElementOrElements('class name', 'XCUIElementTypeButton', true, possibleAlert[0].ELEMENT));

      case 7:
        possibleAlertButtons = context$1$0.sent;

        if (!(possibleAlertButtons.length < 1 || possibleAlertButtons.length > 2)) {
          context$1$0.next = 10;
          break;
        }

        throw new _appiumBaseDriver.errors.NoAlertOpenError();

      case 10:
        assertButtonName = function assertButtonName(button, expectedName) {
          var name;
          return _regeneratorRuntime.async(function assertButtonName$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                button = button.ELEMENT ? button.ELEMENT : button;
                context$2$0.next = 3;
                return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + button + '/attribute/name', 'GET'));

              case 3:
                name = context$2$0.sent;

                if (!(name.toLowerCase() !== expectedName)) {
                  context$2$0.next = 6;
                  break;
                }

                throw new _appiumBaseDriver.errors.NoAlertOpenError();

              case 6:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        };

        alert = possibleAlert[0];

        if (!(possibleAlertButtons.length === 1)) {
          context$1$0.next = 17;
          break;
        }

        context$1$0.next = 15;
        return _regeneratorRuntime.awrap((function callee$1$0() {
          var closeButton;
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            var _this2 = this;

            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                closeButton = possibleAlertButtons[0];
                context$2$0.next = 3;
                return _regeneratorRuntime.awrap(assertButtonName(closeButton, 'close'));

              case 3:

                alert.close = function callee$2$0() {
                  return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                    while (1) switch (context$3$0.prev = context$3$0.next) {
                      case 0:
                        context$3$0.next = 2;
                        return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + closeButton.ELEMENT + '/click', 'POST'));

                      case 2:
                      case 'end':
                        return context$3$0.stop();
                    }
                  }, null, _this2);
                };

              case 4:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        })());

      case 15:
        context$1$0.next = 19;
        break;

      case 17:
        context$1$0.next = 19;
        return _regeneratorRuntime.awrap((function callee$1$0() {
          var cancelButton, okButton;
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            var _this3 = this;

            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                cancelButton = possibleAlertButtons[0];
                context$2$0.next = 3;
                return _regeneratorRuntime.awrap(assertButtonName(cancelButton, 'cancel'));

              case 3:
                okButton = possibleAlertButtons[1];
                context$2$0.next = 6;
                return _regeneratorRuntime.awrap(assertButtonName(okButton, 'ok'));

              case 6:

                alert.cancel = function callee$2$0() {
                  return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                    while (1) switch (context$3$0.prev = context$3$0.next) {
                      case 0:
                        context$3$0.next = 2;
                        return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + cancelButton.ELEMENT + '/click', 'POST'));

                      case 2:
                      case 'end':
                        return context$3$0.stop();
                    }
                  }, null, _this3);
                };
                alert.ok = function callee$2$0() {
                  return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
                    while (1) switch (context$3$0.prev = context$3$0.next) {
                      case 0:
                        context$3$0.next = 2;
                        return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + okButton.ELEMENT + '/click', 'POST'));

                      case 2:
                      case 'end':
                        return context$3$0.stop();
                    }
                  }, null, _this3);
                };

              case 8:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        })());

      case 19:

        alert.getText = function callee$1$0() {
          var textView;
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                context$2$0.next = 2;
                return _regeneratorRuntime.awrap(this.findNativeElementOrElements('class name', 'XCUIElementTypeTextView', false, alert.ELEMENT));

              case 2:
                textView = context$2$0.sent;
                context$2$0.next = 5;
                return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + textView.ELEMENT + '/attribute/value', 'GET'));

              case 5:
                return context$2$0.abrupt('return', context$2$0.sent);

              case 6:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this);
        };
        alert.setText = function callee$1$0(value) {
          var textView;
          return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
            while (1) switch (context$2$0.prev = context$2$0.next) {
              case 0:
                context$2$0.prev = 0;
                context$2$0.next = 3;
                return _regeneratorRuntime.awrap(this.findNativeElementOrElements('class name', 'XCUIElementTypeTextField', false, alert.ELEMENT));

              case 3:
                textView = context$2$0.sent;
                context$2$0.next = 6;
                return _regeneratorRuntime.awrap(this.proxyCommand('/element/' + textView.ELEMENT + '/value ', 'POST', { value: value }));

              case 6:
                context$2$0.next = 13;
                break;

              case 8:
                context$2$0.prev = 8;
                context$2$0.t0 = context$2$0['catch'](0);

                if (!(0, _appiumBaseDriver.isErrorType)(context$2$0.t0, _appiumBaseDriver.errors.NoSuchElementError)) {
                  context$2$0.next = 12;
                  break;
                }

                throw new Error('Tried to set text of an alert that was not a prompt');

              case 12:
                throw context$2$0.t0;

              case 13:
              case 'end':
                return context$2$0.stop();
            }
          }, null, _this, [[0, 8]]);
        };

        return context$1$0.abrupt('return', alert);

      case 22:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
};

_Object$assign(extensions, commands, helpers);
exports.commands = commands;
exports.helpers = helpers;
exports['default'] = extensions;

// make sure the button is 'Close'

// ensure the buttons are 'Cancel' and 'OK'
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9hbGVydC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O2dDQUFvQyxvQkFBb0I7O0FBR3hELElBQUksUUFBUSxHQUFHLEVBQUU7SUFBRSxPQUFPLEdBQUcsRUFBRTtJQUFFLFVBQVUsR0FBRyxFQUFFLENBQUM7O0FBRWpELFFBQVEsQ0FBQyxZQUFZLEdBQUc7TUFFaEIsTUFBTSxFQUNOLFFBQVEsRUFPUixNQUFLLEVBQ0wsSUFBSTs7Ozs7O0FBVEosY0FBTSxHQUFHLEtBQUs7QUFDZCxnQkFBUTs7eUNBQ0MsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsTUFBTSxDQUFDOzs7Ozs7Ozs7WUFFM0MsSUFBSSxDQUFDLFlBQVksRUFBRTs7Ozs7Ozs7O3lDQUlOLElBQUksQ0FBQyxRQUFRLEVBQUU7OztBQUE3QixjQUFLOzt5Q0FDUSxNQUFLLENBQUMsT0FBTyxFQUFFOzs7QUFBNUIsWUFBSTs0Q0FDRCxJQUFJOzs7Ozs7O0NBRWQsQ0FBQzs7O0FBR0YsUUFBUSxDQUFDLFlBQVksR0FBRyxvQkFBZ0IsSUFBSTtNQUtwQyxNQUFNLEVBQ04sUUFBUSxFQU9SLE9BQUs7Ozs7O0FBWlgsWUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDeEIsY0FBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDdkI7O0FBRUssY0FBTSxHQUFHLE1BQU07QUFDZixnQkFBUTs7eUNBQ0MsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQzs7Ozs7Ozs7O1lBRWpELElBQUksQ0FBQyxZQUFZLEVBQUU7Ozs7Ozs7Ozt5Q0FJTixJQUFJLENBQUMsUUFBUSxFQUFFOzs7QUFBN0IsZUFBSzs7eUNBQ0gsT0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7Ozs7Ozs7Ozs7Q0FHNUIsQ0FBQzs7QUFFRixRQUFRLENBQUMsZUFBZSxHQUFH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QUksQ0FBQyxZQUFZLGVBQWEsUUFBUSxDQUFDLE9BQU8sYUFBVSxNQUFNLENBQUM7Ozs7Ozs7aUJBQ3RFLENBQUM7Ozs7Ozs7Ozs7O0FBR0osYUFBSyxDQUFDLE9BQU8sR0FBRztjQUNWLFFBQVE7Ozs7O2lEQUFTLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxZQUFZLEVBQUUseUJBQXlCLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUM7OztBQUFoSCx3QkFBUTs7aURBQ0MsSUFBSSxDQUFDLFlBQVksZUFBYSxRQUFRLENBQUMsT0FBTyx1QkFBb0IsS0FBSyxDQUFDOzs7Ozs7Ozs7O1NBQ3RGLENBQUM7QUFDRixhQUFLLENBQUMsT0FBTyxHQUFHLG9CQUFPLEtBQUs7Y0FFcEIsUUFBUTs7Ozs7O2lEQUFTLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxZQUFZLEVBQUUsMEJBQTBCLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUM7OztBQUFqSCx3QkFBUTs7aURBQ04sSUFBSSxDQUFDLFlBQVksZUFBYSxRQUFRLENBQUMsT0FBTyxjQUFXLE1BQU0sRUFBRSxFQUFDLEtBQUssRUFBTCxLQUFLLEVBQUMsQ0FBQzs7Ozs7Ozs7OztxQkFFM0UsbURBQWlCLHlCQUFPLGtCQUFrQixDQUFDOzs7OztzQkFDdkMsSUFBSSxLQUFLLENBQUMscURBQXFELENBQUM7Ozs7Ozs7Ozs7U0FJM0UsQ0FBQzs7NENBRUssS0FBSzs7Ozs7OztDQUNiLENBQUM7O0FBR0YsZUFBYyxVQUFVLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3BDLFFBQVEsR0FBUixRQUFRO1FBQUUsT0FBTyxHQUFQLE9BQU87cUJBQ1gsVUFBVSIsImZpbGUiOiJsaWIvY29tbWFuZHMvYWxlcnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlcnJvcnMsIGlzRXJyb3JUeXBlIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcblxuXG5sZXQgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cbmNvbW1hbmRzLmdldEFsZXJ0VGV4dCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgdHJ5IHtcbiAgICBsZXQgbWV0aG9kID0gJ0dFVCc7XG4gICAgbGV0IGVuZHBvaW50ID0gYC9hbGVydC90ZXh0YDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoZW5kcG9pbnQsIG1ldGhvZCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cblxuICAgIGxldCBhbGVydCA9IGF3YWl0IHRoaXMuZ2V0QWxlcnQoKTtcbiAgICBsZXQgdGV4dCA9IGF3YWl0IGFsZXJ0LmdldFRleHQoKTtcbiAgICByZXR1cm4gdGV4dDtcbiAgfVxufTtcblxuLy8gVE9ETzogV0RBIGRvZXMgbm90IGN1cnJlbnRseSBzdXBwb3J0IHRoaXMgbmF0aXZlbHlcbmNvbW1hbmRzLnNldEFsZXJ0VGV4dCA9IGFzeW5jIGZ1bmN0aW9uICh0ZXh0KSB7XG4gIGlmICghQXJyYXkuaXNBcnJheSh0ZXh0KSkge1xuICAgIHRleHQgPSB0ZXh0LnNwbGl0KCcnKTtcbiAgfVxuICB0cnkge1xuICAgIGxldCBtZXRob2QgPSAnUE9TVCc7XG4gICAgbGV0IGVuZHBvaW50ID0gYC9hbGVydC90ZXh0YDtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoZW5kcG9pbnQsIG1ldGhvZCwgdGV4dCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cblxuICAgIGxldCBhbGVydCA9IGF3YWl0IHRoaXMuZ2V0QWxlcnQoKTtcbiAgICBhd2FpdCBhbGVydC5zZXRUZXh0KHRleHQpO1xuICAgIHJldHVybjtcbiAgfVxufTtcblxuY29tbWFuZHMucG9zdEFjY2VwdEFsZXJ0ID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICB0cnkge1xuICAgIGxldCBtZXRob2QgPSAnUE9TVCc7XG4gICAgbGV0IGVuZHBvaW50ID0gJy9hbGVydC9hY2NlcHQnO1xuICAgIGxldCBwYXJhbXMgPSB7fTtcbiAgICBpZiAob3B0cy5idXR0b25MYWJlbCkge1xuICAgICAgcGFyYW1zLm5hbWUgPSBvcHRzLmJ1dHRvbkxhYmVsO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoZW5kcG9pbnQsIG1ldGhvZCwgcGFyYW1zKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuXG4gICAgbGV0IGFsZXJ0ID0gYXdhaXQgdGhpcy5nZXRBbGVydCgpO1xuICAgIGlmIChhbGVydC5jbG9zZSkge1xuICAgICAgYXdhaXQgYWxlcnQuY2xvc2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgYWxlcnQub2soKTtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG59O1xuXG5jb21tYW5kcy5wb3N0RGlzbWlzc0FsZXJ0ID0gYXN5bmMgZnVuY3Rpb24gKG9wdHMgPSB7fSkge1xuICB0cnkge1xuICAgIGxldCBtZXRob2QgPSAnUE9TVCc7XG4gICAgbGV0IGVuZHBvaW50ID0gJy9hbGVydC9kaXNtaXNzJztcbiAgICBsZXQgcGFyYW1zID0ge307XG4gICAgaWYgKG9wdHMuYnV0dG9uTGFiZWwpIHtcbiAgICAgIHBhcmFtcy5uYW1lID0gb3B0cy5idXR0b25MYWJlbDtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGVuZHBvaW50LCBtZXRob2QsIHBhcmFtcyk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICghdGhpcy5pc1dlYkNvbnRleHQoKSkge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cblxuICAgIGxldCBhbGVydCA9IGF3YWl0IHRoaXMuZ2V0QWxlcnQoKTtcbiAgICBpZiAoYWxlcnQuY2xvc2UpIHtcbiAgICAgIGF3YWl0IGFsZXJ0LmNsb3NlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IGFsZXJ0LmNhbmNlbCgpO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cbn07XG5cbmNvbW1hbmRzLmdldEFsZXJ0QnV0dG9ucyA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvd2RhL2FsZXJ0L2J1dHRvbnMnLCAnR0VUJyk7XG59O1xuXG5jb21tYW5kcy5tb2JpbGVIYW5kbGVBbGVydCA9IGFzeW5jIGZ1bmN0aW9uIChvcHRzID0ge30pIHtcbiAgc3dpdGNoIChvcHRzLmFjdGlvbikge1xuICAgIGNhc2UgJ2FjY2VwdCc6XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wb3N0QWNjZXB0QWxlcnQob3B0cyk7XG4gICAgY2FzZSAnZGlzbWlzcyc6XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wb3N0RGlzbWlzc0FsZXJ0KG9wdHMpO1xuICAgIGNhc2UgJ2dldEJ1dHRvbnMnOlxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0QWxlcnRCdXR0b25zKCk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICdhY3Rpb24nIHZhbHVlIHNob3VsZCBiZSBlaXRoZXIgJ2FjY2VwdCcsICdkaXNtaXNzJyBvciAnZ2V0QnV0dG9ucycuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGAnJHtvcHRzLmFjdGlvbn0nIGlzIHByb3ZpZGVkIGluc3RlYWQuYCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuZ2V0QWxlcnQgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGxldCBwb3NzaWJsZUFsZXJ0ID0gYXdhaXQgdGhpcy5maW5kTmF0aXZlRWxlbWVudE9yRWxlbWVudHMoJ2NsYXNzIG5hbWUnLCAnWENVSUVsZW1lbnRUeXBlU2Nyb2xsVmlldycsIHRydWUpO1xuICBpZiAocG9zc2libGVBbGVydC5sZW5ndGggIT09IDEpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vQWxlcnRPcGVuRXJyb3IoKTtcbiAgfVxuXG4gIGxldCBwb3NzaWJsZUFsZXJ0QnV0dG9ucyA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKCdjbGFzcyBuYW1lJywgJ1hDVUlFbGVtZW50VHlwZUJ1dHRvbicsIHRydWUsIHBvc3NpYmxlQWxlcnRbMF0uRUxFTUVOVCk7XG4gIGlmIChwb3NzaWJsZUFsZXJ0QnV0dG9ucy5sZW5ndGggIDwgMSB8fCBwb3NzaWJsZUFsZXJ0QnV0dG9ucy5sZW5ndGggPiAyKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob0FsZXJ0T3BlbkVycm9yKCk7XG4gIH1cblxuICBsZXQgYXNzZXJ0QnV0dG9uTmFtZSA9IGFzeW5jIChidXR0b24sIGV4cGVjdGVkTmFtZSkgPT4ge1xuICAgIGJ1dHRvbiA9IGJ1dHRvbi5FTEVNRU5UID8gYnV0dG9uLkVMRU1FTlQgOiBidXR0b247XG4gICAgbGV0IG5hbWUgPSBhd2FpdCB0aGlzLnByb3h5Q29tbWFuZChgL2VsZW1lbnQvJHtidXR0b259L2F0dHJpYnV0ZS9uYW1lYCwgJ0dFVCcpO1xuICAgIGlmIChuYW1lLnRvTG93ZXJDYXNlKCkgIT09IGV4cGVjdGVkTmFtZSkge1xuICAgICAgdGhyb3cgbmV3IGVycm9ycy5Ob0FsZXJ0T3BlbkVycm9yKCk7XG4gICAgfVxuICB9O1xuXG4gIGxldCBhbGVydCA9IHBvc3NpYmxlQWxlcnRbMF07XG4gIGlmIChwb3NzaWJsZUFsZXJ0QnV0dG9ucy5sZW5ndGggPT09IDEpIHtcbiAgICAvLyBtYWtlIHN1cmUgdGhlIGJ1dHRvbiBpcyAnQ2xvc2UnXG4gICAgbGV0IGNsb3NlQnV0dG9uID0gcG9zc2libGVBbGVydEJ1dHRvbnNbMF07XG4gICAgYXdhaXQgYXNzZXJ0QnV0dG9uTmFtZShjbG9zZUJ1dHRvbiwgJ2Nsb3NlJyk7XG5cbiAgICBhbGVydC5jbG9zZSA9IGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke2Nsb3NlQnV0dG9uLkVMRU1FTlR9L2NsaWNrYCwgJ1BPU1QnKTtcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIC8vIGVuc3VyZSB0aGUgYnV0dG9ucyBhcmUgJ0NhbmNlbCcgYW5kICdPSydcbiAgICBsZXQgY2FuY2VsQnV0dG9uID0gcG9zc2libGVBbGVydEJ1dHRvbnNbMF07XG4gICAgYXdhaXQgYXNzZXJ0QnV0dG9uTmFtZShjYW5jZWxCdXR0b24sICdjYW5jZWwnKTtcbiAgICBsZXQgb2tCdXR0b24gPSBwb3NzaWJsZUFsZXJ0QnV0dG9uc1sxXTtcbiAgICBhd2FpdCBhc3NlcnRCdXR0b25OYW1lKG9rQnV0dG9uLCAnb2snKTtcblxuICAgIGFsZXJ0LmNhbmNlbCA9IGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke2NhbmNlbEJ1dHRvbi5FTEVNRU5UfS9jbGlja2AsICdQT1NUJyk7XG4gICAgfTtcbiAgICBhbGVydC5vayA9IGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke29rQnV0dG9uLkVMRU1FTlR9L2NsaWNrYCwgJ1BPU1QnKTtcbiAgICB9O1xuICB9XG5cbiAgYWxlcnQuZ2V0VGV4dCA9IGFzeW5jICgpID0+IHtcbiAgICBsZXQgdGV4dFZpZXcgPSBhd2FpdCB0aGlzLmZpbmROYXRpdmVFbGVtZW50T3JFbGVtZW50cygnY2xhc3MgbmFtZScsICdYQ1VJRWxlbWVudFR5cGVUZXh0VmlldycsIGZhbHNlLCBhbGVydC5FTEVNRU5UKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9lbGVtZW50LyR7dGV4dFZpZXcuRUxFTUVOVH0vYXR0cmlidXRlL3ZhbHVlYCwgJ0dFVCcpO1xuICB9O1xuICBhbGVydC5zZXRUZXh0ID0gYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCB0ZXh0VmlldyA9IGF3YWl0IHRoaXMuZmluZE5hdGl2ZUVsZW1lbnRPckVsZW1lbnRzKCdjbGFzcyBuYW1lJywgJ1hDVUlFbGVtZW50VHlwZVRleHRGaWVsZCcsIGZhbHNlLCBhbGVydC5FTEVNRU5UKTtcbiAgICAgIGF3YWl0IHRoaXMucHJveHlDb21tYW5kKGAvZWxlbWVudC8ke3RleHRWaWV3LkVMRU1FTlR9L3ZhbHVlIGAsICdQT1NUJywge3ZhbHVlfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoaXNFcnJvclR5cGUoZXJyLCBlcnJvcnMuTm9TdWNoRWxlbWVudEVycm9yKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RyaWVkIHRvIHNldCB0ZXh0IG9mIGFuIGFsZXJ0IHRoYXQgd2FzIG5vdCBhIHByb21wdCcpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gYWxlcnQ7XG59O1xuXG5cbk9iamVjdC5hc3NpZ24oZXh0ZW5zaW9ucywgY29tbWFuZHMsIGhlbHBlcnMpO1xuZXhwb3J0IHsgY29tbWFuZHMsIGhlbHBlcnMgfTtcbmV4cG9ydCBkZWZhdWx0IGV4dGVuc2lvbnM7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
